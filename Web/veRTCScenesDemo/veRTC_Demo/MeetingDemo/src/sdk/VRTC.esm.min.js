/*!
 * @byted/byte-rtc v3.22.0
 * (c) 2020-2021 luoshaohua@bytedance.com
 * Released under the ISC License.
 */
function e(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}var t=function(t){return function(){var r=this,n=arguments;return new Promise((function(i,a){var o=t.apply(r,n);function s(t){e(o,i,a,s,c,"next",t)}function c(t){e(o,i,a,s,c,"throw",t)}s(void 0)}))}};var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};var n=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(e){var t={exports:{}};return e(t,t.exports),t.exports}function o(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}var s=a((function(e){function t(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(r)}e.exports=t})),c=a((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),o=new x(n||[]);return a._invoke=function(e,t,r){var n=p;return function(i,a){if(n===h)throw new Error("Generator is already running");if(n===m){if("throw"===i)throw a;return P()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=R(o,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=l(e,t,r);if("normal"===c.type){if(n=r.done?m:f,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=m,r.method="throw",r.arg=c.arg)}}}(e,r,o),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var p="suspendedStart",f="suspendedYield",h="executing",m="completed",v={};function g(){}function y(){}function b(){}var _={};_[a]=function(){return this};var S=Object.getPrototypeOf,k=S&&S(S(I([])));k&&k!==r&&n.call(k,a)&&(_=k);var w=b.prototype=g.prototype=Object.create(_);function C(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(i,a,o,c){var d=l(e[i],e,a);if("throw"!==d.type){var u=d.arg,p=u.value;return p&&"object"===s(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,o,c)}),(function(e){r("throw",e,o,c)})):t.resolve(p).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,c)}))}c(d.arg)}var i;this._invoke=function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}}function R(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function I(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return y.prototype=w.constructor=b,b.constructor=y,y.displayName=d(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,d(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},C(A.prototype),A.prototype[o]=function(){return this},e.AsyncIterator=A,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new A(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(w),d(w,c,"Generator"),w[a]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=I,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),d=n.call(o,"finallyLoc");if(c&&d){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),d=!0,u=!0;function l(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function p(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var a=function(e){var t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,a),i.apply(this,[e,a])};var a=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(r))return a.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function f(e){return"boolean"!=typeof e?new Error("Argument type: "+s(e)+". Please use a boolean."):(d=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function h(e){return"boolean"!=typeof e?new Error("Argument type: "+s(e)+". Please use a boolean."):(u=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function m(){if("object"===("undefined"==typeof window?"undefined":s(window))){if(d)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function v(e,t){u&&console.warn(e+" is deprecated, please use "+t+" instead.")}function g(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=l(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=l(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=l(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=l(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function y(e){return"[object Object]"===Object.prototype.toString.call(e)}function b(e){return y(e)?Object.keys(e).reduce((function(t,r){var i=y(e[r]),a=i?b(e[r]):e[r],o=i&&!Object.keys(a).length;return void 0===a||o?t:Object.assign(t,n({},r,a))}),{}):e}function _(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?_(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((function(t){_(e,e.get(t),r)}))})))}function S(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&_(e,r,i)}))})),i}var k=m;function w(e,t){var r=e&&e.navigator;if(r.mediaDevices){var n=function(e){if("object"!==s(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===s(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var a={};"number"==typeof n.ideal?(a[i("min",r)]=n.ideal,t.optional.push(a),(a={})[i("max",r)]=n.ideal,t.optional.push(a)):(a[i("",r)]=n.ideal,t.optional.push(a))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===s(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===s(e.video)){var o=e.video.facingMode;o=o&&("object"===s(o)?o:{ideal:o});var c,d=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||d))if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?c=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(c=["front"]),c)return r.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return c.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&c.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=o.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),k("chrome: "+JSON.stringify(e)),i(e)}));e.video=n(e.video)}return k("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){i(e,(function(e){r.webkitGetUserMedia(e,t,(function(e){n&&n(a(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){var o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return o(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(a(e))}))}))}}}}function C(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function A(e){if("object"===s(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var a=new Event("track");a.track=n.track,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)})),t.stream.getTracks().forEach((function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var a=new Event("track");a.track=n,a.receiver=i,a.transceiver={receiver:i},a.streams=[t.stream],r.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else p(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function R(e){if("object"===s(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===s(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function T(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],a=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(o(e)))};return t.apply(this,[c,n])}return new Promise((function(r,n){t.apply(e,[function(e){r(s(o(e)))},n])})).then(i,a)}}}function E(e){if("object"===s(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return S(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),p(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return S(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,a=arguments[0];return this.getSenders().forEach((function(e){e.track===a&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===a&&(r?n=!0:r=e),e.track===a})),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function x(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}function I(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return x(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var a=this.getSenders().find((function(e){return e.track===t}));if(a)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],i=n({},t,(function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?r.apply(this,[function(r){var n=c(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return c(e,t)}))}));e.RTCPeerConnection.prototype[t]=i[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(n){r._streams[n].getTracks().find((function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}}function P(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],i=n({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]}))}function O(e,t){p(e,"negotiationneeded",(function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var D=Object.freeze({__proto__:null,shimMediaStream:C,shimOnTrack:A,shimGetSendersWithDtmf:R,shimGetStats:T,shimSenderReceiverGetStats:E,shimAddTrackRemoveTrackWithNative:x,shimAddTrackRemoveTrack:I,shimPeerConnection:P,fixNegotiationNeeded:O,shimGetUserMedia:w,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,a=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});var M=a((function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){var r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((function(e){return 0===e.indexOf(r)}))},t.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},t.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===s(e.keyParams)?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){var n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],i=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var a=n[i],o=t.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var s=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+a+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(t.parseRtcpFb),r.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){var n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((function(e){n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));var i=0;return r.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",r.headerExtensions&&r.headerExtensions.forEach((function(e){n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){var r,n=[],i=t.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,d=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(r=d[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&r&&(t.rtx={ssrc:r}),n.push(t),a&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&c&&n.push({ssrc:c});var u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},t.parseRtcpParameters=function(e){var r={},n=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=0===i.length;var a=t.matchPrefix(e,"a=rtcp-mux");return r.mux=a.length>0,r},t.parseMsid=function(e){var r,n=t.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(r=n[0].substr(7).split(" "))[0],track:r[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(r=i[0].value.split(" "))[0],track:r[1]}:void 0},t.parseSctpDescription=function(e){var r,n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);var a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};if(t.matchPrefix(e,"a=sctpmap:").length>0){var o=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,n){var i=void 0!==r?r:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,r,n,i){var a=t.writeRtpDescription(e.kind,r);if(a+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+o,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),a},t.getDirection=function(e,r){for(var n=t.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var r=t.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){var r=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var r=t.splitLines(e),n=0;n<r.length;n++)if(r[n].length<2||"="!==r[n].charAt(1))return!1;return!0},e.exports=t}));function N(e,t,r,n,i){var a=M.writeRtpDescription(e.kind,t);if(a+=M.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=M.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var o=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=o;var s="msid:"+(n?n.id:"-")+" "+o+"\r\n";a+="a="+s,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+M.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+M.localCName+"\r\n"),a}function L(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var a=n(e.parameters.apt,r),o=n(t.parameters.apt,i);return a&&o&&a.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(n){for(var a=0;a<t.codecs.length;a++){var o=t.codecs[a];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&o.parameters.apt&&!i(n,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}})),r}function B(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function j(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function U(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}var F=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function n(t,r,n,i){var a=new Event("track");a.track=r,a.receiver=n,a.transceiver={receiver:n},a.streams=i,e.setTimeout((function(){t._dispatchEvent("track",a)}))}var i=function(r){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){n[e]=i[e].bind(i)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw U("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=i?n[0]:n,!!n.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var a=r.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=M.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},i.prototype.addTrack=function(t,r){if(this._isClosed)throw U("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw U("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},i.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),n.getTracks().forEach((function(e){r.addTrack(e,n)}))}},i.prototype.removeTrack=function(t){if(this._isClosed)throw U("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw U("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},i.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},i.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},i.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,r){var n=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var a=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(n.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var o=e.candidate,s=!o||0===Object.keys(o).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),o.component=1,o.ufrag=i.getLocalParameters().usernameFragment;var c=M.writeCandidate(o);a.candidate=Object.assign(a.candidate,M.parseCandidate(c)),a.candidate.candidate=c,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var d=M.getMediaSections(n._localDescription.sdp);d[a.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",n._localDescription.sdp=M.getDescription(n._localDescription.sdp)+d.join("");var u=n.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),s||n._dispatchEvent("icecandidate",a),u&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout((function(){a.forEach((function(e){i.onlocalcandidate(e)}))}),0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,r,n){var i=L(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:M.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t,r,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(U("TypeError",'Unsupported type "'+e.type+'"'));if(!B("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(U("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=M.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=M.parseRtpParameters(e);n.transceivers[t].localCapabilities=r})),n.transceivers.forEach((function(e,t){n._gather(e.mid,t)}));else if("answer"===e.type){t=M.splitSections(n._remoteDescription.sdp),r=t.shift();var i=M.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var a=n.transceivers[t],o=a.iceGatherer,s=a.iceTransport,c=a.dtlsTransport,d=a.localCapabilities,u=a.remoteCapabilities;if(!(M.isRejected(e)&&0===M.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var l=M.getIceParameters(e,r),p=M.getDtlsParameters(e,r);i&&(p.role="server"),n.usingBundle&&0!==t||(n._gather(a.mid,t),"new"===s.state&&s.start(o,l,i?"controlling":"controlled"),"new"===c.state&&c.start(p));var f=L(d,u);n._transceive(a,f.codecs.length>0,!1)}}))}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var a=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(U("TypeError",'Unsupported type "'+i.type+'"'));if(!B("setRemoteDescription",i.type,a.signalingState)||a._isClosed)return Promise.reject(U("InvalidStateError","Can not set remote "+i.type+" in state "+a.signalingState));var o={};a.remoteStreams.forEach((function(e){o[e.id]=e}));var s=[],c=M.splitSections(i.sdp),d=c.shift(),u=M.matchPrefix(d,"a=ice-lite").length>0,l=M.matchPrefix(d,"a=group:BUNDLE ").length>0;a.usingBundle=l;var p=M.matchPrefix(d,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!p&&p.substr(14).split(" ").indexOf("trickle")>=0,c.forEach((function(n,c){var p=M.splitLines(n),f=M.getKind(n),h=M.isRejected(n)&&0===M.matchPrefix(n,"a=bundle-only").length,m=p[0].substr(2).split(" ")[2],v=M.getDirection(n,d),g=M.parseMsid(n),y=M.getMid(n)||M.generateIdentifier();if(h||"application"===f&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))a.transceivers[c]={mid:y,kind:f,protocol:m,rejected:!0};else{var b,_,S,k,w,C,A,R,T;!h&&a.transceivers[c]&&a.transceivers[c].rejected&&(a.transceivers[c]=a._createTransceiver(f,!0));var E,x,I=M.parseRtpParameters(n);h||(E=M.getIceParameters(n,d),(x=M.getDtlsParameters(n,d)).role="client"),A=M.parseRtpEncodingParameters(n);var P=M.parseRtcpParameters(n),O=M.matchPrefix(n,"a=end-of-candidates",d).length>0,D=M.matchPrefix(n,"a=candidate:").map((function(e){return M.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!h&&l&&c>0&&a.transceivers[c]&&(a._disposeIceAndDtlsTransports(c),a.transceivers[c].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[c].iceTransport=a.transceivers[0].iceTransport,a.transceivers[c].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[c].rtpSender&&a.transceivers[c].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[c].rtpReceiver&&a.transceivers[c].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),"offer"!==i.type||h){if("answer"===i.type&&!h){_=(b=a.transceivers[c]).iceGatherer,S=b.iceTransport,k=b.dtlsTransport,w=b.rtpReceiver,C=b.sendEncodingParameters,R=b.localCapabilities,a.transceivers[c].recvEncodingParameters=A,a.transceivers[c].remoteCapabilities=I,a.transceivers[c].rtcpParameters=P,D.length&&"new"===S.state&&(!u&&!O||l&&0!==c?D.forEach((function(e){j(b.iceTransport,e)})):S.setRemoteCandidates(D)),l&&0!==c||("new"===S.state&&S.start(_,E,"controlling"),"new"===k.state&&k.start(x)),!L(b.localCapabilities,b.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,a._transceive(b,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!w||"sendrecv"!==v&&"sendonly"!==v?delete b.rtpReceiver:(T=w.track,g?(o[g.stream]||(o[g.stream]=new e.MediaStream),r(T,o[g.stream]),s.push([T,w,o[g.stream]])):(o.default||(o.default=new e.MediaStream),r(T,o.default),s.push([T,w,o.default])))}}else{(b=a.transceivers[c]||a._createTransceiver(f)).mid=y,b.iceGatherer||(b.iceGatherer=a._createIceGatherer(c,l)),D.length&&"new"===b.iceTransport.state&&(!O||l&&0!==c?D.forEach((function(e){j(b.iceTransport,e)})):b.iceTransport.setRemoteCandidates(D)),R=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(R.codecs=R.codecs.filter((function(e){return"rtx"!==e.name}))),C=b.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,B=!1;if("sendrecv"===v||"sendonly"===v){if(B=!b.rtpReceiver,w=b.rtpReceiver||new e.RTCRtpReceiver(b.dtlsTransport,f),B)T=w.track,g&&"-"===g.stream||(g?(o[g.stream]||(o[g.stream]=new e.MediaStream,Object.defineProperty(o[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(T,"id",{get:function(){return g.track}}),N=o[g.stream]):(o.default||(o.default=new e.MediaStream),N=o.default)),N&&(r(T,N),b.associatedRemoteMediaStreams.push(N)),s.push([T,w,N])}else b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===b.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),b.associatedRemoteMediaStreams=[]);b.localCapabilities=R,b.remoteCapabilities=I,b.rtpReceiver=w,b.rtcpParameters=P,b.sendEncodingParameters=C,b.recvEncodingParameters=A,a._transceive(a.transceivers[c],!1,B)}}})),void 0===a._dtlsRole&&(a._dtlsRole="offer"===i.type?"active":"passive"),a._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(o).forEach((function(t){var r=o[t];if(r.getTracks().length){if(-1===a.remoteStreams.indexOf(r)){a.remoteStreams.push(r);var i=new Event("addstream");i.stream=r,e.setTimeout((function(){a._dispatchEvent("addstream",i)}))}s.forEach((function(e){var t=e[0],i=e[1];r.id===e[2].id&&n(a,t,i,[r])}))}})),s.forEach((function(e){e[2]||n(a,e[0],e[1],[])})),e.setTimeout((function(){a&&a.transceivers&&a.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},i.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(U("InvalidStateError","Can not call createOffer after close"));var n=r.transceivers.filter((function(e){return"audio"===e.kind})).length,i=r.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(n=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(i=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--n<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)}));n>0||i>0;)n>0&&(r._createTransceiver("audio"),n--),i>0&&(r._createTransceiver("video"),i--);var o=M.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(n,i){var a=n.track,o=n.kind,s=n.mid||M.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle));var c=e.RTCRtpSender.getCapabilities(o);t<15019&&(c.codecs=c.codecs.filter((function(e){return"rtx"!==e.name}))),c.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),c.headerExtensions.forEach((function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];a&&t>=15019&&"video"===o&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=c,n.sendEncodingParameters=d})),"max-compat"!==r._config.bundlePolicy&&(o+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){o+=N(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),o+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,o+="a="+M.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(o+="a=end-of-candidates\r\n"))}));var s=new e.RTCSessionDescription({type:"offer",sdp:o});return Promise.resolve(s)},i.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(U("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(U("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var n=M.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(n+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),n+="a=ice-options:trickle\r\n";var i=M.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,a){if(!(a+1>i)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?n+="m=application 0 DTLS/SCTP 5000\r\n":n+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?n+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(n+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(n+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var o;if(e.stream)"audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var s=L(e.localCapabilities,e.remoteCapabilities);!s.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=N(e,s,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}}));var a=new e.RTCSessionDescription({type:"answer",sdp:n});return Promise.resolve(a)},i.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(n,i){if(!r._remoteDescription)return i(U("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var o=0;o<r.transceivers.length;o++)if(r.transceivers[o].mid===e.sdpMid){a=o;break}var s=r.transceivers[a];if(!s)return i(U("OperationError","Can not add ICE candidate"));if(s.rejected)return n();var c=Object.keys(e.candidate).length>0?M.parseCandidate(e.candidate):{};if("tcp"===c.protocol&&(0===c.port||9===c.port))return n();if(c.component&&1!==c.component)return n();if((0===a||a>0&&s.iceTransport!==r.transceivers[0].iceTransport)&&!j(s.iceTransport,c))return i(U("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=M.getMediaSections(r._remoteDescription.sdp))[a]+="a="+(c.type?d:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=M.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var u=0;u<r.transceivers.length&&(r.transceivers[u].rejected||(r.transceivers[u].iceTransport.addRemoteCandidate({}),(t=M.getMediaSections(r._remoteDescription.sdp))[u]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=M.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));u++);n()}))},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw U("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])})),t}))}}}));var a=["createOffer","createAnswer"];return a.forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(a=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),i};function V(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}function z(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function G(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=F(e,t.version);e.RTCPeerConnection=function(e){var r,i;return e&&e.iceServers&&(e.iceServers=(r=e.iceServers,t.version,i=!1,(r=JSON.parse(JSON.stringify(r))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&v("RTCIceServer.url","RTCIceServer.urls");var r="string"==typeof t;return r&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!i?(i=!0,!0):t&&!i})),delete e.url,e.urls=r?t[0]:t,!!t.length}}))),m("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function H(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var W=Object.freeze({__proto__:null,shimPeerConnection:G,shimReplaceTrack:H,shimGetUserMedia:V,shimGetDisplayMedia:z});function q(e,t){var r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){v("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===s(e)&&"object"===s(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},n&&n.prototype.getSettings){var o=n.prototype.getSettings;n.prototype.getSettings=function(){var e=o.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var c=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===s(e)&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[e])}}}}function J(e){"object"===s(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function Z(e,t){if("object"===s(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],i=n({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=i[t]}));var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],a=e[1],o=e[2];return i.apply(this,[n||null]).then((function(e){if(t.version<53&&!a)try{e.forEach((function(e){e.type=r[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(a,o)}}}function K(e){if("object"===s(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function Q(e){if("object"===s(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),p(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function Y(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;v("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})}function X(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var i=n.sender,a=i.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e.sendEncodings,i.sendEncodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(a).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return n})}}function ee(e){if("object"===s(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function te(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function re(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}var ne=Object.freeze({__proto__:null,shimOnTrack:J,shimPeerConnection:Z,shimSenderGetStats:K,shimReceiverGetStats:Q,shimRemoveStream:Y,shimRTCDataChannel:X,shimAddTransceiver:$,shimGetParameters:ee,shimCreateOffer:te,shimCreateAnswer:re,shimGetUserMedia:q,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function ie(e){if("object"===s(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(r,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return i&&i.forEach((function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})}}function ae(e){if("object"===s(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}}function oe(e){if("object"===s(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c}}function se(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(ce(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function ce(e){return e&&void 0!==e.video?Object.assign({},e,{video:b(e.video)}):e}function de(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(v("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,n.push(a)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function ue(e){"object"===s(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function le(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function pe(e){"object"!==s(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var fe=Object.freeze({__proto__:null,shimLocalStreamsAPI:ie,shimRemoteStreamsAPI:ae,shimCallbacksAPI:oe,shimGetUserMedia:se,shimConstraints:ce,shimRTCIceServerUrls:de,shimTrackEventTransceiver:ue,shimCreateOfferLegacy:le,shimAudioContext:pe});function he(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===s(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),n=M.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,p(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function me(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=M.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=M.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=M.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){var c,d=n(arguments[0]),u=i(d),l=a(arguments[0],d);c=0===u&&0===l?Number.POSITIVE_INFINITY:0===u||0===l?Math.max(u,l):Math.min(u,l);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return c}}),this._sctp=p}return o.apply(this,arguments)}}}function ve(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},p(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}function ge(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function ye(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var n=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return r.apply(this,arguments)}}}function be(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}var _e=Object.freeze({__proto__:null,shimRTCIceCandidate:he,shimMaxMessageSize:me,shimSendThrowTypeError:ve,shimConnectionState:ge,removeExtmapAllowMixed:ye,shimAddIceCandidateNullOrEmpty:be});!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=m,i=g(t),a={browserDetails:i,commonShim:_e,extractVersion:l,disableLog:f,disableWarnings:h};switch(i.browser){case"chrome":if(!D||!P||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=D,be(t,i),w(t,i),C(t),P(t,i),A(t),I(t,i),R(t),T(t),E(t),O(t,i),he(t),ge(t),me(t,i),ve(t),ye(t,i);break;case"firefox":if(!ne||!Z||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=ne,be(t,i),q(t,i),Z(t,i),J(t),Y(t),K(t),Q(t),X(t),$(t),ee(t),te(t),re(t),he(t),ge(t),me(t,i),ve(t);break;case"edge":if(!W||!G||!r.shimEdge)return n("MS edge shim is not included in this adapter release."),a;n("adapter.js shimming edge."),a.browserShim=W,V(t),z(t),G(t,i),H(t),me(t,i),ve(t);break;case"safari":if(!fe||!r.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=fe,be(t,i),de(t),le(t),oe(t),ie(t),ae(t),ue(t),se(t),pe(t),he(t),me(t,i),ve(t),ye(t,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var Se=function(e){if(Array.isArray(e))return e};var ke=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}};var we=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n};var Ce=function(e,t){if(e){if("string"==typeof e)return we(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?we(e,t):void 0}};var Ae=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var Re=function(e,t){return Se(e)||ke(e,t)||Ce(e,t)||Ae()};function Te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ee=function(e,t,r){return t&&Te(e.prototype,t),r&&Te(e,r),e},xe=a((function(e,t){var r="__lodash_hash_undefined__",n=9007199254740991,a="[object Arguments]",o="[object Boolean]",c="[object Date]",d="[object Function]",u="[object GeneratorFunction]",l="[object Map]",p="[object Number]",f="[object Object]",h="[object Promise]",m="[object RegExp]",v="[object Set]",g="[object String]",y="[object Symbol]",b="[object WeakMap]",_="[object ArrayBuffer]",S="[object DataView]",k="[object Float32Array]",w="[object Float64Array]",C="[object Int8Array]",A="[object Int16Array]",R="[object Int32Array]",T="[object Uint8Array]",E="[object Uint8ClampedArray]",x="[object Uint16Array]",I="[object Uint32Array]",P=/\w*$/,O=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,M={};M[a]=M["[object Array]"]=M[_]=M[S]=M[o]=M[c]=M[k]=M[w]=M[C]=M[A]=M[R]=M[l]=M[p]=M[f]=M[m]=M[v]=M[g]=M[y]=M[T]=M[E]=M[x]=M[I]=!0,M["[object Error]"]=M[d]=M[b]=!1;var N="object"==s(i)&&i&&i.Object===Object&&i,L="object"==("undefined"==typeof self?"undefined":s(self))&&self&&self.Object===Object&&self,B=N||L||Function("return this")(),j=t&&!t.nodeType&&t,U=j&&e&&!e.nodeType&&e,F=U&&U.exports===j;function V(e,t){return e.set(t[0],t[1]),e}function z(e,t){return e.add(t),e}function G(e,t,r,n){var i=-1,a=e?e.length:0;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}function H(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function W(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function q(e,t){return function(r){return e(t(r))}}function J(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var Z,K=Array.prototype,Q=Function.prototype,Y=Object.prototype,X=B["__core-js_shared__"],$=(Z=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+Z:"",ee=Q.toString,te=Y.hasOwnProperty,re=Y.toString,ne=RegExp("^"+ee.call(te).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ie=F?B.Buffer:void 0,ae=B.Symbol,oe=B.Uint8Array,se=q(Object.getPrototypeOf,Object),ce=Object.create,de=Y.propertyIsEnumerable,ue=K.splice,le=Object.getOwnPropertySymbols,pe=ie?ie.isBuffer:void 0,fe=q(Object.keys,Object),he=Ue(B,"DataView"),me=Ue(B,"Map"),ve=Ue(B,"Promise"),ge=Ue(B,"Set"),ye=Ue(B,"WeakMap"),be=Ue(Object,"create"),_e=He(he),Se=He(me),ke=He(ve),we=He(ge),Ce=He(ye),Ae=ae?ae.prototype:void 0,Re=Ae?Ae.valueOf:void 0;function Te(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ee(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function xe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ie(e){this.__data__=new Ee(e)}function Pe(e,t){var r=qe(e)||function(e){return function(e){return function(e){return!!e&&"object"==s(e)}(e)&&Je(e)}(e)&&te.call(e,"callee")&&(!de.call(e,"callee")||re.call(e)==a)}(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],n=r.length,i=!!n;for(var o in e)!t&&!te.call(e,o)||i&&("length"==o||ze(o,n))||r.push(o);return r}function Oe(e,t,r){var n=e[t];te.call(e,t)&&We(n,r)&&(void 0!==r||t in e)||(e[t]=r)}function De(e,t){for(var r=e.length;r--;)if(We(e[r][0],t))return r;return-1}function Me(e,t,r,n,i,s,h){var b;if(n&&(b=s?n(e,i,s,h):n(e)),void 0!==b)return b;if(!Qe(e))return e;var O=qe(e);if(O){if(b=function(e){var t=e.length,r=e.constructor(t);t&&"string"==typeof e[0]&&te.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(e),!t)return function(e,t){var r=-1,n=e.length;t||(t=Array(n));for(;++r<n;)t[r]=e[r];return t}(e,b)}else{var D=Ve(e),N=D==d||D==u;if(Ze(e))return function(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}(e,t);if(D==f||D==a||N&&!s){if(H(e))return s?e:{};if(b=function(e){return"function"!=typeof e.constructor||Ge(e)?{}:(t=se(e),Qe(t)?ce(t):{});var t}(N?{}:e),!t)return function(e,t){return Be(e,Fe(e),t)}(e,function(e,t){return e&&Be(t,Ye(t),e)}(b,e))}else{if(!M[D])return s?e:{};b=function(e,t,r,n){var i=e.constructor;switch(t){case _:return Le(e);case o:case c:return new i(+e);case S:return function(e,t){var r=t?Le(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,n);case k:case w:case C:case A:case R:case T:case E:case x:case I:return function(e,t){var r=t?Le(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}(e,n);case l:return function(e,t,r){return G(t?r(W(e),!0):W(e),V,new e.constructor)}(e,n,r);case p:case g:return new i(e);case m:return function(e){var t=new e.constructor(e.source,P.exec(e));return t.lastIndex=e.lastIndex,t}(e);case v:return function(e,t,r){return G(t?r(J(e),!0):J(e),z,new e.constructor)}(e,n,r);case y:return a=e,Re?Object(Re.call(a)):{}}var a}(e,D,Me,t)}}h||(h=new Ie);var L=h.get(e);if(L)return L;if(h.set(e,b),!O)var B=r?function(e){return function(e,t,r){var n=t(e);return qe(e)?n:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(n,r(e))}(e,Ye,Fe)}(e):Ye(e);return function(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););}(B||e,(function(i,a){B&&(i=e[a=i]),Oe(b,a,Me(i,t,r,n,a,e,h))})),b}function Ne(e){return!(!Qe(e)||(t=e,$&&$ in t))&&(Ke(e)||H(e)?ne:O).test(He(e));var t}function Le(e){var t=new e.constructor(e.byteLength);return new oe(t).set(new oe(e)),t}function Be(e,t,r,n){r||(r={});for(var i=-1,a=t.length;++i<a;){var o=t[i],s=n?n(r[o],e[o],o,r,e):void 0;Oe(r,o,void 0===s?e[o]:s)}return r}function je(e,t){var r,n,i=e.__data__;return("string"==(n=s(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?i["string"==typeof t?"string":"hash"]:i.map}function Ue(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return Ne(r)?r:void 0}Te.prototype.clear=function(){this.__data__=be?be(null):{}},Te.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Te.prototype.get=function(e){var t=this.__data__;if(be){var n=t[e];return n===r?void 0:n}return te.call(t,e)?t[e]:void 0},Te.prototype.has=function(e){var t=this.__data__;return be?void 0!==t[e]:te.call(t,e)},Te.prototype.set=function(e,t){return this.__data__[e]=be&&void 0===t?r:t,this},Ee.prototype.clear=function(){this.__data__=[]},Ee.prototype.delete=function(e){var t=this.__data__,r=De(t,e);return!(r<0)&&(r==t.length-1?t.pop():ue.call(t,r,1),!0)},Ee.prototype.get=function(e){var t=this.__data__,r=De(t,e);return r<0?void 0:t[r][1]},Ee.prototype.has=function(e){return De(this.__data__,e)>-1},Ee.prototype.set=function(e,t){var r=this.__data__,n=De(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},xe.prototype.clear=function(){this.__data__={hash:new Te,map:new(me||Ee),string:new Te}},xe.prototype.delete=function(e){return je(this,e).delete(e)},xe.prototype.get=function(e){return je(this,e).get(e)},xe.prototype.has=function(e){return je(this,e).has(e)},xe.prototype.set=function(e,t){return je(this,e).set(e,t),this},Ie.prototype.clear=function(){this.__data__=new Ee},Ie.prototype.delete=function(e){return this.__data__.delete(e)},Ie.prototype.get=function(e){return this.__data__.get(e)},Ie.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Ee){var n=r.__data__;if(!me||n.length<199)return n.push([e,t]),this;r=this.__data__=new xe(n)}return r.set(e,t),this};var Fe=le?q(le,Object):function(){return[]},Ve=function(e){return re.call(e)};function ze(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function Ge(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Y)}function He(e){if(null!=e){try{return ee.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){return e===t||e!=e&&t!=t}(he&&Ve(new he(new ArrayBuffer(1)))!=S||me&&Ve(new me)!=l||ve&&Ve(ve.resolve())!=h||ge&&Ve(new ge)!=v||ye&&Ve(new ye)!=b)&&(Ve=function(e){var t=re.call(e),r=t==f?e.constructor:void 0,n=r?He(r):void 0;if(n)switch(n){case _e:return S;case Se:return l;case ke:return h;case we:return v;case Ce:return b}return t});var qe=Array.isArray;function Je(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!Ke(e)}var Ze=pe||function(){return!1};function Ke(e){var t=Qe(e)?re.call(e):"";return t==d||t==u}function Qe(e){var t=s(e);return!!e&&("object"==t||"function"==t)}function Ye(e){return Je(e)?Pe(e):function(e){if(!Ge(e))return fe(e);var t=[];for(var r in Object(e))te.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}e.exports=function(e){return Me(e,!0,!0)}})),Ie=a((function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach((function(e){t[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),Pe=a((function(e,t){var r=function(e){return String(Number(e))===e?Number(e):e},n=function(e,t,n){var i=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:i&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:i?t[e.name]:t;!function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(t[n[a]]=r(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),a=r[r.length-1]);for(var o=0;o<(Ie[t]||[]).length;o+=1){var s=Ie[t][o];if(s.reg.test(i))return n(s,a,i)}})),t.media=r,t};var a=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}})),Oe=/%[sdv%]/g,De=function(e){var t=1,r=arguments,n=r.length;return e.replace(Oe,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},Me=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return De.apply(null,n)},Ne=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Le=["i","c","b","a"],Be={write:function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||Ne,n=t.innerOrder||Le,i=[];return r.forEach((function(t){Ie[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(Me(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(Me(t,r,e))}))}))})),e.media.forEach((function(e){i.push(Me("m",Ie.m[0],e)),n.forEach((function(t){Ie[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(Me(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(Me(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"},parse:Pe.parse,parseParams:Pe.parseParams,parseFmtpConfig:Pe.parseFmtpConfig,parsePayloads:Pe.parsePayloads,parseRemoteCandidates:Pe.parseRemoteCandidates,parseImageAttributes:Pe.parseImageAttributes,parseSimulcastStreamList:Pe.parseSimulcastStreamList},je=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach((function(e){e.sources&&e.sources.length&&(e.ssrcs=[],e.sources.forEach((function(t){Object.keys(t).forEach((function(r){"id"!==r&&e.ssrcs.push({id:t.id,attribute:r,value:t[r]})}))})),delete e.sources),e.ssrcGroups&&e.ssrcGroups.length&&e.ssrcGroups.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))}))})),Be.write(e,t)},Ue=function(e){var t=Be.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach((function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources=[],e.ssrcs.forEach((function(t){var r=e.sources.findIndex((function(e){return e.id===t.id}));if(r>-1)e.sources[r][t.attribute]=t.value;else{var n={id:t.id};n[t.attribute]=t.value,e.sources.push(n)}})),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))}))})),t},Fe=["audio","video","data"],Ve=function(e){return e.find((function(e){return"SIM"===e.semantics}))},ze=function(e){return e.find((function(e){return"FID"===e.semantics}))};function Ge(e,t,r,n){if(e&&t){var i=function(e){return n.find((function(t){return t.id.toString()===e}))};t.ssrcs.forEach((function(t){e.sources.push(i(t));var n=r[parseInt(t,10)].find((function(e){return"FID"===e.semantics}));if(n){var a=n.ssrcs.find((function(e){return e!==t}));e.sources.push(i(a)),e.ssrcGroups.push(n)}})),e.ssrcGroups.push(t)}}function He(e,t,r,n){if(e&&t){if(e.sources=[],e.ssrcGroups=[],!r[t.id])return e.sources.push(t),void(e.msid=t.msid);var i=Ve(r[t.id]),a=ze(r[t.id]);if(i)Ge(e,i,r,n);else if(a){var o=a.ssrcs.find((function(e){return e!==t})),s=Ve(r[o]);s?Ge(e,s,r,n):(a.ssrcs.forEach((function(t){e.sources.push(function(e){return n.find((function(t){return t.id.toString()===e}))}(t))})),e.ssrcGroups.push(a))}e.msid=e.sources[0].msid}}function We(e,t,r){if(!r.find((function(t){return!!t.sources&&t.sources.some((function(t){return t.id===e.id}))}))){if(!t[e.id])return!1;var n=Ve(t[e.id]),i=ze(t[e.id]);return n?r.some((function(e){return e.sources&&e.sources.some((function(e){return e.id.toString()===n.ssrcs[0]}))})):!(!i||e.id.toString()===i.ssrcs[0])&&We({id:i.ssrcs[0]},t,r)}return!0}function qe(e){var t={};return e&&Array.isArray(e)?(e.forEach((function(e){e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach((function(r){void 0===t[r]&&(t[r]=[]),t[r].push(e)}))})),t):t}var Je=function(){function e(){r(this,e)}return Ee(e,[{key:"toPlanB",value:function(e){if(!e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var t=Ue(e.sdp);if(!t.media||!t.media.length)return console.warn("The description has no media."),e;if(t.media.every((function(e){return-1!==Fe.indexOf(e.mid)})))return console.warn("The description does not look like unified plan sdp"),e;var r={},n=t.media;t.media=[],n.forEach((function(e){var t=e.type;if("application"===t)return e.mid="data",void(r[e.mid]=e);if(void 0===r[t]){var n=xe(e);n.sources&&Array.isArray(n.sources)&&n.sources.forEach((function(t){e.msid?t.msid=e.msid:delete t.msid})),n.ssrcGroups&&e.msid||(n.ssrcGroups=[]),delete n.msid,n.mid=t,r[t]=n}else e.msid&&(e.sources&&Array.isArray(e.sources)&&(r[t].sources=(r[t].sources||[]).concat(e.sources)),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(r[t].ssrcGroups=r[t].ssrcGroups.concat(e.ssrcGroups)))})),t.media=Object.values(r);var i=[];Object.values(r).forEach((function(e){"inactive"!==e.direction&&i.push(e.mid)})),t.groups.forEach((function(e){"BUNDLE"===e.type&&(e.mids=i.join(" "))})),t.msidSemantic={semantic:"WMS",token:"*"};var a=je(t);return new RTCSessionDescription({type:e.type,sdp:a})}},{key:"toUnifiedPlan",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var r=Ue(e.sdp);if(!r.media||!r.media.length)return console.warn("The description has no media."),e;if(r.media.length>3||r.media.every((function(e){return-1===Fe.indexOf(e.mid)})))return console.warn("The description does not look like plan-b"),e;var n=t?Ue(t.sdp):null,i={};r.media.forEach((function(e){var t=e.type;if("application"!==t){var r=qe(e.ssrcGroups);if(e.sources)e.sources.forEach((function(t,a){if(t.msid){if(!n||!n.media){if(We(t,r,Object.values(i)))return;var o=xe(e);return o.mid=Object.keys(i).length.toString(),o.direction=a||"sendonly"===e.direction?"sendonly":"sendrecv",o.bundleOnly=void 0,He(o,t,r,e.sources),void(i[o.mid]=o)}if(!We(t,r,n.media)){var s=xe(e);s.mid=n.media.length.toString(),s.direction="sendonly",He(s,t,r,e.sources),n.media.push(s)}}}));else if(!n){var a=xe(e);a.mid=Object.keys(i).length.toString(),i[e.mid]=a}}else{if(!n||!n.media){var o=xe(e);return o.mid=Object.keys(i).length.toString(),void(i[e.mid]=o)}var s=n.media.findIndex((function(e){return e.type===t}));s&&(n.media[s]=e,n.media[s].mid=s)}})),r.media=n?n.media:Object.values(i);var a=[];r.media.forEach((function(e){a.push(e.mid)})),r.groups.forEach((function(e){"BUNDLE"===e.type&&(e.mids=a.join(" "))})),r.msidSemantic={semantic:"WMS",token:"*"},r.origin.sessionVersion++;var o=je(r);return new RTCSessionDescription({type:e.type,sdp:o})}}]),e}();function Ze(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!(this instanceof Ze))return new(Function.prototype.bind.apply(Ze,[null].concat(Array.prototype.slice.call(r))));Array.from(r).forEach((function(t){e[t]=Symbol.for("LICODE_SEMANTIC_SDP_".concat(t))}))}var Ke=Ze("ACTIVE","PASSIVE","ACTPASS","INACTIVE");Ke.byValue=function(e){return Ke[e.toUpperCase()]},Ke.toString=function(e){switch(e){case Ke.ACTIVE:return"active";case Ke.PASSIVE:return"passive";case Ke.ACTPASS:return"actpass";case Ke.INACTIVE:return"inactive";default:return null}},Ke.reverse=function(e){switch(e){case Ke.ACTIVE:return Ke.PASSIVE;case Ke.PASSIVE:return Ke.ACTIVE;case Ke.ACTPASS:return Ke.PASSIVE;case Ke.INACTIVE:return Ke.INACTIVE;default:return Ke.ACTIVE}};var Qe=Ze("SEND","RECV");Qe.byValue=function(e){return Qe[e.toUpperCase()]},Qe.toString=function(e){switch(e){case Qe.SEND:return"send";case Qe.RECV:return"recv";default:return"unknown"}},Qe.reverse=function(e){switch(e){case Qe.SEND:return Qe.RECV;case Qe.RECV:default:return Qe.SEND}};var Ye=Ze("SENDRECV","SENDONLY","RECVONLY","INACTIVE");Ye.byValue=function(e){return Ye[e.toUpperCase()]},Ye.toString=function(e){switch(e){case Ye.SENDRECV:return"sendrecv";case Ye.SENDONLY:return"sendonly";case Ye.RECVONLY:return"recvonly";case Ye.INACTIVE:return"inactive";default:return"unknown"}},Ye.reverse=function(e){switch(e){case Ye.SENDRECV:return Ye.SENDRECV;case Ye.SENDONLY:return Ye.RECVONLY;case Ye.RECVONLY:return Ye.SENDONLY;case Ye.INACTIVE:return Ye.INACTIVE;default:return Ye.SENDRECV}};var Xe=function(e){if(Array.isArray(e))return we(e)};var $e=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var et=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var tt=function(e){return Xe(e)||$e(e)||Ce(e)||et()},rt=function(){var e,t="";e=function(e,t){var r;switch(e){case 4:r=console.error;break;case 3:r=console.warn;break;case 2:r=console.info}(r||console.log).apply(void 0,tt(t))};return{VERBOSE:-1,DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogLevel:function(e){var t=e;e>rt.NONE?t=rt.NONE:e<rt.VERBOSE&&(t=rt.VERBOSE),rt.logLevel=t},setOutputFunction:function(t){e=t},setLogPrefix:function(e){t=e},log:function(r){var n=t;if(!(r<rt.logLevel)){r===rt.VERBOSE?n="".concat(n,"VERBOSE"):r===rt.DEBUG?n="".concat(n,"DEBUG"):r===rt.TRACE?n="".concat(n,"TRACE"):r===rt.INFO?n="".concat(n,"INFO"):r===rt.WARNING?n="".concat(n,"WARNING"):r===rt.ERROR&&(n="".concat(n,"ERROR")),n="".concat(n,": ");for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var s=[n].concat(a);if(void 0!==rt.panel){for(var c="",d=0;d<s.length;d+=1)c+=s[d];rt.panel.value="".concat(rt.panel.value,"\n").concat(c)}else e.apply(rt,[r,s])}},verbose:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];rt.log.apply(rt,[rt.VERBOSE].concat(t))},debug:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];rt.log.apply(rt,[rt.DEBUG].concat(t))},trace:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];rt.log.apply(rt,[rt.TRACE].concat(t))},info:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];rt.log.apply(rt,[rt.INFO].concat(t))},warning:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];rt.log.apply(rt,[rt.WARNING].concat(t))},error:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];rt.log.apply(rt,[rt.ERROR].concat(t))}}}();rt.setLogLevel(rt.WARNING);var nt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,it=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,at="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ot="["+at+"]",st="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",ct="\\d+",dt="[\\u2700-\\u27bf]",ut="[a-z\\xdf-\\xf6\\xf8-\\xff]",lt="[^\\ud800-\\udfff"+at+ct+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",pt="(?:\\ud83c[\\udde6-\\uddff]){2}",ft="[\\ud800-\\udbff][\\udc00-\\udfff]",ht="[A-Z\\xc0-\\xd6\\xd8-\\xde]",mt="(?:"+ut+"|"+lt+")",vt="(?:"+ht+"|"+lt+")",gt="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",yt="[\\ufe0e\\ufe0f]?"+gt+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",pt,ft].join("|")+")[\\ufe0e\\ufe0f]?"+gt+")*"),bt="(?:"+[dt,pt,ft].join("|")+")"+yt,_t=RegExp("[']","g"),St=RegExp(st,"g"),kt=RegExp([ht+"?"+ut+"+(?:['](?:d|ll|m|re|s|t|ve))?(?="+[ot,ht,"$"].join("|")+")",vt+"+(?:['](?:D|LL|M|RE|S|T|VE))?(?="+[ot,ht+mt,"$"].join("|")+")",ht+"?"+mt+"+(?:['](?:d|ll|m|re|s|t|ve))?",ht+"+(?:['](?:D|LL|M|RE|S|T|VE))?",ct,bt].join("|"),"g"),wt=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ct="object"==("undefined"==typeof global?"undefined":s(global))&&global&&global.Object===Object&&global,At="object"==("undefined"==typeof self?"undefined":s(self))&&self&&self.Object===Object&&self,Rt=Ct||At||Function("return this")();var Tt,Et=(Tt={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"ss"},function(e){return null==Tt?void 0:Tt[e]});var xt=Object.prototype.toString,It=Rt.Symbol,Pt=It?It.prototype:void 0,Ot=Pt?Pt.toString:void 0;function Dt(e){if("string"==typeof e)return e;if(function(e){return"symbol"==s(e)||function(e){return!!e&&"object"==s(e)}(e)&&"[object Symbol]"==xt.call(e)}(e))return Ot?Ot.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function Mt(e){return null==e?"":Dt(e)}var Nt,Lt=(Nt=function(e,t,r){return e+(r?"_":"")+t.toLowerCase()},function(e){return function(e,t,r,n){var i=-1,a=e?e.length:0;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}(function(e,t,r){return e=Mt(e),void 0===(t=r?void 0:t)?function(e){return wt.test(e)}(e)?function(e){return e.match(kt)||[]}(e):function(e){return e.match(nt)||[]}(e):e.match(t)||[]}(function(e){return(e=Mt(e))&&e.replace(it,Et).replace(St,"")}(e).replace(_t,"")),Nt,"")});var Bt=a((function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(r,n)}e.exports=t}));var jt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bt(e,t)};var Ut=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var Ft=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?Ut(e):t},Vt=a((function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(r)}e.exports=t}));var zt=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")};var Gt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}},Ht=a((function(e){function t(r,n,i){return Gt()?e.exports=t=Reflect.construct:e.exports=t=function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&Bt(i,r.prototype),i},t.apply(null,arguments)}e.exports=t}));function Wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Vt(e);if(t){var i=Vt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ft(this,r)}}var qt=function(e){jt(n,e);var t=Wt(n);function n(e,i,a){var o;return r(this,n),e||rt.warning("You must specify message to create VError."),i||rt.warning("You must specify code to create VError."),(o=t.call(this,e)).code=i,a instanceof Error&&(o.stack=a.stack),o.name=o.constructor.name,rt.error("Code: ".concat(i,", Error: ").concat(e,".")),o}return n}(a((function(e){function t(r){var n="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){if(null===e||!zt(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return Ht(e,arguments,Vt(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Bt(t,e)},t(r)}e.exports=t}))(Error));qt.createByErr=function(e){if(!e)return new qt("unknow server error",qt.UNKNOW_SERVER_ERROR);var t=e.message||"unknow server error",r=parseInt(e.code)||qt.UNKNOW_SERVER_ERROR;return new qt(t,r=r>0?r+777e4:r-777e4)},qt.UNKNOW_SERVER_ERROR=-999,qt.UNKNOW_CLIENT_ERROR=-998,qt.ROOM_RECONNECTING=-997,qt.FATAL_FAILED=-996,qt.STREAM_ENDED=-899,qt.TRACK_ENDED=-898,qt.UNKNOW_ERROR=-897,qt.INVALID_TOKEN=-1e3,qt.JOIN_ROOM_ERROR=-1001,qt.NO_PUBLISH_PERMISSION=-1002,qt.NO_SUBSCRIBE_PERMISSION=-1003,qt.DUPLICATE_LOGIN=-1004,qt.GET_ROOM_INVALID_RESPONSE=-1005,qt.NOT_ACCEPTABLE=-1006,qt.INVALID_SDP=-1010,qt.TIMEOUT=-1050,qt.ADM_INIT_FAILE=-1020,qt.START_CALL=-1021,qt.ADM_NO_PERMISSION=-1022,qt.ADM_NO_MODIFY_PERMISSION=-1023,qt.RENDER_FAILED=-1030,qt.VDM_CAMERA_NOT_AUTHORIZED=-1040,qt.START_CAMERA=-1041,qt.INVALID_INVOKE_SEQUENCE=-1101,qt.INVALID_PARAMETERS=-1102,qt.UNKNOW=-1103,qt.AJAX_TIMEOUT=-1104,qt.AJAX_ERROR=-1105,qt.SOCKET_DISCONNECTED=-1106,qt.AI_SERVER_FAILED=-1107,qt.NO_SCREENSHARE_PLUGIN=-1108,qt.NOT_IN_ROOM=-1200,qt.SERVER_DISCONNECT_WEBSOCKET=-1300,qt.WEBSOCKET_RECONNECT_FAILED=-1301;for(var Jt=a((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}})),Zt=[],Kt=0;Kt<256;++Kt)Zt[Kt]=(Kt+256).toString(16).substr(1);var Qt=function(e,t){var r=t||0,n=Zt;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")};var Yt=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||Jt)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[n+a]=i[a];return t||Qt(i)};function Xt(e){return e instanceof Error?JSON.stringify(e,Object.getOwnPropertyNames(e)):JSON.stringify(e)}function $t(e){return Promise.all(e.map((function(e){return e.then((function(e){return Promise.reject(e)}),(function(e){return Promise.resolve(e)}))}))).then((function(e){return Promise.reject(e)}),(function(e){return Promise.resolve(e)}))}function er(){return(er=t(c.mark((function e(t){var r,n,i,a,o,s,d,u,l,p,f;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.urls,n=(new Date).getTime(),e.next=4,$t(r.map((function(e){return ir(e,{keys:["ntp"]})})));case 4:if(i=e.sent,a=(new Date).getTime(),!i||"success"!==i.message){e.next=16;break}return o=i.data,s=a-n,d=o.ntp,u=d.server_ip,l=d.timestamp,p=l-parseInt(s/2),f=p-n,window.server_client_offset_time=f,e.abrupt("return","getServerClientTimeOffset success : param : ".concat(JSON.stringify(t),",report_data : ").concat(JSON.stringify({clientTime:new Date,rtt:s,serverTimeStamp:l,serverIP:u,offsetTime:f})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tr(e){var t=!1;return function(){if(!t)return t=!0,e.apply(null,arguments)}}function rr(e,t,r){performance.measure(e,t,r);var n=performance.getEntriesByName(e)[0];return parseInt(n.duration)}function nr(e){var t={streamId:e};function r(t){return performance.getEntriesByName(e+t).length>0}return r("_mark1")&&r("_mark7")&&(t.total=rr(e+"_total",e+"_mark1",e+"_mark7")),r("_mark1")&&r("_mark2")&&(t.createPC=rr(e+"_createPC",e+"_mark1",e+"_mark2")),r("_mark2")&&r("_mark3")&&(t.setOffer=rr(e+"_setOffer",e+"_mark2",e+"_mark3")),r("_mark3")&&r("_mark4")&&(t.exchangeSDP=rr(e+"_exchangeSDP",e+"_mark3",e+"_mark4")),r("_mark4")&&r("_mark5")&&(t.setAnswer=rr(e+"_setAnswer",e+"_mark4",e+"_mark5")),r("_mark5")&&r("_mark6")&&(t.firstAudioFrame=rr(e+"_firstFrame",e+"_mark5",e+"_mark6")),r("_mark5")&&r("_mark7")&&(t.firstVideoFrame=rr(e+"_firstFrame",e+"_mark5",e+"_mark7")),function(e){[1,2,3,4,5,7].forEach((function(t){performance.clearMarks(e+"_mark"+t)})),["_total"].forEach((function(t){performance.clearMeasures(e+t)}))}(e),t}function ir(e,t){return rt.debug("http post url:",e,t),function(e,t,r,n,i){return new Promise((function(a,o){var s=new XMLHttpRequest;s.timeout=1e4,s.ontimeout=function(){o(new qt("request to '".concat(t,"' timeout"),qt.AJAX_TIMEOUT))},s.onerror=function(){o(new qt("request to '".concat(t,"' error"),qt.AJAX_ERROR))},s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||304===s.status){var e;"text"===i?e=s.responseText:(e=JSON.parse(s.responseText)).url=t,a(e)}else{var r=new qt(s.responseText||"req.onreadystatechange",s.status,s);o(r)}},s.open(e,t,!0),n&&s.setRequestHeader("Authorization",n.replace(/[\r\n]/g,"")),s.send(JSON.stringify(r))}))}("POST",e,t)}var ar=null;try{ar=window.localStorage}catch($r){var or={};ar={getItem:function(e){return or[e]||null},setItem:function(e,t){return or[e]=t},clear:function(){return or={}}}}function sr(){return ar.getItem("RTC_RECORD")||ar.setItem("RTC_RECORD",JSON.stringify(n({},"RTC_DEVICE_ID_USE_UUID",{data:Yt(),timestamp:Number.MAX_SAFE_INTEGER}))),JSON.parse(ar.getItem("RTC_RECORD"))}function cr(e,t){var r=sr(),n={data:t,timestamp:Date.now()};r[e]=n,ar.setItem("RTC_RECORD",JSON.stringify(r))}function dr(e,t){var r=sr()[e];return r&&Date.now()-r.timestamp<1e3*t?r.data:null}function ur(e){return dr(e,604800)}function lr(){var e=sr();Object.keys(e).forEach((function(t){dr(t,3600)||delete e[t]})),ar.setItem("RTC_RECORD",JSON.stringify(e))}function pr(e){return e.split("/")[2]}function fr(){var e=+"".concat(Math.random()).slice(-7).padEnd(7,"0");if(e>Math.pow(2,28)||e<0)throw new Error("illegal id ".concat(e,", the range of id is [0, 2^28]"));for(var t=e.toString(2).padEnd(28,"1").split(""),r=[];t.length;)r.push(t.splice(0,7));return r.map((function(e,t){var n=t===r.length-1?"0":"1";return Number.parseInt(n+e.join(""),2)}))}var hr=a((function(e,t){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==s(r))throw new TypeError(r+"must be non-object");for(var i in r)n(r,i)&&(e[i]=r[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},a={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(r)}));function mr(e){for(var t=e.length;--t>=0;)e[t]=0}var vr=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],gr=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],yr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],br=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_r=new Array(576);mr(_r);var Sr=new Array(60);mr(Sr);var kr=new Array(512);mr(kr);var wr=new Array(256);mr(wr);var Cr=new Array(29);mr(Cr);var Ar,Rr,Tr,Er=new Array(30);function xr(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function Ir(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Pr(e){return e<256?kr[e]:kr[256+(e>>>7)]}function Or(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function Dr(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,Or(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function Mr(e,t,r){Dr(e,r[2*t],r[2*t+1])}function Nr(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function Lr(e,t,r){var n,i,a=new Array(16),o=0;for(n=1;n<=15;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=Nr(a[s]++,s))}}function Br(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function jr(e){e.bi_valid>8?Or(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Ur(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function Fr(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&Ur(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Ur(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function Vr(e,t,r){var n,i,a,o,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?Mr(e,i,t):(Mr(e,(a=wr[i])+256+1,t),0!==(o=vr[a])&&Dr(e,i-=Cr[a],o),Mr(e,a=Pr(--n),r),0!==(o=gr[a])&&Dr(e,n-=Er[a],o))}while(s<e.last_lit);Mr(e,256,t)}function zr(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<c;r++)0!==a[2*r]?(e.heap[++e.heap_len]=d=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=d,r=e.heap_len>>1;r>=1;r--)Fr(e,a,r);i=c;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Fr(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,Fr(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,c=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,l=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,h=t.stat_desc.max_length,m=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(a=c[2*c[2*(n=e.heap[r])+1]+1]+1)>h&&(a=h,m++),c[2*n+1]=a,n>d||(e.bl_count[a]++,o=0,n>=f&&(o=p[n-f]),s=c[2*n],e.opt_len+=s*(a+o),l&&(e.static_len+=s*(u[2*n+1]+o)));if(0!==m){do{for(a=h-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[h]--,m-=2}while(m>0);for(a=h;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>d||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),n--)}}(e,t),Lr(a,d,e.bl_count)}function Gr(e,t,r){var n,i,a=-1,o=t[1],s=0,c=7,d=4;for(0===o&&(c=138,d=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<c&&i===o||(s<d?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4))}function Hr(e,t,r){var n,i,a=-1,o=t[1],s=0,c=7,d=4;for(0===o&&(c=138,d=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<c&&i===o)){if(s<d)do{Mr(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(Mr(e,i,e.bl_tree),s--),Mr(e,16,e.bl_tree),Dr(e,s-3,2)):s<=10?(Mr(e,17,e.bl_tree),Dr(e,s-3,3)):(Mr(e,18,e.bl_tree),Dr(e,s-11,7));s=0,a=i,0===o?(c=138,d=3):i===o?(c=6,d=3):(c=7,d=4)}}mr(Er);var Wr=!1;function qr(e,t,r,n){Dr(e,0+(n?1:0),3),function(e,t,r,n){jr(e),n&&(Or(e,r),Or(e,~r)),hr.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}var Jr={_tr_init:function(e){Wr||(!function(){var e,t,r,n,i,a=new Array(16);for(r=0,n=0;n<28;n++)for(Cr[n]=r,e=0;e<1<<vr[n];e++)wr[r++]=n;for(wr[r-1]=n,i=0,n=0;n<16;n++)for(Er[n]=i,e=0;e<1<<gr[n];e++)kr[i++]=n;for(i>>=7;n<30;n++)for(Er[n]=i<<7,e=0;e<1<<gr[n]-7;e++)kr[256+i++]=n;for(t=0;t<=15;t++)a[t]=0;for(e=0;e<=143;)_r[2*e+1]=8,e++,a[8]++;for(;e<=255;)_r[2*e+1]=9,e++,a[9]++;for(;e<=279;)_r[2*e+1]=7,e++,a[7]++;for(;e<=287;)_r[2*e+1]=8,e++,a[8]++;for(Lr(_r,287,a),e=0;e<30;e++)Sr[2*e+1]=5,Sr[2*e]=Nr(e,5);Ar=new xr(_r,vr,257,286,15),Rr=new xr(Sr,gr,0,30,15),Tr=new xr(new Array(0),yr,0,19,7)}(),Wr=!0),e.l_desc=new Ir(e.dyn_ltree,Ar),e.d_desc=new Ir(e.dyn_dtree,Rr),e.bl_desc=new Ir(e.bl_tree,Tr),e.bi_buf=0,e.bi_valid=0,Br(e)},_tr_stored_block:qr,_tr_flush_block:function(e,t,r,n){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),zr(e,e.l_desc),zr(e,e.d_desc),o=function(e){var t;for(Gr(e,e.dyn_ltree,e.l_desc.max_code),Gr(e,e.dyn_dtree,e.d_desc.max_code),zr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*br[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?qr(e,t,r,n):4===e.strategy||a===i?(Dr(e,2+(n?1:0),3),Vr(e,_r,Sr)):(Dr(e,4+(n?1:0),3),function(e,t,r,n){var i;for(Dr(e,t-257,5),Dr(e,r-1,5),Dr(e,n-4,4),i=0;i<n;i++)Dr(e,e.bl_tree[2*br[i]+1],3);Hr(e,e.dyn_ltree,t-1),Hr(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Vr(e,e.dyn_ltree,e.dyn_dtree)),Br(e),n&&jr(e)},_tr_tally:function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(wr[r]+256+1)]++,e.dyn_dtree[2*Pr(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){Dr(e,2,3),Mr(e,256,_r),function(e){16===e.bi_valid?(Or(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}};var Zr=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0};var Kr=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();var Qr,Yr=function(e,t,r,n){var i=Kr,a=n+r;e^=-1;for(var o=n;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Xr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function $r(e,t){return e.msg=Xr[t],t}function en(e){return(e<<1)-(e>4?9:0)}function tn(e){for(var t=e.length;--t>=0;)e[t]=0}function rn(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(hr.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function nn(e,t){Jr._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,rn(e.strm)}function an(e,t){e.pending_buf[e.pending++]=t}function on(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function sn(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,d=e.window,u=e.w_mask,l=e.prev,p=e.strstart+258,f=d[a+o-1],h=d[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(r=t)+o]===h&&d[r+o-1]===f&&d[r]===d[a]&&d[++r]===d[a+1]){a+=2,r++;do{}while(d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&d[++a]===d[++r]&&a<p);if(n=258-(p-a),a=p-258,n>o){if(e.match_start=t,o=n,n>=s)break;f=d[a+o-1],h=d[a+o]}}}while((t=l[t&u])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead}function cn(e){var t,r,n,i,a,o,s,c,d,u,l=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-262)){hr.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=l?n-l:0}while(--r);t=r=l;do{n=e.prev[--t],e.prev[t]=n>=l?n-l:0}while(--r);i+=l}if(0===e.strm.avail_in)break;if(o=e.strm,s=e.window,c=e.strstart+e.lookahead,d=i,u=void 0,(u=o.avail_in)>d&&(u=d),r=0===u?0:(o.avail_in-=u,hr.arraySet(s,o.input,o.next_in,u,c),1===o.state.wrap?o.adler=Zr(o.adler,s,u,c):2===o.state.wrap&&(o.adler=Yr(o.adler,s,u,c)),o.next_in+=u,o.total_in+=u,u),e.lookahead+=r,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+3-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function dn(e,t){for(var r,n;;){if(e.lookahead<262){if(cn(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=sn(e,r)),e.match_length>=3)if(n=Jr._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=Jr._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(nn(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(nn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(nn(e,!1),0===e.strm.avail_out)?1:2}function un(e,t){for(var r,n,i;;){if(e.lookahead<262){if(cn(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=sn(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Jr._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(nn(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=Jr._tr_tally(e,0,e.window[e.strstart-1]))&&nn(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Jr._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(nn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(nn(e,!1),0===e.strm.avail_out)?1:2}function ln(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function pn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new hr.Buf16(1146),this.dyn_dtree=new hr.Buf16(122),this.bl_tree=new hr.Buf16(78),tn(this.dyn_ltree),tn(this.dyn_dtree),tn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new hr.Buf16(16),this.heap=new hr.Buf16(573),tn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new hr.Buf16(573),tn(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function fn(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,Jr._tr_init(t),0):$r(e,-2)}function hn(e){var t,r=fn(e);return 0===r&&((t=e.state).window_size=2*t.w_size,tn(t.head),t.max_lazy_match=Qr[t.level].max_lazy,t.good_match=Qr[t.level].good_length,t.nice_match=Qr[t.level].nice_length,t.max_chain_length=Qr[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function mn(e,t,r,n,i,a){if(!e)return-2;var o=1;if(-1===t&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>9||8!==r||n<8||n>15||t<0||t>9||a<0||a>4)return $r(e,-2);8===n&&(n=9);var s=new pn;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new hr.Buf8(2*s.w_size),s.head=new hr.Buf16(s.hash_size),s.prev=new hr.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new hr.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=r,hn(e)}Qr=[new ln(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(cn(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,nn(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(nn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(nn(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(nn(e,!1),e.strm.avail_out),1)})),new ln(4,4,8,4,dn),new ln(4,5,16,8,dn),new ln(4,6,32,32,dn),new ln(4,4,16,16,un),new ln(8,16,32,32,un),new ln(8,16,128,128,un),new ln(8,32,128,256,un),new ln(32,128,258,1024,un),new ln(32,258,258,4096,un)];var vn={deflateInit:function(e,t){return mn(e,t,8,15,8,0)},deflateInit2:mn,deflateReset:hn,deflateResetKeep:fn,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},deflate:function(e,t){var r,n,i,a;if(!e||!e.state||t>5||t<0)return e?$r(e,-2):-2;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&4!==t)return $r(e,0===e.avail_out?-5:-2);if(n.strm=e,r=n.last_flush,n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,an(n,31),an(n,139),an(n,8),n.gzhead?(an(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),an(n,255&n.gzhead.time),an(n,n.gzhead.time>>8&255),an(n,n.gzhead.time>>16&255),an(n,n.gzhead.time>>24&255),an(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),an(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(an(n,255&n.gzhead.extra.length),an(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Yr(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(an(n,0),an(n,0),an(n,0),an(n,0),an(n,0),an(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),an(n,3),n.status=113);else{var o=8+(n.w_bits-8<<4)<<8;o|=(n.strategy>=2||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(o|=32),o+=31-o%31,n.status=113,on(n,o),0!==n.strstart&&(on(n,e.adler>>>16),on(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=Yr(e.adler,n.pending_buf,n.pending-i,i)),rn(e),i=n.pending,n.pending!==n.pending_buf_size));)an(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=Yr(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=Yr(e.adler,n.pending_buf,n.pending-i,i)),rn(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,an(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=Yr(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=Yr(e.adler,n.pending_buf,n.pending-i,i)),rn(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,an(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=Yr(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&rn(e),n.pending+2<=n.pending_buf_size&&(an(n,255&e.adler),an(n,e.adler>>8&255),e.adler=0,n.status=113)):n.status=113),0!==n.pending){if(rn(e),0===e.avail_out)return n.last_flush=-1,0}else if(0===e.avail_in&&en(t)<=en(r)&&4!==t)return $r(e,-5);if(666===n.status&&0!==e.avail_in)return $r(e,-5);if(0!==e.avail_in||0!==n.lookahead||0!==t&&666!==n.status){var s=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(cn(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=Jr._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(nn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(nn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(nn(e,!1),0===e.strm.avail_out)?1:2}(n,t):3===n.strategy?function(e,t){for(var r,n,i,a,o=e.window;;){if(e.lookahead<=258){if(cn(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=o[i=e.strstart-1])===o[++i]&&n===o[++i]&&n===o[++i]){a=e.strstart+258;do{}while(n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&n===o[++i]&&i<a);e.match_length=258-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Jr._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Jr._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(nn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(nn(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(nn(e,!1),0===e.strm.avail_out)?1:2}(n,t):Qr[n.level].func(n,t);if(3!==s&&4!==s||(n.status=666),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),0;if(2===s&&(1===t?Jr._tr_align(n):5!==t&&(Jr._tr_stored_block(n,0,0,!1),3===t&&(tn(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),rn(e),0===e.avail_out))return n.last_flush=-1,0}return 4!==t?0:n.wrap<=0?1:(2===n.wrap?(an(n,255&e.adler),an(n,e.adler>>8&255),an(n,e.adler>>16&255),an(n,e.adler>>24&255),an(n,255&e.total_in),an(n,e.total_in>>8&255),an(n,e.total_in>>16&255),an(n,e.total_in>>24&255)):(on(n,e.adler>>>16),on(n,65535&e.adler)),rn(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?0:1)},deflateEnd:function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?$r(e,-2):(e.state=null,113===t?$r(e,-3):0):-2},deflateSetDictionary:function(e,t){var r,n,i,a,o,s,c,d,u=t.length;if(!e||!e.state)return-2;if(2===(a=(r=e.state).wrap)||1===a&&42!==r.status||r.lookahead)return-2;for(1===a&&(e.adler=Zr(e.adler,t,u,0)),r.wrap=0,u>=r.w_size&&(0===a&&(tn(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new hr.Buf8(r.w_size),hr.arraySet(d,t,u-r.w_size,r.w_size,0),t=d,u=r.w_size),o=e.avail_in,s=e.next_in,c=e.input,e.avail_in=u,e.next_in=0,e.input=t,cn(r);r.lookahead>=3;){n=r.strstart,i=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=2,cn(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=c,e.avail_in=o,r.wrap=a,0},deflateInfo:"pako deflate (from Nodeca project)"},gn=!0,yn=!0;try{String.fromCharCode.apply(null,[0])}catch(e){gn=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){yn=!1}for(var bn=new hr.Buf8(256),_n=0;_n<256;_n++)bn[_n]=_n>=252?6:_n>=248?5:_n>=240?4:_n>=224?3:_n>=192?2:1;bn[254]=bn[254]=1;function Sn(e,t){if(t<65534&&(e.subarray&&yn||!e.subarray&&gn))return String.fromCharCode.apply(null,hr.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}var kn=function(e){var t,r,n,i,a,o=e.length,s=0;for(i=0;i<o;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new hr.Buf8(s),a=0,i=0;a<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},wn=function(e){return Sn(e,e.length)},Cn=function(e){for(var t=new hr.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},An=function(e,t){var r,n,i,a,o=t||e.length,s=new Array(2*o);for(n=0,r=0;r<o;)if((i=e[r++])<128)s[n++]=i;else if((a=bn[i])>4)s[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<o;)i=i<<6|63&e[r++],a--;a>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i)}return Sn(s,n)},Rn=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+bn[e[r]]>t?r:t};var Tn=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},En=Object.prototype.toString;function xn(e){if(!(this instanceof xn))return new xn(e);this.options=hr.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tn,this.strm.avail_out=0;var r=vn.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(Xr[r]);if(t.header&&vn.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?kn(t.dictionary):"[object ArrayBuffer]"===En.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=vn.deflateSetDictionary(this.strm,n)))throw new Error(Xr[r]);this._dict_set=!0}}function In(e,t){var r=new xn(t);if(r.push(e,!0),r.err)throw r.msg||Xr[r.err];return r.result}xn.prototype.push=function(e,t){var r,n,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=kn(e):"[object ArrayBuffer]"===En.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new hr.Buf8(a),i.next_out=0,i.avail_out=a),1!==(r=vn.deflate(i,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(wn(hr.shrinkBuf(i.output,i.next_out))):this.onData(hr.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==r);return 4===n?(r=vn.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==n||(this.onEnd(0),i.avail_out=0,!0)},xn.prototype.onData=function(e){this.chunks.push(e)},xn.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=hr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Pn={Deflate:xn,deflate:In,deflateRaw:function(e,t){return(t=t||{}).raw=!0,In(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,In(e,t)}},On=function(e,t){var r,n,i,a,o,s,c,d,u,l,p,f,h,m,v,g,y,b,_,S,k,w,C,A,R;r=e.state,n=e.next_in,A=e.input,i=n+(e.avail_in-5),a=e.next_out,R=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),c=r.dmax,d=r.wsize,u=r.whave,l=r.wnext,p=r.window,f=r.hold,h=r.bits,m=r.lencode,v=r.distcode,g=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{h<15&&(f+=A[n++]<<h,h+=8,f+=A[n++]<<h,h+=8),b=m[f&g];t:for(;;){if(f>>>=_=b>>>24,h-=_,0===(_=b>>>16&255))R[a++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=m[(65535&b)+(f&(1<<_)-1)];continue t}if(32&_){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}S=65535&b,(_&=15)&&(h<_&&(f+=A[n++]<<h,h+=8),S+=f&(1<<_)-1,f>>>=_,h-=_),h<15&&(f+=A[n++]<<h,h+=8,f+=A[n++]<<h,h+=8),b=v[f&y];r:for(;;){if(f>>>=_=b>>>24,h-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=v[(65535&b)+(f&(1<<_)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(k=65535&b,h<(_&=15)&&(f+=A[n++]<<h,(h+=8)<_&&(f+=A[n++]<<h,h+=8)),(k+=f&(1<<_)-1)>c){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=_,h-=_,k>(_=a-o)){if((_=k-_)>u&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(w=0,C=p,0===l){if(w+=d-_,_<S){S-=_;do{R[a++]=p[w++]}while(--_);w=a-k,C=R}}else if(l<_){if(w+=d+l-_,(_-=l)<S){S-=_;do{R[a++]=p[w++]}while(--_);if(w=0,l<S){S-=_=l;do{R[a++]=p[w++]}while(--_);w=a-k,C=R}}}else if(w+=l-_,_<S){S-=_;do{R[a++]=p[w++]}while(--_);w=a-k,C=R}for(;S>2;)R[a++]=C[w++],R[a++]=C[w++],R[a++]=C[w++],S-=3;S&&(R[a++]=C[w++],S>1&&(R[a++]=C[w++]))}else{w=a-k;do{R[a++]=R[w++],R[a++]=R[w++],R[a++]=R[w++],S-=3}while(S>2);S&&(R[a++]=R[w++],S>1&&(R[a++]=R[w++]))}break}}break}}while(n<i&&a<s);n-=S=h>>3,f&=(1<<(h-=S<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=h},Dn=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Mn=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Nn=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Ln=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Bn=function(e,t,r,n,i,a,o,s){var c,d,u,l,p,f,h,m,v,g=s.bits,y=0,b=0,_=0,S=0,k=0,w=0,C=0,A=0,R=0,T=0,E=null,x=0,I=new hr.Buf16(16),P=new hr.Buf16(16),O=null,D=0;for(y=0;y<=15;y++)I[y]=0;for(b=0;b<n;b++)I[t[r+b]]++;for(k=g,S=15;S>=1&&0===I[S];S--);if(k>S&&(k=S),0===S)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(_=1;_<S&&0===I[_];_++);for(k<_&&(k=_),A=1,y=1;y<=15;y++)if(A<<=1,(A-=I[y])<0)return-1;if(A>0&&(0===e||1!==S))return-1;for(P[1]=0,y=1;y<15;y++)P[y+1]=P[y]+I[y];for(b=0;b<n;b++)0!==t[r+b]&&(o[P[t[r+b]]++]=b);if(0===e?(E=O=o,f=19):1===e?(E=Dn,x-=257,O=Mn,D-=257,f=256):(E=Nn,O=Ln,f=-1),T=0,b=0,y=_,p=a,w=k,C=0,u=-1,l=(R=1<<k)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){h=y-C,o[b]<f?(m=0,v=o[b]):o[b]>f?(m=O[D+o[b]],v=E[x+o[b]]):(m=96,v=0),c=1<<y-C,_=d=1<<w;do{i[p+(T>>C)+(d-=c)]=h<<24|m<<16|v|0}while(0!==d);for(c=1<<y-1;T&c;)c>>=1;if(0!==c?(T&=c-1,T+=c):T=0,b++,0==--I[y]){if(y===S)break;y=t[r+o[b]]}if(y>k&&(T&l)!==u){for(0===C&&(C=k),p+=_,A=1<<(w=y-C);w+C<S&&!((A-=I[w+C])<=0);)w++,A<<=1;if(R+=1<<w,1===e&&R>852||2===e&&R>592)return 1;i[u=T&l]=k<<24|w<<16|p-a|0}}return 0!==T&&(i[p+T]=y-C<<24|64<<16|0),s.bits=k,0};function jn(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Un(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new hr.Buf16(320),this.work=new hr.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Fn(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new hr.Buf32(852),t.distcode=t.distdyn=new hr.Buf32(592),t.sane=1,t.back=-1,0):-2}function Vn(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,Fn(e)):-2}function zn(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,Vn(e))):-2}function Gn(e,t){var r,n;return e?(n=new Un,e.state=n,n.window=null,0!==(r=zn(e,t))&&(e.state=null),r):-2}var Hn,Wn,qn=!0;function Jn(e){if(qn){var t;for(Hn=new hr.Buf32(512),Wn=new hr.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Bn(1,e.lens,0,288,Hn,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Bn(2,e.lens,0,32,Wn,0,e.work,{bits:5}),qn=!1}e.lencode=Hn,e.lenbits=9,e.distcode=Wn,e.distbits=5}function Zn(e,t,r,n){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new hr.Buf8(a.wsize)),n>=a.wsize?(hr.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>n&&(i=n),hr.arraySet(a.window,t,r-n,i,a.wnext),(n-=i)?(hr.arraySet(a.window,t,r-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}var Kn={inflateReset:Vn,inflateReset2:zn,inflateResetKeep:Fn,inflateInit:function(e){return Gn(e,15)},inflateInit2:Gn,inflate:function(e,t){var r,n,i,a,o,s,c,d,u,l,p,f,h,m,v,g,y,b,_,S,k,w,C,A,R=0,T=new hr.Buf8(4),E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(r=e.state).mode&&(r.mode=13),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,n=e.input,s=e.avail_in,d=r.hold,u=r.bits,l=s,p=c,w=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(2&r.wrap&&35615===d){r.check=0,T[0]=255&d,T[1]=d>>>8&255,r.check=Yr(r.check,T,2,0),d=0,u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&d)){e.msg="unknown compression method",r.mode=30;break}if(u-=4,k=8+(15&(d>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<k,e.adler=r.check=1,r.mode=512&d?10:12,d=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(r.flags=d,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=d>>8&1),512&r.flags&&(T[0]=255&d,T[1]=d>>>8&255,r.check=Yr(r.check,T,2,0)),d=0,u=0,r.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.head&&(r.head.time=d),512&r.flags&&(T[0]=255&d,T[1]=d>>>8&255,T[2]=d>>>16&255,T[3]=d>>>24&255,r.check=Yr(r.check,T,4,0)),d=0,u=0,r.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.head&&(r.head.xflags=255&d,r.head.os=d>>8),512&r.flags&&(T[0]=255&d,T[1]=d>>>8&255,r.check=Yr(r.check,T,2,0)),d=0,u=0,r.mode=5;case 5:if(1024&r.flags){for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.length=d,r.head&&(r.head.extra_len=d),512&r.flags&&(T[0]=255&d,T[1]=d>>>8&255,r.check=Yr(r.check,T,2,0)),d=0,u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((f=r.length)>s&&(f=s),f&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),hr.arraySet(r.head.extra,n,a,f,k)),512&r.flags&&(r.check=Yr(r.check,n,f,a)),s-=f,a+=f,r.length-=f),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===s)break e;f=0;do{k=n[a+f++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k))}while(k&&f<s);if(512&r.flags&&(r.check=Yr(r.check,n,f,a)),s-=f,a+=f,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===s)break e;f=0;do{k=n[a+f++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k))}while(k&&f<s);if(512&r.flags&&(r.check=Yr(r.check,n,f,a)),s-=f,a+=f,k)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;u<16;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(d!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}d=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}e.adler=r.check=jn(d),d=0,u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,r.hold=d,r.bits=u,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){d>>>=7&u,u-=7&u,r.mode=27;break}for(;u<3;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}switch(r.last=1&d,u-=1,3&(d>>>=1)){case 0:r.mode=14;break;case 1:if(Jn(r),r.mode=20,6===t){d>>>=2,u-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}d>>>=2,u-=2;break;case 14:for(d>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&d,d=0,u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(f=r.length){if(f>s&&(f=s),f>c&&(f=c),0===f)break e;hr.arraySet(i,n,a,f,o),s-=f,a+=f,c-=f,o+=f,r.length-=f;break}r.mode=12;break;case 17:for(;u<14;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(r.nlen=257+(31&d),d>>>=5,u-=5,r.ndist=1+(31&d),d>>>=5,u-=5,r.ncode=4+(15&d),d>>>=4,u-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;u<3;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.lens[E[r.have++]]=7&d,d>>>=3,u-=3}for(;r.have<19;)r.lens[E[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C={bits:r.lenbits},w=Bn(0,r.lens,0,19,r.lencode,0,r.work,C),r.lenbits=C.bits,w){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;g=(R=r.lencode[d&(1<<r.lenbits)-1])>>>16&255,y=65535&R,!((v=R>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(y<16)d>>>=v,u-=v,r.lens[r.have++]=y;else{if(16===y){for(A=v+2;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(d>>>=v,u-=v,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}k=r.lens[r.have-1],f=3+(3&d),d>>>=2,u-=2}else if(17===y){for(A=v+3;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}u-=v,k=0,f=3+(7&(d>>>=v)),d>>>=3,u-=3}else{for(A=v+7;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}u-=v,k=0,f=11+(127&(d>>>=v)),d>>>=7,u-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;f--;)r.lens[r.have++]=k}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,C={bits:r.lenbits},w=Bn(1,r.lens,0,r.nlen,r.lencode,0,r.work,C),r.lenbits=C.bits,w){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,C={bits:r.distbits},w=Bn(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,C),r.distbits=C.bits,w){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,r.hold=d,r.bits=u,On(e,p),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,n=e.input,s=e.avail_in,d=r.hold,u=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;g=(R=r.lencode[d&(1<<r.lenbits)-1])>>>16&255,y=65535&R,!((v=R>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(g&&0==(240&g)){for(b=v,_=g,S=y;g=(R=r.lencode[S+((d&(1<<b+_)-1)>>b)])>>>16&255,y=65535&R,!(b+(v=R>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}d>>>=b,u-=b,r.back+=b}if(d>>>=v,u-=v,r.back+=v,r.length=y,0===g){r.mode=26;break}if(32&g){r.back=-1,r.mode=12;break}if(64&g){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&g,r.mode=22;case 22:if(r.extra){for(A=r.extra;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.length+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;g=(R=r.distcode[d&(1<<r.distbits)-1])>>>16&255,y=65535&R,!((v=R>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(0==(240&g)){for(b=v,_=g,S=y;g=(R=r.distcode[S+((d&(1<<b+_)-1)>>b)])>>>16&255,y=65535&R,!(b+(v=R>>>24)<=u);){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}d>>>=b,u-=b,r.back+=b}if(d>>>=v,u-=v,r.back+=v,64&g){e.msg="invalid distance code",r.mode=30;break}r.offset=y,r.extra=15&g,r.mode=24;case 24:if(r.extra){for(A=r.extra;u<A;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}r.offset+=d&(1<<r.extra)-1,d>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===c)break e;if(f=p-c,r.offset>f){if((f=r.offset-f)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}f>r.wnext?(f-=r.wnext,h=r.wsize-f):h=r.wnext-f,f>r.length&&(f=r.length),m=r.window}else m=i,h=o-r.offset,f=r.length;f>c&&(f=c),c-=f,r.length-=f;do{i[o++]=m[h++]}while(--f);0===r.length&&(r.mode=21);break;case 26:if(0===c)break e;i[o++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;u<32;){if(0===s)break e;s--,d|=n[a++]<<u,u+=8}if(p-=c,e.total_out+=p,r.total+=p,p&&(e.adler=r.check=r.flags?Yr(r.check,i,p,o-p):Zr(r.check,i,p,o-p)),p=c,(r.flags?d:jn(d))!==r.check){e.msg="incorrect data check",r.mode=30;break}d=0,u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;u<32;){if(0===s)break e;s--,d+=n[a++]<<u,u+=8}if(d!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}d=0,u=0}r.mode=29;case 29:w=1;break e;case 30:w=-3;break e;case 31:return-4;case 32:default:return-2}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,r.hold=d,r.bits=u,(r.wsize||p!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&Zn(e,e.output,e.next_out,p-e.avail_out),l-=e.avail_in,p-=e.avail_out,e.total_in+=l,e.total_out+=p,r.total+=p,r.wrap&&p&&(e.adler=r.check=r.flags?Yr(r.check,i,p,e.next_out-p):Zr(r.check,i,p,e.next_out-p)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===p||4===t)&&0===w&&(w=-5),w},inflateEnd:function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflateGetHeader:function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?-2:(r.head=t,t.done=!1,0):-2},inflateSetDictionary:function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?-2:11===r.mode&&Zr(1,t,n,0)!==r.check?-3:Zn(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):-2},inflateInfo:"pako inflate (from Nodeca project)"},Qn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var Yn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Xn=Object.prototype.toString;function $n(e){if(!(this instanceof $n))return new $n(e);this.options=hr.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tn,this.strm.avail_out=0;var r=Kn.inflateInit2(this.strm,t.windowBits);if(r!==Qn.Z_OK)throw new Error(Xr[r]);if(this.header=new Yn,Kn.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=kn(t.dictionary):"[object ArrayBuffer]"===Xn.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Kn.inflateSetDictionary(this.strm,t.dictionary))!==Qn.Z_OK))throw new Error(Xr[r])}function ei(e,t){var r=new $n(t);if(r.push(e,!0),r.err)throw r.msg||Xr[r.err];return r.result}$n.prototype.push=function(e,t){var r,n,i,a,o,s=this.strm,c=this.options.chunkSize,d=this.options.dictionary,u=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?Qn.Z_FINISH:Qn.Z_NO_FLUSH,"string"==typeof e?s.input=Cn(e):"[object ArrayBuffer]"===Xn.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new hr.Buf8(c),s.next_out=0,s.avail_out=c),(r=Kn.inflate(s,Qn.Z_NO_FLUSH))===Qn.Z_NEED_DICT&&d&&(r=Kn.inflateSetDictionary(this.strm,d)),r===Qn.Z_BUF_ERROR&&!0===u&&(r=Qn.Z_OK,u=!1),r!==Qn.Z_STREAM_END&&r!==Qn.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==Qn.Z_STREAM_END&&(0!==s.avail_in||n!==Qn.Z_FINISH&&n!==Qn.Z_SYNC_FLUSH)||("string"===this.options.to?(i=Rn(s.output,s.next_out),a=s.next_out-i,o=An(s.output,i),s.next_out=a,s.avail_out=c-a,a&&hr.arraySet(s.output,s.output,i,a,0),this.onData(o)):this.onData(hr.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(u=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==Qn.Z_STREAM_END);return r===Qn.Z_STREAM_END&&(n=Qn.Z_FINISH),n===Qn.Z_FINISH?(r=Kn.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Qn.Z_OK):n!==Qn.Z_SYNC_FLUSH||(this.onEnd(Qn.Z_OK),s.avail_out=0,!0)},$n.prototype.onData=function(e){this.chunks.push(e)},$n.prototype.onEnd=function(e){e===Qn.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=hr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ti={Inflate:$n,inflate:ei,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ei(e,t)},ungzip:ei},ri={};(0,hr.assign)(ri,Pn,ti,Qn);var ni=ri,ii={version:"3.21.0",ntpServerUrls:"",logServerUrl:"https://log.snssdk.com/video/v1/webrtc_log/",global:{compressReport:!0}},ai="counter",oi="store",si={rtc_sdk_self:822,rtc_join_room:823,rtc_get_config:824,rtc_leave_room:825,rtc_publish:826,rtc_unpublish:832,rtc_subscribe:833,rtc_unsubscribe:834,rtc_websocket:835,rtc_signaling:836,rtc_server_signaling:842,rtc_create_media:843,rtc_create_offer:844,rtc_recv_answer:845,rtc_set_description:846,rtc_ice:852,rtc_transport:853,rtc_reconnect:854,rtc_account:855,rtc_sdk_api_call:856,oner_signaling:736,oner_update_rtc_provider:771},ci=ur("RTC_DEVICE_ID_USE_UUID"),di=0,ui=0,li=!1;function pi(){li=!0}var fi=new function e(){r(this,e),this.product_line="rtc",this.project_key="_app_name_",this.report_version="5",this.rtc_sdk_version=ii.version,this.oner_sdk_version=ii.version,this.rtc_sdk_version_num=ii.version.split(".").map((function(e,t){return parseInt(e)*Math.pow(10,[12,9,6,0][t])})).reduce((function(e,t){return e+t}),0),this.user_agent=window.navigator.userAgent,this.device_id=ci,this.engine_id=Yt(),this.rtc_app_id="",this.oner_app_id="",this.rtc_business_id=""},hi=[],mi=function(){function e(t){var n=this;r(this,e),this.postHeader=fi,this.sessionId=null,this.isInRoom=0,this.connection_id=null,this.dataBuffer=hi,this.sentNtpMessage=!1,this.sliceObjectDepthForLog=Ci,t&&t.default&&(setInterval(this.sendToLogServer.bind(this),5e3),window.addEventListener("unload",(function(){try{n.sendToLogServer(!0)}catch(e){}})))}return Ee(e,[{key:"getEngineId",value:function(){return this.postHeader.engine_id}},{key:"setConfigServerHost",value:function(e){this.postHeader.config_server=e}},{key:"getConfigServerHost",value:function(){return this.postHeader.config_server}},{key:"setAid",value:function(e){this.postHeader.aid=e}},{key:"getDeviceId",value:function(){return this.postHeader.device_id}},{key:"setProductLine",value:function(e){this.postHeader.product_line=e}},{key:"setRtcProvider",value:function(e){this.postHeader.oner_provider=e}},{key:"setOnerAppId",value:function(e){this.postHeader.oner_app_id=e}},{key:"getOnerAppId",value:function(){return this.postHeader.oner_app_id}},{key:"setBusinessId",value:function(e){this.postHeader.rtc_business_id=e}},{key:"getBusinessId",value:function(){return this.postHeader.rtc_business_id}},{key:"setOnerRoomId",value:function(e){this.postHeader.oner_room_id=e}},{key:"setLogDomain",value:function(e){ii.logServerUrl="https://".concat(e,"/video/v1/webrtc_log/")}},{key:"setOnerUserId",value:function(e){this.postHeader.oner_user_id=e}},{key:"setAppId",value:function(e){this.postHeader.rtc_app_id=e}},{key:"getAppId",value:function(){return this.postHeader.rtc_app_id}},{key:"setCallId",value:function(e){this.postHeader.rtc_call_id=e}},{key:"getCallId",value:function(){return this.postHeader.rtc_call_id}},{key:"setRoomId",value:function(e){this.postHeader.room_id=e}},{key:"getRoomId",value:function(){return this.postHeader.room_id}},{key:"setUserId",value:function(e){this.postHeader.user_id=e}},{key:"getUserId",value:function(){return this.postHeader.user_id}},{key:"setHeader",value:function(e,t){if(ui>=8)return!1;if("string"!=typeof e)return!1;var r=Lt("ex_".concat(e));return void 0===this.postHeader[r]&&(this.postHeader[r]=t,ui++,!0)}},{key:"getAndSetSessionId",value:function(){return this.sessionId=Yt(),this.sessionId}},{key:"setInRoom",value:function(e){this.isInRoom=e?1:0}},{key:"setConnectionId",value:function(e){this.connection_id=e}},{key:"getInRoom",value:function(){return!!this.isInRoom}},{key:"getNtpOffsetOnce",value:function(){!window.gotNtpOffset&&function(e){return er.apply(this,arguments)}({urls:ii.ntpServerUrls,sdkVersion:ii.version}).then((function(e){})).catch((function(e){})),window.gotNtpOffset=!0}},{key:"sendToLogServer",value:function(e){var t=this;if(li&&(this.getNtpOffsetOnce(),!(this.dataBuffer.length<=0)&&ii.logServerUrl)){var r={data:this.dataBuffer.splice(0,4e3),header:this.postHeader,from:"web",os:"web",version:"1"};if(r.header.report_time=new Date,r.header.report_log_count=r.data.length,e)navigator.sendBeacon(ii.logServerUrl,JSON.stringify(r));else{var n=new XMLHttpRequest;n.timeout=1e4,n.ontimeout=a,n.onerror=a,n.onreadystatechange=function(){if(4===n.readyState){var e,t;if(200===n.status||304===n.status)try{e=JSON.parse(n.responseText)}catch(e){t=e}e&&0===e.StatusCode||a(t||n)}},n.open("POST",ii.logServerUrl,!0);var i=ni.gzip(JSON.stringify(r));n.setRequestHeader("Content-Encoding","gzip"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(i)}}function a(e){rt.verbose("[".concat(t.postHeader.product_line,"]post log error"),e),0!==r.data.length?(r.data.splice(2e3,1/0),Array.prototype.splice.apply(t.dataBuffer,[0,0].concat(r.data)),t.dataBuffer.splice(4e3,1/0),r.data=[]):rt.verbose("[".concat(t.postHeader.product_line,"]post log error has processed"))}}},{key:"eventLog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.addLogToBuffer(Object.assign({},this.formatJson("event",e,t,r,n)))}},{key:"metricsLog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;a=a||("number"==typeof t?ai:oi),this.addLogToBuffer(Object.assign({metric_value:t,metric_type:a},this.formatJson("metrics",e,r,n,i)))}},{key:"addLogToBuffer",value:function(e){var t=Object.assign({},e);this.dataBuffer.length<3999?this.dataBuffer.push(t):3999===this.dataBuffer.length&&this.dataBuffer.push({report_id:di++,event_type:t.event_type,event_key:"rtc_warning",message:"reach log dataBuffer limit: ".concat(this.dataBuffer.length)})}},{key:"formatJson",value:function(e,t,r,n,i){var a={event_type:e,event_key:t,error_code:0,report_id:di++,in_room:this.isInRoom,connection_id:this.connection_id,session_id:this.sessionId,time:(new Date).getTime()};for(var o in r)o.startsWith("$")?a[o.slice(1)]=r[o]:"metrics"!==e&&(a[o]=r[o]);if(r.event_starttime&&(a.elapse=new Date-r.event_starttime),i&&i.message&&(a.message=i.message),n){n.message&&(a.message=n.message);var s=parseInt(n.code);(isNaN(s)||0>=s||s>9999)&&(s=9999,a.message+="(err.code:".concat(n.code,")")),a.error_code=1e4*(si[t]||999)+s}return a}}]),e}();mi.default=new mi({default:!0}),mi.create=function(e){return new mi(e)};var vi=mi.default.eventLog.bind(mi.default),gi=mi.default.setConfigServerHost.bind(mi.default),yi=(mi.default.getConfigServerHost.bind(mi.default),mi.default.getDeviceId.bind(mi.default)),bi=(mi.default.setProductLine.bind(mi.default),mi.default.setRtcProvider.bind(mi.default),mi.default.getOnerAppId.bind(mi.default),mi.default.setOnerAppId.bind(mi.default),mi.default.getBusinessId.bind(mi.default)),_i=mi.default.setBusinessId.bind(mi.default),Si=mi.default.setAid.bind(mi.default),ki=(mi.default.setOnerRoomId.bind(mi.default),mi.default.setOnerUserId.bind(mi.default),mi.default.getAppId.bind(mi.default),mi.default.setAppId.bind(mi.default),mi.default.getRoomId.bind(mi.default),mi.default.setLogDomain.bind(mi.default),mi.default.setRoomId.bind(mi.default),mi.default.getUserId.bind(mi.default),mi.default.setUserId.bind(mi.default),mi.default.setHeader.bind(mi.default));mi.default.getAndSetSessionId.bind(mi.default),mi.default.setInRoom.bind(mi.default),mi.default.setConnectionId.bind(mi.default),mi.default.getInRoom.bind(mi.default),mi.default.getEngineId.bind(mi.default);function wi(e){var t={};return e&&(t.stream_id=e.getServerId(),t.vid=e.getId(),t.stream_user_id=e.uid,t.direction=e.local?"up":"down",t.stream_state_description=e.getState().toString(),t.stream_attempts=e.attempts||0,t.event_starttime=e.__logSignaling.event_starttime,e.pc&&(t.pc_session_id=e.pc.pc_session_id)),Object.keys(t).forEach((function(e){t[e]||0===t[e]||delete t[e]})),t}function Ci(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e)return e;switch(s(e)){case"object":if(e.class)return e.class;if(t){var r,n;for(var i in e instanceof Array?(r=[],n=t):(r={},n=t-1),e)r[i]=Ci(e[i],n);return r}return e instanceof Array?"[...]":"{...}";case"function":return"()=>{}";default:return e}}var Ai=function(e,t){var r=e;r||(console.assert(r,t),vi("assert_error",{message:t}))},Ri=function(e){var t=e||{},r={eventListeners:{}};return t.addEventListener=function(e,t){void 0===r.eventListeners[e]&&(r.eventListeners[e]=[]),r.eventListeners[e].push(t)},t.removeEventListener=function(e,t){if(r.eventListeners[e]){var n=r.eventListeners[e].indexOf(t);-1!==n&&r.eventListeners[e].splice(n,1)}},t.dispatchEvent=function(e){if(!e||!e.type)throw new Error("Undefined event");for(var t=r.eventListeners[e.type]||[],n=0;n<t.length;n+=1)t[n](e)},t.removeAllEventListeners=function(){r.eventListeners={}},t.on=t.addEventListener,t.off=t.removeEventListener,t.emit=t.dispatchEvent,t},Ti=function(e){var t={};return t.type=e.type,t.code=e.code,t.message=e.message,t},Ei=function(e){var t=Ti(e);return Object.assign(t,e),t},xi=function(e){var t=Ti(e);return t.stream=e.stream,t.message=e.message,t.bandwidth=e.bandwidth,t.attributes=e.attributes,t.options=e.options,t.state=e.state,t},Ii=function(e){var t=Ti(e);return t.stream=e.stream,t.state=e.state,t},Pi=function(){function e(){r(this,e),this.emitter=Ri()}return Ee(e,[{key:"addEventListener",value:function(e,t){this.emitter.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.emitter.removeEventListener(e,t)}},{key:"dispatchEvent",value:function(e){this.emitter.dispatchEvent(e)}},{key:"on",value:function(e,t){this.addEventListener(e,t)}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}},{key:"emit",value:function(e){this.dispatchEvent(e)}}]),e}(),Oi=Object.freeze({__proto__:null,EventDispatcher:Ri,LicodeEvent:Ti,RoomEvent:Ei,StreamEvent:xi,PublisherEvent:function(e){return Ti(e)},EventEmitter:Pi,ConnectionEvent:Ii}),Di=function(){var e="none";return null!==window.navigator.userAgent.match("Firefox")?e="mozilla":null!==window.navigator.userAgent.match("Chrome")?(e="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(e="electron")):(null!==window.navigator.userAgent.match("Safari")||null!==window.navigator.userAgent.match("AppleWebKit"))&&(e="safari"),e},Mi=function(){return"safari"===Di()},Ni=function(){return"chrome-stable"===Di()};new Je;var Li={GetUserMedia:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=function(e,t,r){navigator.mediaDevices.getUserMedia(e).then(t,r)},a=function(e,t,r){navigator.mediaDevices.getDisplayMedia(e).then(t,r)},o=function(e){var t={video:e.video,audio:!!e.screenAudio};return rt.debug("getDisplayMedia config:",t),t},s=function(){switch(rt.debug("Screen access requested"),Di()){case"electron":if(rt.debug("Screen sharing in Electron"),e.desktopStreamId)(t={}).video={},rt.debug("screen video config",JSON.stringify(e.video)),t.video.mandatory=e.video.mandatory||{},t.video.mandatory.chromeMediaSource="desktop",t.video.mandatory.chromeMediaSourceId=e.desktopStreamId,e.video.height&&(t.video.mandatory.minHeight=e.video.height.min,t.video.mandatory.maxHeight=e.video.height.max),e.video.width&&(t.video.mandatory.minWidth=e.video.width.min,t.video.mandatory.maxWidth=e.video.width.max);else{var s=!1,c=!1;e.audio&&(s=!0===e.audio?{}:e.audio,Object.assign(s,{mandatory:{chromeMediaSource:"desktop"}})),e.video&&(c=!0===e.video?{}:e.video,Object.assign(c,{mandatory:{chromeMediaSource:"desktop"}})),t={audio:s,video:c}}rt.debug("Screen sharing in Electron getUserMedia",t),i(t,r,n);break;case"mozilla":rt.debug("Screen sharing in Firefox"),t={},void 0!==e.video?(t.video=e.video,t.video.mediaSource||(t.video.mediaSource="window")):t={audio:e.audio,video:{mediaSource:"window"}},i(t,r,n);break;case"chrome-stable":if(rt.debug("Screen sharing in Chrome"),t={},e.desktopStreamId)t.video=e.video||{mandatory:{}},t.video.mandatory=t.video.mandatory||{},t.video.mandatory.chromeMediaSource="desktop",t.video.mandatory.chromeMediaSourceId=e.desktopStreamId,t.audio=e.screenAudio,i(t,r,n);else if(e.extensionId){var d=e.extensionId;rt.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(d,{getStream:!0},(function(a){if(void 0!==a){var o=a.streamId;void 0!==e.video.mandatory?(t.video=e.video||{mandatory:{}},t.video.mandatory.chromeMediaSource="desktop",t.video.mandatory.chromeMediaSourceId=o):t={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o}}},i(t,r,n)}else{rt.error("Access to screen denied");n({code:"Access to screen denied"})}}))}catch(e){rt.debug("Screensharing plugin is not accessible ");n({code:"no_plugin_present"})}}else a(o(e),r,n);break;case"safari":a(o(e),r,n);break;default:rt.error("This browser does not support ScreenSharing")}};e.screen?s():(rt.debug("Calling getUserMedia with config",e),i(e,r,n))}},Bi=(a((function(e,t){var r;e.exports=function e(t,r,n){function i(s,c){if(!r[s]){if(!t[s]){if(!c&&o)return o(s);if(a)return a(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=r[s]={exports:{}};t[s][0].call(u.exports,(function(e){var r=t[s][1][e];return i(r||e)}),u,u.exports,e,t,r,n)}return r[s].exports}for(var a=o,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,r){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(e,t,r){(function(r){var n=e("./transports"),i=e("component-emitter"),a=e("debug")("engine.io-client:socket"),o=e("indexof"),c=e("engine.io-parser"),d=e("parseuri"),u=e("parsejson"),l=e("parseqs");function p(e,t){if(!(this instanceof p))return new p(e,t);t=t||{},e&&"object"==s(e)&&(t=e,e=null),e?(e=d(e),t.hostname=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=d(t.host).host),this.secure=null!=t.secure?t.secure:r.location&&"https:"==location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||(r.location?location.hostname:"localhost"),this.port=t.port||(r.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized?null:t.rejectUnauthorized;var n="object"==s(r)&&r;n.global===n&&t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),this.open()}function f(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}t.exports=p,p.priorWebsocketSuccess=!1,i(p.prototype),p.protocol=c.protocol,p.Socket=p,p.Transport=e("./transport"),p.transports=e("./transports"),p.parser=e("engine.io-parser"),p.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=f(this.query);return t.EIO=c.protocol,t.transport=e,this.id&&(t.sid=this.id),new n[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders})},p.prototype.open=function(){var e;if(this.rememberUpgrade&&p.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},p.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},p.prototype.probe=function(e){a('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(a('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(i){if(!r)if("pong"==i.type&&"probe"==i.data){if(a('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;p.priorWebsocketSuccess="websocket"==t.name,a('pausing current transport "%s"',n.transport.name),n.transport.pause((function(){r||"closed"!=n.readyState&&(a("changing transport and sending upgrade packet"),l(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())}))}else{a('probe transport "%s" failed',e);var o=new Error("probe error");o.transport=t.name,n.emit("upgradeError",o)}})))}function o(){r||(r=!0,l(),t.close(),t=null)}function s(r){var i=new Error("probe error: "+r);i.transport=t.name,o(),a('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",i)}function c(){s("transport closed")}function d(){s("socket closed")}function u(e){t&&e.name!=t.name&&(a('"%s" works - aborting "%s"',e.name,t.name),o())}function l(){t.removeListener("open",i),t.removeListener("error",s),t.removeListener("close",c),n.removeListener("close",d),n.removeListener("upgrading",u)}p.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",s),t.once("close",c),this.once("close",d),this.once("upgrading",u),t.open()},p.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",p.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},p.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},p.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},p.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!=t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},p.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},p.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},p.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},p.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},p.prototype.write=p.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},p.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!=this.readyState&&"closed"!=this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},p.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():t()})):this.upgrading?n():t()}function t(){e.onClose("forced close"),a("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},p.prototype.onError=function(e){a("socket error %j",e),p.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},p.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){a('socket close with reason: "%s"',e);var r=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),r.writeBuffer=[],r.prevBufferLen=0}},p.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~o(this.transports,e[r])&&t.push(e[r]);return t}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(e,t,r){var n=e("engine.io-parser"),i=e("component-emitter");function a(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders}t.exports=a,i(a.prototype),a.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},a.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},a.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},a.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},a.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},a.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},a.prototype.onPacket=function(e){this.emit("packet",e)},a.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(e,t,r){(function(t){var n=e("xmlhttprequest-ssl"),i=e("./polling-xhr"),a=e("./polling-jsonp"),o=e("./websocket");function s(e){var r=!1,o=!1,s=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,d=location.port;d||(d=c?443:80),r=e.hostname!=location.hostname||d!=e.port,o=e.secure!=c}if(e.xdomain=r,e.xscheme=o,"open"in new n(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new a(e)}r.polling=s,r.websocket=o}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(e,t,r){(function(r){var n=e("./polling"),i=e("component-inherit");t.exports=d;var a,o=/\n/g,s=/\\n/g;function c(){}function d(e){n.call(this,e),this.query=this.query||{},a||(r.___eio||(r.___eio=[]),a=r.___eio),this.index=a.length;var t=this;a.push((function(e){t.onData(e)})),this.query.j=this.index,r.document&&r.addEventListener&&r.addEventListener("beforeunload",(function(){t.script&&(t.script.onerror=c)}),!1)}i(d,n),d.prototype.supportsBinary=!1,d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},d.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},d.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),a.name="d",i.appendChild(a),document.body.appendChild(i),this.form=i,this.area=a}function d(){u(),t()}function u(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),u(),e=e.replace(s,"\\\n"),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==r.iframe.readyState&&d()}:this.iframe.onload=d}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{"./polling":8,"component-inherit":16}],7:[function(e,t,r){(function(r){var n=e("xmlhttprequest-ssl"),i=e("./polling"),a=e("component-emitter"),o=e("component-inherit"),s=e("debug")("engine.io-client:polling-xhr");function c(){}function d(e){if(i.call(this,e),r.location){var t="https:"==location.protocol,n=location.port;n||(n=t?443:80),this.xd=e.hostname!=r.location.hostname||n!=e.port,this.xs=e.secure!=t}else this.extraHeaders=e.extraHeaders}function u(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=null!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function l(){for(var e in u.requests)u.requests.hasOwnProperty(e)&&u.requests[e].abort()}t.exports=d,t.exports.Request=u,o(d,i),d.prototype.supportsBinary=!0,d.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.extraHeaders=this.extraHeaders,new u(e)},d.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",(function(e){i.onError("xhr post error",e)})),this.sendXhr=n},d.prototype.doPoll=function(){s("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},a(u.prototype),u.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new n(e),i=this;try{s("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var a in t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(a)&&t.setRequestHeader(a,this.extraHeaders[a])}catch(e){}if(this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?i.onLoad():setTimeout((function(){i.onError(t.status)}),0))},s("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){i.onError(e)}),0)}r.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},u.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},u.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}r.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===t)e=this.xhr.response;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(t){for(var r=new Uint8Array(this.xhr.response),n=[],i=0,a=r.length;i<a;i++)n.push(r[i]);e=String.fromCharCode.apply(null,n)}else e=this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},u.prototype.hasXDR=function(){return void 0!==r.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},r.document&&(u.requestsCount=0,u.requests={},r.attachEvent?r.attachEvent("onunload",l):r.addEventListener&&r.addEventListener("beforeunload",l,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(e,t,r){var n=e("../transport"),i=e("parseqs"),a=e("engine.io-parser"),o=e("component-inherit"),s=e("yeast"),c=e("debug")("engine.io-client:polling");t.exports=u;var d=null!=new(e("xmlhttprequest-ssl"))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;d&&!t||(this.supportsBinary=!1),n.call(this,e)}o(u,n),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function r(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(c("we are currently polling - waiting to pause"),n++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--n||r()}))),this.writable||(c("we are currently writing - waiting to pause"),n++,this.once("drain",(function(){c("pre-pause writing complete"),--n||r()})))}else r()},u.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;c("polling got data %s",e);var r=function(e,r,n){if("opening"==t.readyState&&t.onOpen(),"close"==e.type)return t.onClose(),!1;t.onPacket(e)};a.decodePayload(e,this.socket.binaryType,r),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"==this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};t=this,a.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,r)}))},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(e,t,r){(function(r){var n=e("../transport"),i=e("engine.io-parser"),a=e("parseqs"),o=e("component-inherit"),s=e("yeast"),c=e("debug")("engine.io-client:websocket"),d=r.WebSocket||r.MozWebSocket,u=d;if(!u&&"undefined"==typeof window)try{u=e("ws")}catch(e){}function l(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,n.call(this,e)}t.exports=l,o(l,n),l.prototype.name="websocket",l.prototype.supportsBinary=!0,l.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=void 0,r={agent:this.agent,perMessageDeflate:this.perMessageDeflate};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(r.headers=this.extraHeaders),this.ws=d?new u(e):new u(e,t,r),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},l.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(l.prototype.onData=function(e){var t=this;setTimeout((function(){n.prototype.onData.call(t,e)}),0)}),l.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,a=0,o=n;a<o;a++)!function(e){i.encodePacket(e,t.supportsBinary,(function(i){if(!d){var a={};e.options&&(a.compress=e.options.compress),t.perMessageDeflate&&("string"==typeof i?r.Buffer.byteLength(i):i.length)<t.perMessageDeflate.threshold&&(a.compress=!1)}try{d?t.ws.send(i):t.ws.send(i,a)}catch(e){c("websocket closed before onclose event")}--n||s()}))}(e[a]);function s(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}},l.prototype.onClose=function(){n.prototype.onClose.call(this)},l.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},l.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===l.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(e,t,r){var n=e("has-cors");t.exports=function(e){var t=e.xdomain,r=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(e){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":22}],11:[function(e,t,r){function n(e,t,r){var n=!1;return r=r||i,a.count=e,0===e?t():a;function a(e,i){if(a.count<=0)throw new Error("after called too many times");--a.count,e?(n=!0,t(e),t=r):0!==a.count||n||t(null,i)}}function i(){}t.exports=n},{}],12:[function(e,t,r){t.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),a=new Uint8Array(r-t),o=t,s=0;o<r;o++,s++)a[s]=i[o];return a.buffer}},{}],13:[function(e,t,r){var n;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r.encode=function(e){var t,r=new Uint8Array(e),i=r.length,a="";for(t=0;t<i;t+=3)a+=n[r[t]>>2],a+=n[(3&r[t])<<4|r[t+1]>>4],a+=n[(15&r[t+1])<<2|r[t+2]>>6],a+=n[63&r[t+2]];return i%3==2?a=a.substring(0,a.length-1)+"=":i%3==1&&(a=a.substring(0,a.length-2)+"=="),a},r.decode=function(e){var t,r,i,a,o,s=.75*e.length,c=e.length,d=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),l=new Uint8Array(u);for(t=0;t<c;t+=4)r=n.indexOf(e[t]),i=n.indexOf(e[t+1]),a=n.indexOf(e[t+2]),o=n.indexOf(e[t+3]),l[d++]=r<<2|i>>4,l[d++]=(15&i)<<4|a>>2,l[d++]=(3&a)<<6|63&o;return u}},{}],14:[function(e,t,r){(function(e){var r=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),a=r&&r.prototype.append&&r.prototype.getBlob;function o(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=i.buffer}e[t]=n}}}function s(e,t){t=t||{};var n=new r;o(e);for(var i=0;i<e.length;i++)n.append(e[i]);return t.type?n.getBlob(t.type):n.getBlob()}function c(e,t){return o(e),new Blob(e,t||{})}t.exports=n?i?e.Blob:c:a?s:void 0}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{}],15:[function(e,t,r){function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){var r=this;function n(){r.off(e,n),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],16:[function(e,t,r){t.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],17:[function(e,t,r){function n(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),!t)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,a=0;return e[0].replace(/%[a-z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(a=i))})),e.splice(a,0,n),e}function a(){return"object"===("undefined"==typeof console?"undefined":s(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}}function c(){var e;try{e=r.storage.debug}catch(e){}return e}function d(){try{return window.localStorage}catch(e){}}(r=t.exports=e("./debug")).log=a,r.formatArgs=i,r.save=o,r.load=c,r.useColors=n,r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:d(),r.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],r.formatters.j=function(e){return JSON.stringify(e)},r.enable(c())},{"./debug":18}],18:[function(e,t,r){(r=t.exports=o).coerce=u,r.disable=c,r.enable=s,r.enabled=d,r.humanize=e("ms"),r.names=[],r.skips=[],r.formatters={};var n,i=0;function a(){return r.colors[i++%r.colors.length]}function o(e){function t(){}function i(){var e=i,t=+new Date,o=t-(n||t);e.diff=o,e.prev=n,e.curr=t,n=t,null==e.useColors&&(e.useColors=r.useColors()),null==e.color&&e.useColors&&(e.color=a());var s=Array.prototype.slice.call(arguments);s[0]=r.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,(function(t,n){if("%%"===t)return t;c++;var i=r.formatters[n];if("function"==typeof i){var a=s[c];t=i.call(e,a),s.splice(c,1),c--}return t})),"function"==typeof r.formatArgs&&(s=r.formatArgs.apply(e,s)),(i.log||r.log||console.log.bind(console)).apply(e,s)}t.enabled=!1,i.enabled=!0;var o=r.enabled(e)?i:t;return o.namespace=e,o}function s(e){r.save(e);for(var t=(e||"").split(/[\s,]+/),n=t.length,i=0;i<n;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")))}function c(){r.enable("")}function d(e){var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}},{ms:25}],19:[function(e,t,r){(function(t){var n=e("./keys"),i=e("has-binary"),a=e("arraybuffer.slice"),o=e("base64-arraybuffer"),s=e("after"),c=e("utf8"),d=navigator.userAgent.match(/Android/i),u=/PhantomJS/i.test(navigator.userAgent),l=d||u;r.protocol=3;var p=r.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=n(p),h={type:"error",data:"parser error"},m=e("blob");function v(e,t){return t("b"+r.packets[e.type]+e.data.data)}function g(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var i=e.data,a=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=p[e.type];for(var s=0;s<a.length;s++)o[s+1]=a[s];return n(o.buffer)}function y(e,t,n){if(!t)return r.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){e.data=i.result,r.encodePacket(e,t,!0,n)},i.readAsArrayBuffer(e.data)}function b(e,t,n){if(!t)return r.encodeBase64Packet(e,n);if(l)return y(e,t,n);var i=new Uint8Array(1);return i[0]=p[e.type],n(new m([i.buffer,e.data]))}function _(e,t,r){for(var n=new Array(e.length),i=s(e.length,r),a=function(e,r,i){t(r,(function(t,r){n[e]=r,i(t,n)}))},o=0;o<e.length;o++)a(o,e[o],i)}r.encodePacket=function(e,r,n,i){"function"==typeof r&&(i=r,r=!1),"function"==typeof n&&(i=n,n=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&a instanceof ArrayBuffer)return g(e,r,i);if(m&&a instanceof t.Blob)return b(e,r,i);if(a&&a.base64)return v(e,i);var o=p[e.type];return void 0!==e.data&&(o+=n?c.encode(String(e.data)):String(e.data)),i(""+o)},r.encodeBase64Packet=function(e,n){var i,a="b"+r.packets[e.type];if(m&&e.data instanceof t.Blob){var o=new FileReader;return o.onload=function(){var e=o.result.split(",")[1];n(a+e)},o.readAsDataURL(e.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),c=new Array(s.length),d=0;d<s.length;d++)c[d]=s[d];i=String.fromCharCode.apply(null,c)}return a+=t.btoa(i),n(a)},r.decodePacket=function(e,t,n){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return r.decodeBase64Packet(e.substr(1),t);if(n)try{e=c.decode(e)}catch(e){return h}var i=e.charAt(0);return Number(i)==i&&f[i]?e.length>1?{type:f[i],data:e.substring(1)}:{type:f[i]}:h}i=new Uint8Array(e)[0];var o=a(e,1);return m&&"blob"===t&&(o=new m([o])),{type:f[i],data:o}},r.decodeBase64Packet=function(e,r){var n=f[e.charAt(0)];if(!t.ArrayBuffer)return{type:n,data:{base64:!0,data:e.substr(1)}};var i=o.decode(e.substr(1));return"blob"===r&&m&&(i=new m([i])),{type:n,data:i}},r.encodePayload=function(e,t,n){"function"==typeof t&&(n=t,t=null);var a=i(e);if(t&&a)return m&&!l?r.encodePayloadAsBlob(e,n):r.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");function o(e){return e.length+":"+e}function s(e,n){r.encodePacket(e,!!a&&t,!0,(function(e){n(null,o(e))}))}_(e,s,(function(e,t){return n(t.join(""))}))},r.decodePayload=function(e,t,n){if("string"!=typeof e)return r.decodePayloadAsBinary(e,t,n);var i;if("function"==typeof t&&(n=t,t=null),""==e)return n(h,0,1);for(var a,o,s="",c=0,d=e.length;c<d;c++){var u=e.charAt(c);if(":"!=u)s+=u;else{if(""==s||s!=(a=Number(s)))return n(h,0,1);if(s!=(o=e.substr(c+1,a)).length)return n(h,0,1);if(o.length){if(i=r.decodePacket(o,t,!0),h.type==i.type&&h.data==i.data)return n(h,0,1);if(!1===n(i,c+a,d))return}c+=a,s=""}}return""!=s?n(h,0,1):void 0},r.encodePayloadAsArrayBuffer=function(e,t){if(!e.length)return t(new ArrayBuffer(0));function n(e,t){r.encodePacket(e,!0,!0,(function(e){return t(null,e)}))}_(e,n,(function(e,r){var n=r.reduce((function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2}),0),i=new Uint8Array(n),a=0;return r.forEach((function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);r=n.buffer}i[a++]=t?0:1;var s=r.byteLength.toString();for(o=0;o<s.length;o++)i[a++]=parseInt(s[o]);for(i[a++]=255,n=new Uint8Array(r),o=0;o<n.length;o++)i[a++]=n[o]})),t(i.buffer)}))},r.encodePayloadAsBlob=function(e,t){function n(e,t){r.encodePacket(e,!0,!0,(function(e){var r=new Uint8Array(1);if(r[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,r[0]=0}var a=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),o=new Uint8Array(a.length+1);for(i=0;i<a.length;i++)o[i]=parseInt(a[i]);if(o[a.length]=255,m){var s=new m([r.buffer,o.buffer,e]);t(null,s)}}))}_(e,n,(function(e,r){return t(new m(r))}))},r.decodePayloadAsBinary=function(e,t,n){"function"==typeof t&&(n=t,t=null);for(var i=e,o=[],s=!1;i.byteLength>0;){for(var c=new Uint8Array(i),d=0===c[0],u="",l=1;255!=c[l];l++){if(u.length>310){s=!0;break}u+=c[l]}if(s)return n(h,0,1);i=a(i,2+u.length),u=parseInt(u);var p=a(i,0,u);if(d)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var f=new Uint8Array(p);for(p="",l=0;l<f.length;l++)p+=String.fromCharCode(f[l])}o.push(p),i=a(i,u)}var m=o.length;o.forEach((function(e,i){n(r.decodePacket(e,t,!0),i,m)}))}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(e,t,r){t.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},{}],21:[function(e,t,r){(function(r){var n=e("isarray");function i(e){function t(e){if(!e)return!1;if(r.Buffer&&r.Buffer.isBuffer(e)||r.ArrayBuffer&&e instanceof ArrayBuffer||r.Blob&&e instanceof Blob||r.File&&e instanceof File)return!0;if(n(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==s(e))for(var a in e.toJSON&&(e=e.toJSON()),e)if(Object.prototype.hasOwnProperty.call(e,a)&&t(e[a]))return!0;return!1}return t(e)}t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{isarray:24}],22:[function(e,t,r){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},{}],23:[function(e,t,r){var n=[].indexOf;t.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},{}],24:[function(e,t,r){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],25:[function(e,t,r){var n=1e3,i=60*n,a=60*i,o=24*a,s=365.25*o;function c(e){if(!((e=""+e).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*s;case"days":case"day":case"d":return r*o;case"hours":case"hour":case"hrs":case"hr":case"h":return r*a;case"minutes":case"minute":case"mins":case"min":case"m":return r*i;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}}function d(e){return e>=o?Math.round(e/o)+"d":e>=a?Math.round(e/a)+"h":e>=i?Math.round(e/i)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}function u(e){return l(e,o,"day")||l(e,a,"hour")||l(e,i,"minute")||l(e,n,"second")||e+" ms"}function l(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}t.exports=function(e,t){return t=t||{},"string"==typeof e?c(e):t.long?u(e):d(e)}},{}],26:[function(e,t,r){(function(e){var r=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,a=/(?:^|:|,)(?:\s*\[)+/g,o=/^\s+/,s=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(o,"").replace(s,""),e.JSON&&JSON.parse?JSON.parse(t):r.test(t.replace(n,"@").replace(i,"]").replace(a,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{}],27:[function(e,t,r){r.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},r.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var a=r[n].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}},{}],28:[function(e,t,r){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,r=e.indexOf("["),a=e.indexOf("]");-1!=r&&-1!=a&&(e=e.substring(0,r)+e.substring(r,a).replace(/:/g,";")+e.substring(a,e.length));for(var o=n.exec(e||""),s={},c=14;c--;)s[i[c]]=o[c]||"";return-1!=r&&-1!=a&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s}},{}],29:[function(e,t,r){(function(e){!function(n){var i="object"==s(r)&&r,a="object"==s(t)&&t&&t.exports==i&&t,o="object"==s(e)&&e;o.global!==o&&o.window!==o||(n=o);var c,d,u,l=String.fromCharCode;function p(e){for(var t,r,n=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function f(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=l((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=l(t);return i}function h(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function m(e,t){return l(e>>t&63|128)}function v(e){if(0==(4294967168&e))return l(e);var t="";return 0==(4294965248&e)?t=l(e>>6&31|192):0==(4294901760&e)?(h(e),t=l(e>>12&15|224),t+=m(e,6)):0==(4292870144&e)&&(t=l(e>>18&7|240),t+=m(e,12),t+=m(e,6)),t+=l(63&e|128)}function g(e){for(var t=p(e),r=t.length,n=-1,i="";++n<r;)i+=v(t[n]);return i}function y(){if(u>=d)throw Error("Invalid byte index");var e=255&c[u];if(u++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function b(){var e,t;if(u>d)throw Error("Invalid byte index");if(u==d)return!1;if(e=255&c[u],u++,0==(128&e))return e;if(192==(224&e)){if((t=(31&e)<<6|y())>=128)return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if((t=(15&e)<<12|y()<<6|y())>=2048)return h(t),t;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=(15&e)<<18|y()<<12|y()<<6|y())>=65536&&t<=1114111)return t;throw Error("Invalid UTF-8 detected")}function _(e){c=p(e),d=c.length,u=0;for(var t,r=[];!1!==(t=b());)r.push(t);return f(r)}var S={version:"2.0.0",encode:g,decode:_};if(i&&!i.nodeType)if(a)a.exports=S;else{var k={}.hasOwnProperty;for(var w in S)k.call(S,w)&&(i[w]=S[w])}else n.utf8=S}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{}],30:[function(e,t,r){var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,o={},s=0,c=0;function d(e){var t="";do{t=i[e%a]+t,e=Math.floor(e/a)}while(e>0);return t}function u(e){var t=0;for(c=0;c<e.length;c++)t=t*a+o[e.charAt(c)];return t}function l(){var e=d(+new Date);return e!==n?(s=0,n=e):e+"."+d(s++)}for(;c<a;c++)o[i[c]]=c;l.encode=d,l.decode=u,t.exports=l},{}],31:[function(e,t,r){var n=e("./url"),i=e("socket.io-parser"),a=e("./manager"),o=e("debug")("socket.io-client");t.exports=r=d;var c=r.managers={};function d(e,t){"object"==s(e)&&(t=e,e=void 0),t=t||{};var r,i=n(e),d=i.source,u=i.id,l=i.path,p=c[u]&&l in c[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||p?(o("ignoring socket cache for %s",d),r=a(d,t)):(c[u]||(o("new io instance for %s",d),c[u]=a(d,t)),r=c[u]),r.socket(i.path)}r.protocol=i.protocol,r.connect=d,r.Manager=e("./manager"),r.Socket=e("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(e,t,r){var n=e("engine.io-client"),i=e("./socket"),a=e("component-emitter"),o=e("socket.io-parser"),c=e("./on"),d=e("component-bind"),u=e("debug")("socket.io-client:manager"),l=e("indexof"),p=e("backo2"),f=Object.prototype.hasOwnProperty;function h(e,t){if(!(this instanceof h))return new h(e,t);e&&"object"==s(e)&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new o.Encoder,this.decoder=new o.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}t.exports=h,h.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},h.prototype.updateSocketIds=function(){for(var e in this.nsps)f.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},a(h.prototype),h.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},h.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},h.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},h.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},h.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},h.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},h.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},h.prototype.open=h.prototype.connect=function(e){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=n(this.uri,this.opts);var t=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var i=c(t,"open",(function(){r.onopen(),e&&e()})),a=c(t,"error",(function(t){if(u("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var o=this._timeout;u("connect attempt will timeout after %d",o);var s=setTimeout((function(){u("connect attempt timed out after %d",o),i.destroy(),t.close(),t.emit("error","timeout"),r.emitAll("connect_timeout",o)}),o);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(i),this.subs.push(a),this},h.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",d(this,"ondata"))),this.subs.push(c(e,"ping",d(this,"onping"))),this.subs.push(c(e,"pong",d(this,"onpong"))),this.subs.push(c(e,"error",d(this,"onerror"))),this.subs.push(c(e,"close",d(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",d(this,"ondecoded")))},h.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},h.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},h.prototype.ondata=function(e){this.decoder.add(e)},h.prototype.ondecoded=function(e){this.emit("packet",e)},h.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},h.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new i(this,e),this.nsps[e]=t;var r=this;t.on("connecting",n),t.on("connect",(function(){t.id=r.engine.id})),this.autoConnect&&n()}function n(){~l(r.connecting,t)||r.connecting.push(t)}return t},h.prototype.destroy=function(e){var t=l(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},h.prototype.packet=function(e){u("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()})))},h.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},h.prototype.cleanup=function(){var e;for(u("cleanup");e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},h.prototype.close=h.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},h.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},h.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout((function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(r)}})}},h.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(e,t,r){function n(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}t.exports=n},{}],34:[function(e,t,r){var n=e("socket.io-parser"),i=e("component-emitter"),a=e("to-array"),o=e("./on"),s=e("component-bind"),c=e("debug")("socket.io-client:socket"),d=e("has-binary");t.exports=p;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=i.prototype.emit;function p(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[o(e,"open",s(this,"onopen")),o(e,"packet",s(this,"onpacket")),o(e,"close",s(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting")),this},p.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(u.hasOwnProperty(e))return l.apply(this,arguments),this;var t=a(arguments),r=n.EVENT;d(t)&&(r=n.BINARY_EVENT);var i={type:r,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:n.CONNECT})},p.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},p.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},p.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},p.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=a(arguments);c("sending ack %j",i);var o=d(i)?n.BINARY_ACK:n.ACK;t.packet({type:o,id:e,data:i})}}},p.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(e,t,r){(function(r){var n=e("parseuri"),i=e("debug")("socket.io-client:url");function a(e,t){var a=e;t=t||r.location,null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),a=n(e)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";var o=-1!==a.host.indexOf(":")?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+o+":"+a.port,a.href=a.protocol+"://"+o+(t&&t.port==a.port?"":":"+a.port),a}t.exports=a}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{debug:39,parseuri:45}],36:[function(e,t,r){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},{}],37:[function(e,t,r){var n=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},{}],38:[function(e,t,r){function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],39:[function(e,t,r){arguments[4][17][0].apply(r,arguments)},{"./debug":40,dup:17}],40:[function(e,t,r){arguments[4][18][0].apply(r,arguments)},{dup:18,ms:44}],41:[function(e,t,r){(function(r){var n=e("isarray");function i(e){function t(e){if(!e)return!1;if(r.Buffer&&r.Buffer.isBuffer&&r.Buffer.isBuffer(e)||r.ArrayBuffer&&e instanceof ArrayBuffer||r.Blob&&e instanceof Blob||r.File&&e instanceof File)return!0;if(n(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==s(e))for(var a in e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),e)if(Object.prototype.hasOwnProperty.call(e,a)&&t(e[a]))return!0;return!1}return t(e)}t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{isarray:43}],42:[function(e,t,r){arguments[4][23][0].apply(r,arguments)},{dup:23}],43:[function(e,t,r){arguments[4][24][0].apply(r,arguments)},{dup:24}],44:[function(e,t,r){arguments[4][25][0].apply(r,arguments)},{dup:25}],45:[function(e,t,r){arguments[4][28][0].apply(r,arguments)},{dup:28}],46:[function(e,t,r){(function(t){var n=e("isarray"),i=e("./is-buffer");r.deconstructPacket=function(e){var t=[],r=e.data;function a(e){if(!e)return e;if(i(e)){var r={_placeholder:!0,num:t.length};return t.push(e),r}if(n(e)){for(var o=new Array(e.length),c=0;c<e.length;c++)o[c]=a(e[c]);return o}if("object"==s(e)&&!(e instanceof Date)){for(var d in o={},e)o[d]=a(e[d]);return o}return e}var o=e;return o.data=a(r),o.attachments=t.length,{packet:o,buffers:t}},r.reconstructPacket=function(e,t){function r(e){if(e&&e._placeholder)return t[e.num];if(n(e)){for(var i=0;i<e.length;i++)e[i]=r(e[i]);return e}if(e&&"object"==s(e)){for(var a in e)e[a]=r(e[a]);return e}return e}return e.data=r(e.data),e.attachments=void 0,e},r.removeBlobs=function(e,r){function a(e,d,u){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){o++;var l=new FileReader;l.onload=function(){u?u[d]=this.result:c=this.result,--o||r(c)},l.readAsArrayBuffer(e)}else if(n(e))for(var p=0;p<e.length;p++)a(e[p],p,e);else if(e&&"object"==s(e)&&!i(e))for(var f in e)a(e[f],f,e)}var o=0,c=e;a(c),o||r(c)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{"./is-buffer":48,isarray:43}],47:[function(e,t,r){var n=e("debug")("socket.io-parser"),i=e("json3"),a=(e("isarray"),e("component-emitter")),o=e("./binary"),s=e("./is-buffer");function c(){}function d(e){var t="",a=!1;return t+=e.type,r.BINARY_EVENT!=e.type&&r.BINARY_ACK!=e.type||(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(a=!0,t+=e.nsp),null!=e.id&&(a&&(t+=",",a=!1),t+=e.id),null!=e.data&&(a&&(t+=","),t+=i.stringify(e.data)),n("encoded %j as %s",e,t),t}function u(e,t){function r(e){var r=o.deconstructPacket(e),n=d(r.packet),i=r.buffers;i.unshift(n),t(i)}o.removeBlobs(e,r)}function l(){this.reconstructor=null}function p(e){var t={},a=0;if(t.type=Number(e.charAt(0)),null==r.types[t.type])return h();if(r.BINARY_EVENT==t.type||r.BINARY_ACK==t.type){for(var o="";"-"!=e.charAt(++a)&&(o+=e.charAt(a),a!=e.length););if(o!=Number(o)||"-"!=e.charAt(a))throw new Error("Illegal attachments");t.attachments=Number(o)}if("/"==e.charAt(a+1))for(t.nsp="";++a&&","!=(c=e.charAt(a))&&(t.nsp+=c,a!=e.length););else t.nsp="/";var s=e.charAt(a+1);if(""!==s&&Number(s)==s){for(t.id="";++a;){var c;if(null==(c=e.charAt(a))||Number(c)!=c){--a;break}if(t.id+=e.charAt(a),a==e.length)break}t.id=Number(t.id)}if(e.charAt(++a))try{t.data=i.parse(e.substr(a))}catch(e){return h()}return n("decoded %s as %j",e,t),t}function f(e){this.reconPack=e,this.buffers=[]}function h(e){return{type:r.ERROR,data:"parser error"}}r.protocol=4,r.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],r.CONNECT=0,r.DISCONNECT=1,r.EVENT=2,r.ACK=3,r.ERROR=4,r.BINARY_EVENT=5,r.BINARY_ACK=6,r.Encoder=c,r.Decoder=l,c.prototype.encode=function(e,t){n("encoding packet %j",e),r.BINARY_EVENT==e.type||r.BINARY_ACK==e.type?u(e,t):t([d(e)])},a(l.prototype),l.prototype.add=function(e){var t;if("string"==typeof e)t=p(e),r.BINARY_EVENT==t.type||r.BINARY_ACK==t.type?(this.reconstructor=new f(t),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!s(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",t))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},f.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(e,t,r){(function(e){function r(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=r}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{}],49:[function(e,t,r){arguments[4][15][0].apply(r,arguments)},{dup:15}],50:[function(e,t,n){(function(e){(function(){var i="function"==typeof r,a={function:!0,object:!0},o=a[s(n)]&&n&&!n.nodeType&&n,c=a["undefined"==typeof window?"undefined":s(window)]&&window||this,d=o&&a[s(t)]&&t&&!t.nodeType&&"object"==s(e)&&e;function u(e,t){e||(e=c.Object()),t||(t=c.Object());var r=e.Number||c.Number,n=e.String||c.String,i=e.Object||c.Object,o=e.Date||c.Date,d=e.SyntaxError||c.SyntaxError,l=e.TypeError||c.TypeError,p=e.Math||c.Math,f=e.JSON||c.JSON;"object"==s(f)&&f&&(t.stringify=f.stringify,t.parse=f.parse);var h,m,v,g=i.prototype,y=g.toString,b=new o(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(e){}function _(e){if(_[e]!==v)return _[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=_("json-stringify")&&_("json-parse");else{var a,s='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var c=t.stringify,d="function"==typeof c&&b;if(d){(a=function(){return 1}).toJSON=a;try{d="0"===c(0)&&"0"===c(new r)&&'""'==c(new n)&&c(y)===v&&c(v)===v&&c()===v&&"1"===c(a)&&"[1]"==c([a])&&"[null]"==c([v])&&"null"==c(null)&&"[null,null,null]"==c([v,y,null])&&c({a:[a,!0,!1,null,"\0\b\n\f\r\t"]})==s&&"1"===c(null,a)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new o(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==c(new o(864e13))&&'"-000001-01-01T00:00:00.000Z"'==c(new o(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==c(new o(-1))}catch(e){d=!1}}i=d}if("json-parse"==e){var u=t.parse;if("function"==typeof u)try{if(0===u("0")&&!u(!1)){var l=5==(a=u(s)).a.length&&1===a.a[0];if(l){try{l=!u('"\t"')}catch(e){}if(l)try{l=1!==u("01")}catch(e){}if(l)try{l=1!==u("1.")}catch(e){}}}}catch(e){l=!1}i=l}}return _[e]=!!i}if(!_("json")){var S="[object Function]",k="[object Date]",w="[object Number]",C="[object String]",A="[object Array]",R="[object Boolean]",T=_("bug-string-char-index");if(!b)var E=p.floor,x=[0,31,59,90,120,151,181,212,243,273,304,334],I=function(e,t){return x[t]+365*(e-1970)+E((e-1969+(t=+(t>1)))/4)-E((e-1901+t)/100)+E((e-1601+t)/400)};if((h=g.hasOwnProperty)||(h=function(e){var t,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=y?h=function(e){var t=this.__proto__,r=e in(this.__proto__=null,this);return this.__proto__=t,r}:(t=r.constructor,h=function(e){var r=(this.constructor||t).prototype;return e in this&&!(e in r&&this[e]===r[e])}),r=null,h.call(this,e)}),m=function(e,t){var r,n,i,o=0;for(i in(r=function(){this.valueOf=0}).prototype.valueOf=0,n=new r)h.call(n,i)&&o++;return r=n=null,o?m=2==o?function(e,t){var r,n={},i=y.call(e)==S;for(r in e)i&&"prototype"==r||h.call(n,r)||!(n[r]=1)||!h.call(e,r)||t(r)}:function(e,t){var r,n,i=y.call(e)==S;for(r in e)i&&"prototype"==r||!h.call(e,r)||(n="constructor"===r)||t(r);(n||h.call(e,r="constructor"))&&t(r)}:(n=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(e,t){var r,i,o=y.call(e)==S,c=!o&&"function"!=typeof e.constructor&&a[s(e.hasOwnProperty)]&&e.hasOwnProperty||h;for(r in e)o&&"prototype"==r||!c.call(e,r)||t(r);for(i=n.length;r=n[--i];c.call(e,r)&&t(r));}),m(e,t)},!_("json-stringify")){var P={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O="000000",D=function(e,t){return(O+(t||0)).slice(-e)},M="\\u00",N=function(e){for(var t='"',r=0,n=e.length,i=!T||n>10,a=i&&(T?e.split(""):e);r<n;r++){var o=e.charCodeAt(r);switch(o){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=P[o];break;default:if(o<32){t+=M+D(2,o.toString(16));break}t+=i?a[r]:e.charAt(r)}}return t+'"'},L=function e(t,r,n,i,a,o,c){var d,u,p,f,g,b,_,S,T,x,P,O,M,L,B,j;try{d=r[t]}catch(e){}if("object"==s(d)&&d)if((u=y.call(d))!=k||h.call(d,"toJSON"))"function"==typeof d.toJSON&&(u!=w&&u!=C&&u!=A||h.call(d,"toJSON"))&&(d=d.toJSON(t));else if(d>-1/0&&d<1/0){if(I){for(g=E(d/864e5),p=E(g/365.2425)+1970-1;I(p+1,0)<=g;p++);for(f=E((g-I(p,0))/30.42);I(p,f+1)<=g;f++);g=1+g-I(p,f),_=E((b=(d%864e5+864e5)%864e5)/36e5)%24,S=E(b/6e4)%60,T=E(b/1e3)%60,x=b%1e3}else p=d.getUTCFullYear(),f=d.getUTCMonth(),g=d.getUTCDate(),_=d.getUTCHours(),S=d.getUTCMinutes(),T=d.getUTCSeconds(),x=d.getUTCMilliseconds();d=(p<=0||p>=1e4?(p<0?"-":"+")+D(6,p<0?-p:p):D(4,p))+"-"+D(2,f+1)+"-"+D(2,g)+"T"+D(2,_)+":"+D(2,S)+":"+D(2,T)+"."+D(3,x)+"Z"}else d=null;if(n&&(d=n.call(r,t,d)),null===d)return"null";if((u=y.call(d))==R)return""+d;if(u==w)return d>-1/0&&d<1/0?""+d:"null";if(u==C)return N(""+d);if("object"==s(d)){for(L=c.length;L--;)if(c[L]===d)throw l();if(c.push(d),P=[],B=o,o+=a,u==A){for(M=0,L=d.length;M<L;M++)O=e(M,d,n,i,a,o,c),P.push(O===v?"null":O);j=P.length?a?"[\n"+o+P.join(",\n"+o)+"\n"+B+"]":"["+P.join(",")+"]":"[]"}else m(i||d,(function(t){var r=e(t,d,n,i,a,o,c);r!==v&&P.push(N(t)+":"+(a?" ":"")+r)})),j=P.length?a?"{\n"+o+P.join(",\n"+o)+"\n"+B+"}":"{"+P.join(",")+"}":"{}";return c.pop(),j}};t.stringify=function(e,t,r){var n,i,o,c;if(a[s(t)]&&t)if((c=y.call(t))==S)i=t;else if(c==A){o={};for(var d,u=0,l=t.length;u<l;d=t[u++],((c=y.call(d))==C||c==w)&&(o[d]=1));}if(r)if((c=y.call(r))==w){if((r-=r%1)>0)for(n="",r>10&&(r=10);n.length<r;n+=" ");}else c==C&&(n=r.length<=10?r:r.slice(0,10));return L("",((d={})[""]=e,d),i,o,n,"",[])}}if(!_("json-parse")){var B,j,U=n.fromCharCode,F={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},V=function(){throw B=j=null,d()},z=function(){for(var e,t,r,n,i,a=j,o=a.length;B<o;)switch(i=a.charCodeAt(B)){case 9:case 10:case 13:case 32:B++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=T?a.charAt(B):a[B],B++,e;case 34:for(e="@",B++;B<o;)if((i=a.charCodeAt(B))<32)V();else if(92==i)switch(i=a.charCodeAt(++B)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=F[i],B++;break;case 117:for(t=++B,r=B+4;B<r;B++)(i=a.charCodeAt(B))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||V();e+=U("0x"+a.slice(t,B));break;default:V()}else{if(34==i)break;for(i=a.charCodeAt(B),t=B;i>=32&&92!=i&&34!=i;)i=a.charCodeAt(++B);e+=a.slice(t,B)}if(34==a.charCodeAt(B))return B++,e;V();default:if(t=B,45==i&&(n=!0,i=a.charCodeAt(++B)),i>=48&&i<=57){for(48==i&&(i=a.charCodeAt(B+1))>=48&&i<=57&&V(),n=!1;B<o&&(i=a.charCodeAt(B))>=48&&i<=57;B++);if(46==a.charCodeAt(B)){for(r=++B;r<o&&(i=a.charCodeAt(r))>=48&&i<=57;r++);r==B&&V(),B=r}if(101==(i=a.charCodeAt(B))||69==i){for(43!=(i=a.charCodeAt(++B))&&45!=i||B++,r=B;r<o&&(i=a.charCodeAt(r))>=48&&i<=57;r++);r==B&&V(),B=r}return+a.slice(t,B)}if(n&&V(),"true"==a.slice(B,B+4))return B+=4,!0;if("false"==a.slice(B,B+5))return B+=5,!1;if("null"==a.slice(B,B+4))return B+=4,null;V()}return"$"},G=function e(t){var r,n;if("$"==t&&V(),"string"==typeof t){if("@"==(T?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(r=[];"]"!=(t=z());n||(n=!0))n&&(","==t?"]"==(t=z())&&V():V()),","==t&&V(),r.push(e(t));return r}if("{"==t){for(r={};"}"!=(t=z());n||(n=!0))n&&(","==t?"}"==(t=z())&&V():V()),","!=t&&"string"==typeof t&&"@"==(T?t.charAt(0):t[0])&&":"==z()||V(),r[t.slice(1)]=e(z());return r}V()}return t},H=function(e,t,r){var n=W(e,t,r);n===v?delete e[t]:e[t]=n},W=function(e,t,r){var n,i=e[t];if("object"==s(i)&&i)if(y.call(i)==A)for(n=i.length;n--;)H(i,n,r);else m(i,(function(e){H(i,e,r)}));return r.call(e,t,i)};t.parse=function(e,t){var r,n;return B=0,j=""+e,r=G(z()),"$"!=z()&&V(),B=j=null,t&&y.call(t)==S?W(((n={})[""]=r,n),"",t):r}}}return t.runInContext=u,t}if(!d||d.global!==d&&d.window!==d&&d.self!==d||(c=d),o&&!i)u(c,o);else{var l=c.JSON,p=c.JSON3,f=!1,h=u(c,c.JSON3={noConflict:function(){return f||(f=!0,c.JSON=l,c.JSON3=p,l=p=null),h}});c.JSON={parse:h.parse,stringify:h.stringify}}}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:{})},{}],51:[function(e,t,r){function n(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}t.exports=n},{}]},{},[31])(31)})),{CONNECTING:"CONNECTING",SUCCESS:"SUCCESS",FAILED:"FAILED",CLOSED:"CLOSED",IDLE:"IDLE"}),ji={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED"},Ui={COMMITING:"COMMITED",FINISHED:"FINISHED"},Fi=Object.freeze({__proto__:null,STREAM_STATE:Bi,ROOM_STATE:ji,WEBSOCKET_STATE:{DISCONNECTED:"DISCONNECTED",CONNECTED:"CONNECTED",CONNECTING:"CONNECTING"},ACTION_STATE:Ui,DATA_CHANNEL_STATE:{CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSE:"CLOSE",IDLE:"IDLE"},DC_MESSAGE_FUNCTION_TYPE:{MESSAGE_FUNCTION_P2P:0,MESSAGE_FUNCTION_SIGNAL:1},DC_MESSAGE_DIRECTION:{MESSAGE_DIRECTION_SEND:0,MESSAGE_DIRECTION_FEEDBACK:1,MESSAGE_DIRECTION_ACK:2},DC_MESSAGE_CODE:{MESSAGE_SUCCESS:0,MESSAGE_ERROR_TIMEOUT:-1,MESSAGE_ERROR_BROKEN:-2,MESSAGE_ERROR_NO_RECEIVER:-3,MESSAGE_ERROR_NOT_JOIN:-100,MESSAGE_ERROR_INIT:-101,MESSAGE_ERROR_NO_CONNECTION:-102,MESSAGE_ERROR_UNKNOWN:-1e3}}),Vi={},zi=["https://rtc.bytedance.com/decision/v1/multi","https://rtcg.bytevcloud.com/decision/v1/multi"],Gi=["https://rtc.bytedance.com/oner_config/v1/multi","https://rtc.bytevcloud.com/oner_config/v1/multi"],Hi=["https://rtc.bytedance.com/oner_config/v1/multi","https://rtc.bytevcloud.com/oner_config/v1/multi"],Wi=["https://rtc.bytedance.com/fusion/get_rtc_service","https://rtc.bytevcloud.com/fusion/get_rtc_service"],qi="https://log.snssdk.com/video/v1/webrtc_log/";Object.defineProperty(Vi,"configServerUrls",{get:function(){return zi}}),Object.defineProperty(Vi,"onerConfigServerUrls",{get:function(){return Gi}}),Object.defineProperty(Vi,"configServerHost",{set:function(e){0!==e.length&&("string"==typeof e?(zi=["https://".concat(e).concat("/decision/v1/multi")],Gi=["https://".concat(e).concat("/oner_config/v1/multi")],Hi=["https://".concat(e).concat("/oner_config/v1/multi")],Wi=["https://".concat(e).concat("/fusion/get_rtc_service")]):Array.isArray(e)&&(zi=e.map((function(e){return"https://".concat(e).concat("/decision/v1/multi")})),Gi=e.map((function(e){return"https://".concat(e).concat("/oner_config/v1/multi")})),Hi=e.map((function(e){return"https://".concat(e).concat("/oner_config/v1/multi")})),Wi=e.map((function(e){return"https://".concat(e).concat("/fusion/get_rtc_service")}))))}}),Object.defineProperty(Vi,"ntpServerUrls",{get:function(){return Hi}}),Object.defineProperty(Vi,"shortConnectionUrls",{get:function(){return ur("shortConnectionUrls")||Wi}}),Object.defineProperty(Vi,"shortConnectionHost",{set:function(e){if(0!==e.length){var t=[];"string"==typeof e?t=["https://".concat(e).concat("/fusion/get_rtc_service")]:Array.isArray(e)&&(t=e.map((function(e){return"https://".concat(e).concat("/fusion/get_rtc_service")}))),cr("shortConnectionUrls",t)}}}),Object.defineProperty(Vi,"logServerUrl",{get:function(){return qi}}),Object.defineProperty(Vi,"logServerHost",{set:function(e){0!==e.length&&("string"==typeof e?qi="https://".concat(e).concat("/video/v1/webrtc_log/"):Array.isArray(e)&&(qi=e.map((function(e){return"https://".concat(e).concat("/video/v1/webrtc_log/")}))))}}),Vi.signalServer="http://127.0.0.1:8081",Vi.version="3.22.0",Vi.global={compressReport:!0};var Ji,Zi={PROBLEM_NONE:0,PROBLEM_OTHER_MSG:1,PROBLEM_AUDIO_NOT_CLEAR:2,PROBLEM_VIDEO_NOT_CLEAR:4,PROBLEM_SYNC:8,PROBLEM_AUDIO_LAGGING:16,PROBLEM_VIDEO_LAGGING:32,PROBLEM_CONNECT_FAILED:64,PROBLEM_AUDIO_DELAY:128,PROBLEM_VIDEO_DELAY:256,PROBLEM_DISCONNECT:512,PROBLEM_NO_AUDIO:1024,PROBLEM_NO_VIDEO:2048,PROBLEM_AUDIO_STRENGTH:4096,PROBLEM_ECHO:8192},Ki="live",Qi="cloud_game",Yi=4,Xi={speech_low_quality:[16e3,void 0,void 0],speech_standard:[32e3,void 0,18e3],music_standard:[48e3,void 0,void 0],standard_stereo:[48e3,1,void 0],high_quality:[48e3,void 0,128e3],high_quality_stereo:[48e3,1,192e3]},$i={"120P":["160x120",15,65],"120P_1":["160x120",15,65],"120P_3":["120x120",15,50],"180P":["320x180",15,140],"180P_1":["320X180",15,140],"180P_3":["180x180",15,100],"180P_4":["240x180",15,120],"240P":["320x240",15,200],"240P_1":["320X240",15,200],"240P_3":["240x240",15,140],"240P_4":["424x240",15,220],"360P":["640x360",15,400],"360P_1":["640x360",15,400],"360P_3":["360x360",15,260],"360P_4":["640x360",30,600],"360P_6":["360x360",30,400],"360P_7":["480x360",15,320],"360P_8":["480x360",30,490],"360P_9":["640x360",15,800],"360P_10":["640x360",24,800],"360P_11":["640x360",24,1e3],"480P":["640x480",15,500],"480P_1":["640x480",15,500],"480P_2":["640x480",30,1e3],"480P_3":["480x480",15,400],"480P_4":["640x480",30,750],"480P_6":["480x480",30,600],"480P_8":["848x480",15,610],"480P_9":["848x480",30,930],"480P_10":["640x480",10,400],"720P":["1280x720",15,1130],"720P_1":["1280x720",15,1130],"720P_2":["1280x720",15,2080],"720P_3":["1280x720",30,1710],"720P_5":["960x720",15,910],"720P_6":["960x720",30,1380],"1080P":["1920x1080",15,2080],"1080P_1":["1920x1080",15,2080],"1080P_2":["1920x1080",30,3e3],"1080P_3":["1920x1080",30,3150],"1080P_5":["1920x1080",60,4780],"1440P":["2560x1440",30,4850],"1440P_1":["2560x1440",30,4850],"1440P_2":["2560x1440",60,7350],"4K":["3840x2160",30,8910],"4K_1":["3840x2160",30,8910],"4K_3":["3840x2160",60,13500]},ea="function"==typeof atob,ta="function"==typeof btoa,ra="function"==typeof Buffer,na=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,tt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),ia=(Ji={},na.forEach((function(e,t){return Ji[e]=t})),Ji),aa=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,oa=String.fromCharCode.bind(String),sa="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return new Uint8Array(Array.prototype.slice.call(e,0).map(t))},ca=function(e){return e.replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"})).replace(/=+$/m,"")},da=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},ua=function(e){for(var t,r,n,i,a="",o=e.length%3,s=0;s<e.length;){if((r=e.charCodeAt(s++))>255||(n=e.charCodeAt(s++))>255||(i=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");a+=na[(t=r<<16|n<<8|i)>>18&63]+na[t>>12&63]+na[t>>6&63]+na[63&t]}return o?a.slice(0,o-3)+"===".substring(o):a},la=ta?function(e){return btoa(e)}:ra?function(e){return Buffer.from(e,"binary").toString("base64")}:ua,pa=ra?function(e){return Buffer.from(e).toString("base64")}:function(e){for(var t=[],r=0,n=e.length;r<n;r+=4096)t.push(oa.apply(null,e.subarray(r,r+4096)));return la(t.join(""))},fa=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?ca(pa(e)):pa(e)},ha=function(e){if(e=e.replace(/\s+/g,""),!aa.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,r,n,i="",a=0;a<e.length;)t=ia[e.charAt(a++)]<<18|ia[e.charAt(a++)]<<12|(r=ia[e.charAt(a++)])<<6|(n=ia[e.charAt(a++)]),i+=64===r?oa(t>>16&255):64===n?oa(t>>16&255,t>>8&255):oa(t>>16&255,t>>8&255,255&t);return i},ma=ea?function(e){return atob(da(e))}:ra?function(e){return Buffer.from(e,"base64").toString("binary")}:ha,va=ra?function(e){return sa(Buffer.from(e,"base64"))}:function(e){return sa(ma(e),(function(e){return e.charCodeAt(0)}))},ga=function(e){return va(ya(e))},ya=function(e){return da(e.replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})))},ba=fa,_a=ga;function Sa(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ka(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Sa(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sa(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var wa=function(){function e(t,n,i,a,o){r(this,e),this._pc=t,this._options=n,this._minitor=i,this._iceConfig=a,this._iceFeedback=o,this._offerAndAnswerICEOptions={offer:{},answer:{}}}var n,i,a,o;return Ee(e,[{key:"connect",value:(o=t(c.mark((function e(){var t;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._iceConfig){e.next=3;break}return e.next=3,this._getICEConfigFromServer();case 3:return e.next=5,this._createOffer();case 5:return t=e.sent,e.next=8,this._createAnswer(t);case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_getICEConfigFromServer",value:(a=t(c.mark((function e(){var t,r,n,i,a,o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={appID:this._options.appId,roomID:this._options.roomId,userID:this._options.userId,deviceID:this._options.deviceId,connectSessionID:Yt.v4(),os:"web",sdkVersion:this._options.sdkVersion,role:this._options.role,expectedAddr:this._options.expectedAddr},Array.isArray(this._iceFeedback)&&(t.feedbackInfo=this._iceFeedback,delete t.expectedAddr),r=["https://rtc-access.bytedance.com/dispatch/v1/AccessInfo?Action=GetAccessInfo","https://rtc-access2-hl.bytedance.com/dispatch/v1/AccessInfo?Action=GetAccessInfo"],(n=this._options.iceUrl)?"string"==typeof n?n=[n]:Array.isArray(n)||(n=r):n=r,this._minitor.eventLog("rtc_get_access",{message:JSON.stringify(t),type:"request",host:n.join(",")}),e.prev=6,i=n.map((function(e){return ir(e,t)})),e.next=10,Promise.race(i);case 10:if(a=e.sent,this._minitor.eventLog("rtc_get_access",{message:JSON.stringify(a),type:"response",error_code:a.code}),200===a.code){e.next=15;break}throw new qt("",qt.JOIN_ROOM_ERROR);case 15:if(o=a.nodes[0]){e.next=19;break}throw new qt("",qt.JOIN_ROOM_ERROR);case 19:this._iceConfig=o,e.next=25;break;case 22:throw e.prev=22,e.t0=e.catch(6),new qt(e.t0.message,qt.JOIN_ROOM_ERROR);case 25:case"end":return e.stop()}}),e,this,[[6,22]])}))),function(){return a.apply(this,arguments)})},{key:"_createOffer",value:(i=t(c.mark((function e(){var t,r,n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._iceConfig.iceParams,e.next=3,this._pc.createOffer();case 3:return r=e.sent,(n=Be.parse(r.sdp)).media&&n.media.forEach((function(e){e.direction="sendrecv",e.iceUfrag=t.clientIceUfrag,e.icePwd=t.clientIcePwd,e.iceOptions="renomination"})),this._offerAndAnswerICEOptions.offer={iceUfrag:t.clientIceUfrag,icePwd:t.clientIcePwd,iceOptions:"renomination"},r.sdp=Be.write(n),rt.debug("EstablishConnection _createOffer: \n",{sdp:r.sdp}),e.prev=9,e.next=12,this._pc.setLocalDescription(r);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(9),new qt(e.t0.message,qt.INVALID_SDP);case 17:return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this,[[9,14]])}))),function(){return i.apply(this,arguments)})},{key:"_createAnswer",value:(n=t(c.mark((function e(t){var r,n,i,a,o,s,d,u,l,p;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._iceConfig,n=r.publicIPs,i=r.certFingerprint,a=r.iceParams,r.iceConfig,r.msgKey,o=ka({},t),s=[],Array.isArray(n)&&(d=0,u=2130706431,n.forEach((function(e){rt.debug("publicIp: ",e.ip);var t={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&e.udpPorts.forEach((function(e){s.push(ka(ka({},t),{},{foundation:d++,transport:"udp",port:e,priority:u}))})),e.tcpPorts&&e.tcpPorts.forEach((function(e){s.push(ka(ka({},t),{},{foundation:d++,transport:"tcp",port:e,tcptype:"passive",priority:2130705431}))}))}))),l=this._getServerUfrag(a.serverIceUfrag),this._minitor.setConnectionId(l),o.media&&o.media.forEach((function(e){e.fingerprint||(e.fingerprint={type:"sha-256"}),e.fingerprint.hash=i,e.iceUfrag=l,e.icePwd=a.serverIcePwd,e.setup="active",e.candidates=s,e.iceOptions="renomination","application"===e.type&&(e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144})})),this._offerAndAnswerICEOptions.answer={fingerprint:{type:"sha-256",hash:i},iceUfrag:l,icePwd:a.serverIcePwd,setup:"active",candidates:s,iceOptions:"renomination"},p=new RTCSessionDescription({type:"answer",sdp:Be.write(o)}),rt.debug("EstablishConnection _createAnswer: \n",{sdp:p.sdp}),e.prev=10,e.next=13,this._pc.setRemoteDescription(p);case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(10),new qt(e.t0.message,qt.INVALID_SDP);case 18:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e){return n.apply(this,arguments)})},{key:"_concatenate",value:function(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];t+=s.length}for(var c=new e(t),d=0,u=0,l=n;u<l.length;u++){var p=l[u];c.set(p,d),d+=p.length}return c}},{key:"_getServerUfrag",value:function(e){var t=new TextEncoder,r=t.encode("PREC"),n=_a(e),i=t.encode(Date.now()).slice(0,4),a=new Uint8Array(4);a[0]=0,a[1]=1,a[2]=1,a[3]=1;var o=this._concatenate(Uint8Array,r,n,i,a);return ba(o)}},{key:"offerAndAnswerICEOptions",get:function(){return this._offerAndAnswerICEOptions}},{key:"iceConfig",get:function(){return this._iceConfig}}]),e}(),Ca={MESSAGE_DIRECTION_SEND:0,MESSAGE_DIRECTION_FEEDBACK:1},Aa=0,Ra=0;function Ta(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ea(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ta(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ta(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Vt(e);if(t){var i=Vt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ft(this,r)}}var Ia="idle",Pa="connected",Oa="closed",Da=function(e){jt(o,Pi);var n,i,a=xa(o);function o(e,t){var n;return r(this,o),(n=a.call(this))._dataChannel=e,n._dataChannelState=Pa,n._monitor=t,n._messageTypeCache=new Map,n._rttIds={},n._handleDataChannel(),n._resolveCallbacks=new Map,n._rejectCallbacks=new Map,n._timer={},n._p2pResolveCallbacks=new Map,n._p2pRejectCallbacks=new Map,n}return Ee(o,[{key:"destroy",value:function(){this._dataChannel&&(this._dataChannelState===Pa&&this._dataChannel.close(),this._dataChannel=null),this._dataChannelState=Ia,this._messageTypeCache=new Map,this._resolveCallbacks=new Map,this._rejectCallbacks=new Map,this._rttIds={};for(var e=0,t=Object.keys(this._timer);e<t.length;e++){var r=t[e];clearTimeout(this._timer[r])}this._timer={},this._p2pResolveCallbacks=new Map,this._p2pRejectCallbacks=new Map}},{key:"sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(i,a){var o=[2,5],s=e.id;"__web__rtc__rtt__"===(null==e?void 0:e.msg)&&(t._rttIds[s]=s,n=!0),t._monitor.eventLog("rtc_signaling",{direction:"up",signaling_event:"p2p",message:JSON.stringify(e)});var c=fr();o=o.concat(c),r||(t._p2pResolveCallbacks.set(s,i),t._p2pRejectCallbacks.set(s,a),t._timer[s]=setTimeout((function(){"__web__rtc__rtt__"!==(null==e?void 0:e.msg)?a(new qt("",qt.TIMEOUT)):i("timeout")}),2e4)),t._sendMessage(o,e,"p2p",n)}))}},{key:"_feedbackSignaling",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r=e.split("-").map((function(e){return+e})),n=[2,3];n=n.concat(r),this._sendMessage(n,"","".concat(t,"-res"))}},{key:"sendSignaling",value:function(e,t){var r=this;return new Promise((function(n,i){if(!r._dataChannel||"open"!==r._dataChannel.readyState)return i();var a=[2,1];r._monitor.eventLog("rtc_signaling",{direction:"up",signaling_event:e,message:JSON.stringify(t)});var o=fr();a=a.concat(o);var s=o.join("-");r._resolveCallbacks.set(s,n),r._rejectCallbacks.set(s,i),r._messageTypeCache.set(s,e),r._timer[s]=setTimeout((function(){i(new qt("",qt.TIMEOUT))}),1e4),r._sendMessage(a,t,e)}))}},{key:"_str2ab",value:function(e){return new Promise((function(t,r){var n=new Blob([e],{type:"text/plain"}),i=new FileReader;i.readAsArrayBuffer(n),i.onload=function(){t(i.result)}}))}},{key:"_ab2str",value:function(e){return new Promise((function(t,r){var n=new Blob([e]),i=new FileReader;i.readAsText(n,"utf-8"),i.onload=function(){t(i.result)}}))}},{key:"_concatenate",value:function(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];t+=s.length}for(var c=new e(t),d=0,u=0,l=n;u<l.length;u++){var p=l[u];c.set(p,d),d+=p.length}return c}},{key:"_sendMessage",value:(i=t(c.mark((function e(t,r,n,i){var a,o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i||rt.debug("[DCSignaling >>>>] ",n,"",r),e.next=3,this._str2ab(JSON.stringify([n,r]));case 3:a=e.sent,o=this._concatenate(Uint8Array,t,new Uint8Array(a)),this._dataChannel.send(o.buffer);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)})},{key:"_handleDataChannel",value:function(){var e=this;if(!this._dataChannel)throw new Error("[DCSignaling] data channel");this._dataChannel.onclose=function(){rt.debug("close"),e._dataChannelState=Oa},this._dataChannel.onerror=function(e){rt.debug(e)},this._dataChannel.onmessage=function(t){e._handleMessage(t.data)}}},{key:"_isByteId",value:function(e){return 128==(128&e)}},{key:"_dispartData",value:function(e){var t={messageType:0,compress:!1,direction:"ack"},r="",n=(new Uint8Array([]),new Uint8Array(e)),i=n[0],a=n[1],o=1&a;t.messageType=(60&a)>>2,t.compress=16==(16&i),t.direction=2==(2&a)?"ack":"send";var s=0;if(o||"ack"===t.direction){for(var c=2;c<=6;c++){var d=n[c];if(!this._isByteId(d)){s=c-2+1;break}}r=n.slice(2,2+s).join("-")}return{config:t,id:r,data:n.slice(2+s),needAck:o}}},{key:"_feedbackMessage",value:function(e){var t,r="__web__rtc__rtt__"===(null===(t=e=Ea({},e))||void 0===t?void 0:t.msg);e.dir=Ca.MESSAGE_DIRECTION_FEEDBACK,e.msg="",this.sendP2PMessage(e,!0,r)}},{key:"_handleFeedback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.id,r=this._p2pResolveCallbacks.get(t),n=this._p2pRejectCallbacks.get(t);switch(clearTimeout(this._timer[t]),this._p2pResolveCallbacks.delete(t),this._p2pRejectCallbacks.delete(t),e.err){case Ra:"function"==typeof r&&r();break;default:"function"==typeof n&&n(e)}}},{key:"_handleMessage",value:(n=t(c.mark((function e(t){var r,n,i,a,o,s,d,u,l,p,f,h,m,v,g,y;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._dispartData(t),n=r.config,i=r.id,a=r.data,o=r.needAck,s=a,n.compress&&((d=new ni.Inflate).push(s,!0),s=d.result),e.next=5,this._ab2str(s);case 5:u=e.sent,l=[],e.prev=7,l=JSON.parse(u),e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(7),e.abrupt("return");case 14:if(p="p2p",0!==n.messageType){e.next=21;break}"ack"===n.direction?(f=this._resolveCallbacks.get(i),h=this._rejectCallbacks.get(i),m=l[0]||{},clearTimeout(this._timer[i]),this._resolveCallbacks.delete(i),this._rejectCallbacks.delete(i),200===(null==m?void 0:m.code)?"function"==typeof f&&f(m):"function"==typeof h&&h(m),(p=this._messageTypeCache.get(i))&&(this._monitor.eventLog("rtc_signaling",{direction:"down",signaling_event:"".concat(p,"-ack"),message:JSON.stringify(l)}),this._messageTypeCache.delete(i))):Array.isArray(l)&&(p=l[0],l=l[1],this.emit(Ea(Ea({},l),{},{type:p})),this._monitor.eventLog("rtc_signaling",{direction:"down",signaling_event:p,message:JSON.stringify(l)})),rt.debug("[DCSignaling <<<<] ",p,"",l),o&&this._feedbackSignaling(i,p),e.next=33;break;case 21:if(1!==n.messageType){e.next=33;break}Array.isArray(l)&&(p=l[0],l=l[1]),y=null===(v=l)||void 0===v?void 0:v.id,this._rttIds[y]||"__web__rtc__rtt__"===(null===(g=l)||void 0===g?void 0:g.msg)?delete this._rttIds[y]:rt.debug("[DCSignaling <<<<] p2p",l),e.t1=l.dir,e.next=e.t1===Ca.MESSAGE_DIRECTION_SEND||e.t1===Ca.MESSAGE_DIRECTION_ACK?28:e.t1===Ca.MESSAGE_DIRECTION_FEEDBACK?31:33;break;case 28:return this.emit(Ea(Ea({},l),{},{type:"user-message-received"})),this._feedbackMessage(l),e.abrupt("break",33);case 31:return this._handleFeedback(l),e.abrupt("break",33);case 33:case"end":return e.stop()}}),e,this,[[7,11]])}))),function(e){return n.apply(this,arguments)})},{key:"dataChannelState",get:function(){return this.dataChannelState}}]),o}(),Ma="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGOfPtRkwAACidpQ0NQaWNjAAB42p2Wd1RU1xaHz713eqHNMAJSht67wADSe5NeRWGYGWAoAw4zNLEhogIRRUSaIkhQxIDRUCRWRLEQFFSwByQIKDEYRVQsb0bWi66svPfy8vvjrG/ts/e5++y9z1oXAJKnL5eXBksBkMoT8IM8nOkRkVF07ACAAR5ggCkATFZGul+wewgQycvNhZ4hcgJfBAHweli8AnDT0DOATgf/n6RZ6XyB6JgAEZuzORksEReIOCVLkC62z4qYGpcsZhglZr4oQRHLiTlhkQ0++yyyo5jZqTy2iMU5p7NT2WLuFfG2TCFHxIiviAszuZwsEd8SsUaKMJUr4jfi2FQOMwMAFElsF3BYiSI2ETGJHxLkIuLlAOBICV9x3Fcs4GQLxJdySUvP4XMTEgV0HZYu3dTamkH35GSlcAQCwwAmK5nJZ9Nd0lLTmbwcABbv/Fky4trSRUW2NLW2tDQ0MzL9qlD/dfNvStzbRXoZ+LlnEK3/i+2v/NIaAGDMiWqz84strgqAzi0AyN37YtM4AICkqG8d17+6D008L4kCQbqNsXFWVpYRl8MyEhf0D/1Ph7+hr75nJD7uj/LQXTnxTGGKgC6uGystJU3Ip2ekM1kcuuGfh/gfB/51HgZBnHgOn8MTRYSJpozLSxC1m8fmCrhpPDqX95+a+A/D/qTFuRaJ0vgRUGOMgNR1KkB+7QcoChEg0fvFXf+jb774MCB+eeEqk4tz/+83/WfBpeIlg5vwOc4lKITOEvIzF/fEzxKgAQFIAiqQB8pAHegAQ2AGrIAtcARuwBv4gxAQCVYDFkgEqYAPskAe2AQKQTHYCfaAalAHGkEzaAXHQSc4Bc6DS+AauAFug/tgFEyAZ2AWvAYLEARhITJEgeQhFUgT0ofMIAZkD7lBvlAQFAnFQgkQDxJCedBmqBgqg6qheqgZ+h46CZ2HrkCD0F1oDJqGfofewQhMgqmwEqwFG8MM2An2gUPgVXACvAbOhQvgHXAl3AAfhTvg8/A1+DY8Cj+D5xCAEBEaoooYIgzEBfFHopB4hI+sR4qQCqQBaUW6kT7kJjKKzCBvURgUBUVHGaJsUZ6oUBQLtQa1HlWCqkYdRnWgelE3UWOoWdRHNBmtiNZH26C90BHoBHQWuhBdgW5Ct6Mvom+jJ9CvMRgMDaONscJ4YiIxSZi1mBLMPkwb5hxmEDOOmcNisfJYfawd1h/LxAqwhdgq7FHsWewQdgL7BkfEqeDMcO64KBwPl4+rwB3BncEN4SZxC3gpvCbeBu+PZ+Nz8KX4Rnw3/jp+Ar9AkCZoE+wIIYQkwiZCJaGVcJHwgPCSSCSqEa2JgUQucSOxkniMeJk4RnxLkiHpkVxI0SQhaQfpEOkc6S7pJZlM1iI7kqPIAvIOcjP5AvkR+Y0ERcJIwkuCLbFBokaiQ2JI4rkkXlJT0klytWSuZIXkCcnrkjNSeCktKRcpptR6qRqpk1IjUnPSFGlTaX/pVOkS6SPSV6SnZLAyWjJuMmyZApmDMhdkxikIRZ3iQmFRNlMaKRcpE1QMVZvqRU2iFlO/ow5QZ2VlZJfJhslmy9bInpYdpSE0LZoXLYVWSjtOG6a9W6K0xGkJZ8n2Ja1LhpbMyy2Vc5TjyBXJtcndlnsnT5d3k0+W3yXfKf9QAaWgpxCokKWwX+GiwsxS6lLbpaylRUuPL72nCCvqKQYprlU8qNivOKekrOShlK5UpXRBaUaZpuyonKRcrnxGeVqFomKvwlUpVzmr8pQuS3eip9Ar6b30WVVFVU9VoWq96oDqgpq2Wqhavlqb2kN1gjpDPV69XL1HfVZDRcNPI0+jReOeJl6ToZmouVezT3NeS1srXGurVqfWlLactpd2rnaL9gMdso6DzhqdBp1buhhdhm6y7j7dG3qwnoVeol6N3nV9WN9Sn6u/T3/QAG1gbcAzaDAYMSQZOhlmGrYYjhnRjHyN8o06jZ4baxhHGe8y7jP+aGJhkmLSaHLfVMbU2zTftNv0dzM9M5ZZjdktc7K5u/kG8y7zF8v0l3GW7V92x4Ji4Wex1aLH4oOllSXfstVy2krDKtaq1mqEQWUEMEoYl63R1s7WG6xPWb+1sbQR2By3+c3W0DbZ9ojt1HLt5ZzljcvH7dTsmHb1dqP2dPtY+wP2ow6qDkyHBofHjuqObMcmx0knXackp6NOz51NnPnO7c7zLjYu61zOuSKuHq5FrgNuMm6hbtVuj9zV3BPcW9xnPSw81nqc80R7+nju8hzxUvJieTV7zXpbea/z7vUh+QT7VPs89tXz5ft2+8F+3n67/R6s0FzBW9HpD/y9/Hf7PwzQDlgT8GMgJjAgsCbwSZBpUF5QXzAlOCb4SPDrEOeQ0pD7oTqhwtCeMMmw6LDmsPlw1/Cy8NEI44h1EdciFSK5kV1R2KiwqKaouZVuK/esnIi2iC6MHl6lvSp71ZXVCqtTVp+OkYxhxpyIRceGxx6Jfc/0ZzYw5+K84mrjZlkurL2sZ2xHdjl7mmPHKeNMxtvFl8VPJdgl7E6YTnRIrEic4bpwq7kvkjyT6pLmk/2TDyV/SglPaUvFpcamnuTJ8JJ5vWnKadlpg+n66YXpo2ts1uxZM8v34TdlQBmrMroEVNHPVL9QR7hFOJZpn1mT+SYrLOtEtnQ2L7s/Ry9ne85krnvut2tRa1lre/JU8zblja1zWle/Hloft75ng/qGgg0TGz02Ht5E2JS86ad8k/yy/Febwzd3FygVbCwY3+KxpaVQopBfOLLVdmvdNtQ27raB7ebbq7Z/LGIXXS02Ka4ofl/CKrn6jek3ld982hG/Y6DUsnT/TsxO3s7hXQ67DpdJl+WWje/2291RTi8vKn+1J2bPlYplFXV7CXuFe0crfSu7qjSqdla9r06svl3jXNNWq1i7vXZ+H3vf0H7H/a11SnXFde8OcA/cqfeo72jQaqg4iDmYefBJY1hj37eMb5ubFJqKmz4c4h0aPRx0uLfZqrn5iOKR0ha4RdgyfTT66I3vXL/rajVsrW+jtRUfA8eEx55+H/v98HGf4z0nGCdaf9D8obad0l7UAXXkdMx2JnaOdkV2DZ70PtnTbdvd/qPRj4dOqZ6qOS17uvQM4UzBmU9nc8/OnUs/N3M+4fx4T0zP/QsRF271BvYOXPS5ePmS+6ULfU59Zy/bXT51xebKyauMq53XLK919Fv0t/9k8VP7gOVAx3Wr6103rG90Dy4fPDPkMHT+puvNS7e8bl27veL24HDo8J2R6JHRO+w7U3dT7r64l3lv4f7GB+gHRQ+lHlY8UnzU8LPuz22jlqOnx1zH+h8HP74/zhp/9kvGL+8nCp6Qn1RMqkw2T5lNnZp2n77xdOXTiWfpzxZmCn+V/rX2uc7zH35z/K1/NmJ24gX/xaffS17Kvzz0atmrnrmAuUevU18vzBe9kX9z+C3jbd+78HeTC1nvse8rP+h+6P7o8/HBp9RPn/4FA5jz/EHct2gAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAACXZwQWcAAAAwAAAAMADO7oxXAAAHsUlEQVRYw+1XfVSUVRp/ZgYGcPgc+TRNPgtRhDZELEhdPX62kZuSCGoqIIsalKUejazctW3LXE9ohoAppeDXKOdQIpsgioKCqwYKAwoCKSDDt8LAzNx+dwYExMMiq//1/s6ZM/e+931+z+e9zyX64/njGfARkJBEWgjx/xmIF5GBYJiliVBChqT3/1MI+ogQQOQwkoaPvfXRHj+yJGPSHzoF11UPAvTx2+0MERmRtb9XxUGNqi4z1I/sQDFEK4QQLCGzkFGBXIgYY06pT+bkkveNRqVhGk3J0fFeZANK0VDEG5AZ2cXPbkq7tg5CTCFaCF0l0Pml9etq76qZmnW2n/onudJwrBU8qWsMSWrgkBTWKmcsLxZCbCDaiEwcbPVdyJcC18c1tHYyFWuuWLeQRoP+CdykC6PlSNf06LYaNetg6T/QRHIgK7Ja7l62PT6M/kyL9D5I+KVN3QGKguPW3mQLcuHgxUvI2tszP6ajpZO1MyVLOUzTaCw5+k+8naRRN5SsiKAACnfaeqVMibf3m75aTc6IzKCyiQfWhGwX+5UcVimVrA1oZ8dkNJteJo/0rZ0d7ayTFZ13WkZLKTLqQIOyDRS/ppr50IiBbBB0QaQN7MiNr989o1K3sftaPGBHjtPrNIkmvRFSdOMBxu0diXtoEYVYRV8obsO4oXbVUthgBtsfU/J6SEADhNQIfjdB4TjsXNLwaycEtwCtwH12mBO8gtD+dfHXVY2tEFldPnUNBdPqTcmNKqzQpOwiT6TBI7mkyxUTiaXzKGd7R4fRTs5uQVPSt7RWdkB080O0sEMymkveNIHm0Krv0ps0zeyB+sfvYcOK8X8vruZqFOXYTEMuSfo6idekdL1X5S7FyXtptWk1p6ozmks64dUm1tgLTSyZx8CT3GBFoNfWopomkMoLng+hxcKoE7nNWFFdvWAJvYhA6/XWn9ek/YXPVRoV04HnTAtreASNLElGMyH+eRpDMyg8MZPP1jWHboYNYVuSFZoGplD+I5rGI5H1exMYoiY9/7OvkdU/hOIxqGcHZRD8IlnTc3BTQMjuO0oFa9B8t5cC6Z35/668j1WaxN1w4gjIFPQkpARe8z2SXMfuDYg6doATuJAFSUEz66WN12vrQJyWTotpiefHRff46CcZvQZ5w3oTGJMTTTtwtJbVDIha9qOOwAxfjCJfm/DsYk6c81/D5RRs90H+bT7KzDScCXkmPWEWYuBCMxJl1ezugKhmiToCUzjAhrzEwen5nDivSLqSgoZHZstrsCYrx/wv9AKUED1CsF92h/02IO6w/d0EBqgTD2HAyYucOEduFQGCNWeL7mLNmUsWbyIJzPsR7JNVscoBUcX2dROIsTG7mwacvsyJz9ww/hsFWa+5UMJH6TnG85BpFv0I9soq2O0BUcH29iFwC84rqQBxyiURXOT43uVKPjqWIfB/rAUJsnJWNiDKWUKPi6zIY8FqeX05ZnefpBUUNG1TgUI7kqHOXR+NgTNN332oR9Qt4GY/3GJx3QRGqJwJu7aXq24yeWdkAr1Di1Z9Vdp+k5Woo+NRjHyNsHcd2NNk/49PFp9XnFOcqz9bn9tc0FHKSllJH5SyPToCc3xubz394pkyzF2q89lCSygoLvkW1hQ8CNiKY8gRiSzsqWQjVJ43BdhtcN7mGOO40+Fbt7h5x/YUXFXKWXEvyFksJ3gB/rcit81RlY1yiDyYZ/AuBVusOJdfihVnq8ZEYrcdBZmCHgKxtjKn0AIKoVW0hqLoQ/rI8IuVqecab7DrD3GDfcsJXOGe0a5TCzPKMHelfVk8hVLg2xuL6/mK/dnCYOIHZ58NW4TCtoFmE2gyTYcHZ9ObFEQRgk2zE1N+u8auduEai5HRLBpHjgKPn7+uVl7DTFLh8A08AocOl2BFfmdEHL51h436/Q93KdcM3nMG1Tgc7rOww7w/Libu+iV1PuO4zHbwDPkTucdHKeoKMZPV4h9L4RQ0ObKo4grep1a5rOtKA1H/9kQMv0kQHBO8lmK/HEN+cNpq6y8+O5+lzGU5LJdt4weOD/ns+PRqYy47r4pOF63l+h9JkmtysOKTVIT7FRr5+FNZdxoLtdDjRxAaFG96g1Yabg5N/ak5m2WzL3VHpp9wfkRCWlPMZavNFEaBoZvKa3Lx9kS1x2fkDwdZ/u++ghOJYclInF+zaJlgw8wfDt7JYv/iLpoIzNEPm7PD6RNCBbuHFeYVskx2Wr02BQU3BWoZD66B5I2LMfJhLPI6iN7z2P7NxaidSAIP7DQ+sCQQswulwRknKtQZ7DSLLbbbSPOgkPXg20dd8K0QdF96i5ZLwozeRtPihPg4gOZVEM89ElurzGKn2KH6yTvRIb2GNyZP0gB39ab47GWImwGiMdr21xy/Djh7p3657Zemn9nxtqVHUUFzYa3lk7a/1BWNEUhfV2hvCw3FcJ4RNmR7miRcuPT7A4qoNPFamo86eg55KBra/WAY9kcLaC7R3g94EhjC2+40Vxzm/bnZ+7QQ1jlgzRBvObrOj99wuq97PD6mKExv5NVbSGZflJcU7hE+vTsav5hYgGIc4jMeO8Bw2CR8urdMTmGKLLOFs8wgXvT0r7LccbxhNtBeq57BTbmn4X8mwgf1/A4Bm4o+oeC48QAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAwOS0wOS0xM1QxNjoxMjo1OCswMjowMBbbrGkAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMDktMDktMTNUMTY6MTI6NTgrMDI6MDBnhhTVAAAAAElFTkSuQmCC",Na="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAABGdBTUEAALGOfPtRkwAACidpQ0NQaWNjAAB42p2Wd1RU1xaHz713eqHNMAJSht67wADSe5NeRWGYGWAoAw4zNLEhogIRRUSaIkhQxIDRUCRWRLEQFFSwByQIKDEYRVQsb0bWi66svPfy8vvjrG/ts/e5++y9z1oXAJKnL5eXBksBkMoT8IM8nOkRkVF07ACAAR5ggCkATFZGul+wewgQycvNhZ4hcgJfBAHweli8AnDT0DOATgf/n6RZ6XyB6JgAEZuzORksEReIOCVLkC62z4qYGpcsZhglZr4oQRHLiTlhkQ0++yyyo5jZqTy2iMU5p7NT2WLuFfG2TCFHxIiviAszuZwsEd8SsUaKMJUr4jfi2FQOMwMAFElsF3BYiSI2ETGJHxLkIuLlAOBICV9x3Fcs4GQLxJdySUvP4XMTEgV0HZYu3dTamkH35GSlcAQCwwAmK5nJZ9Nd0lLTmbwcABbv/Fky4trSRUW2NLW2tDQ0MzL9qlD/dfNvStzbRXoZ+LlnEK3/i+2v/NIaAGDMiWqz84strgqAzi0AyN37YtM4AICkqG8d17+6D008L4kCQbqNsXFWVpYRl8MyEhf0D/1Ph7+hr75nJD7uj/LQXTnxTGGKgC6uGystJU3Ip2ekM1kcuuGfh/gfB/51HgZBnHgOn8MTRYSJpozLSxC1m8fmCrhpPDqX95+a+A/D/qTFuRaJ0vgRUGOMgNR1KkB+7QcoChEg0fvFXf+jb774MCB+eeEqk4tz/+83/WfBpeIlg5vwOc4lKITOEvIzF/fEzxKgAQFIAiqQB8pAHegAQ2AGrIAtcARuwBv4gxAQCVYDFkgEqYAPskAe2AQKQTHYCfaAalAHGkEzaAXHQSc4Bc6DS+AauAFug/tgFEyAZ2AWvAYLEARhITJEgeQhFUgT0ofMIAZkD7lBvlAQFAnFQgkQDxJCedBmqBgqg6qheqgZ+h46CZ2HrkCD0F1oDJqGfofewQhMgqmwEqwFG8MM2An2gUPgVXACvAbOhQvgHXAl3AAfhTvg8/A1+DY8Cj+D5xCAEBEaoooYIgzEBfFHopB4hI+sR4qQCqQBaUW6kT7kJjKKzCBvURgUBUVHGaJsUZ6oUBQLtQa1HlWCqkYdRnWgelE3UWOoWdRHNBmtiNZH26C90BHoBHQWuhBdgW5Ct6Mvom+jJ9CvMRgMDaONscJ4YiIxSZi1mBLMPkwb5hxmEDOOmcNisfJYfawd1h/LxAqwhdgq7FHsWewQdgL7BkfEqeDMcO64KBwPl4+rwB3BncEN4SZxC3gpvCbeBu+PZ+Nz8KX4Rnw3/jp+Ar9AkCZoE+wIIYQkwiZCJaGVcJHwgPCSSCSqEa2JgUQucSOxkniMeJk4RnxLkiHpkVxI0SQhaQfpEOkc6S7pJZlM1iI7kqPIAvIOcjP5AvkR+Y0ERcJIwkuCLbFBokaiQ2JI4rkkXlJT0klytWSuZIXkCcnrkjNSeCktKRcpptR6qRqpk1IjUnPSFGlTaX/pVOkS6SPSV6SnZLAyWjJuMmyZApmDMhdkxikIRZ3iQmFRNlMaKRcpE1QMVZvqRU2iFlO/ow5QZ2VlZJfJhslmy9bInpYdpSE0LZoXLYVWSjtOG6a9W6K0xGkJZ8n2Ja1LhpbMyy2Vc5TjyBXJtcndlnsnT5d3k0+W3yXfKf9QAaWgpxCokKWwX+GiwsxS6lLbpaylRUuPL72nCCvqKQYprlU8qNivOKekrOShlK5UpXRBaUaZpuyonKRcrnxGeVqFomKvwlUpVzmr8pQuS3eip9Ar6b30WVVFVU9VoWq96oDqgpq2Wqhavlqb2kN1gjpDPV69XL1HfVZDRcNPI0+jReOeJl6ToZmouVezT3NeS1srXGurVqfWlLactpd2rnaL9gMdso6DzhqdBp1buhhdhm6y7j7dG3qwnoVeol6N3nV9WN9Sn6u/T3/QAG1gbcAzaDAYMSQZOhlmGrYYjhnRjHyN8o06jZ4baxhHGe8y7jP+aGJhkmLSaHLfVMbU2zTftNv0dzM9M5ZZjdktc7K5u/kG8y7zF8v0l3GW7V92x4Ji4Wex1aLH4oOllSXfstVy2krDKtaq1mqEQWUEMEoYl63R1s7WG6xPWb+1sbQR2By3+c3W0DbZ9ojt1HLt5ZzljcvH7dTsmHb1dqP2dPtY+wP2ow6qDkyHBofHjuqObMcmx0knXackp6NOz51NnPnO7c7zLjYu61zOuSKuHq5FrgNuMm6hbtVuj9zV3BPcW9xnPSw81nqc80R7+nju8hzxUvJieTV7zXpbea/z7vUh+QT7VPs89tXz5ft2+8F+3n67/R6s0FzBW9HpD/y9/Hf7PwzQDlgT8GMgJjAgsCbwSZBpUF5QXzAlOCb4SPDrEOeQ0pD7oTqhwtCeMMmw6LDmsPlw1/Cy8NEI44h1EdciFSK5kV1R2KiwqKaouZVuK/esnIi2iC6MHl6lvSp71ZXVCqtTVp+OkYxhxpyIRceGxx6Jfc/0ZzYw5+K84mrjZlkurL2sZ2xHdjl7mmPHKeNMxtvFl8VPJdgl7E6YTnRIrEic4bpwq7kvkjyT6pLmk/2TDyV/SglPaUvFpcamnuTJ8JJ5vWnKadlpg+n66YXpo2ts1uxZM8v34TdlQBmrMroEVNHPVL9QR7hFOJZpn1mT+SYrLOtEtnQ2L7s/Ry9ne85krnvut2tRa1lre/JU8zblja1zWle/Hloft75ng/qGgg0TGz02Ht5E2JS86ad8k/yy/Febwzd3FygVbCwY3+KxpaVQopBfOLLVdmvdNtQ27raB7ebbq7Z/LGIXXS02Ka4ofl/CKrn6jek3ld982hG/Y6DUsnT/TsxO3s7hXQ67DpdJl+WWje/2291RTi8vKn+1J2bPlYplFXV7CXuFe0crfSu7qjSqdla9r06svl3jXNNWq1i7vXZ+H3vf0H7H/a11SnXFde8OcA/cqfeo72jQaqg4iDmYefBJY1hj37eMb5ubFJqKmz4c4h0aPRx0uLfZqrn5iOKR0ha4RdgyfTT66I3vXL/rajVsrW+jtRUfA8eEx55+H/v98HGf4z0nGCdaf9D8obad0l7UAXXkdMx2JnaOdkV2DZ70PtnTbdvd/qPRj4dOqZ6qOS17uvQM4UzBmU9nc8/OnUs/N3M+4fx4T0zP/QsRF271BvYOXPS5ePmS+6ULfU59Zy/bXT51xebKyauMq53XLK919Fv0t/9k8VP7gOVAx3Wr6103rG90Dy4fPDPkMHT+puvNS7e8bl27veL24HDo8J2R6JHRO+w7U3dT7r64l3lv4f7GB+gHRQ+lHlY8UnzU8LPuz22jlqOnx1zH+h8HP74/zhp/9kvGL+8nCp6Qn1RMqkw2T5lNnZp2n77xdOXTiWfpzxZmCn+V/rX2uc7zH35z/K1/NmJ24gX/xaffS17Kvzz0atmrnrmAuUevU18vzBe9kX9z+C3jbd+78HeTC1nvse8rP+h+6P7o8/HBp9RPn/4FA5jz/EHct2gAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAAJiS0dEAP+Hj8y/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAACXZwQWcAAAAwAAAAMADO7oxXAAAD9UlEQVRYw+2Ya0wUVxTH/7PAwgo+l1WU9bG+RS0lqY1oNYKvpjWaGGOMxmht4tsPShpstBJbEm3QCssuIIiPTvWD/dIalagoqNFWa9oGoqAr8YVrKaKisuCy7Om5u1IeSrJXhm/OL5OdmZ17/nfOuXfuOQO837p0UxgdgnjX8VEXmA9GGLr5CGUZjSV0CEEEjN/G3U7Km4heLBWkZd913OeeiE6b8+SCt/FyCgayRIhWz6BwX8PQW2c5+GVtOVETFWRgPKL4mqKVeQOMkSNPfu1yetl8Ix3NQzw/QzctBERgw2GKi72yx10rjDeSm9RDmAYLX1c6b14ENmpefPlhT4OHTQte0UEViRjK/yidHTd69EB00qcPzjR5GtmwnwYhML2zAv5x0wuDrItr/m7ymW2mng50WuB1YA3Djm54cdfDJl28N+Oi/ZICorfB7G29j1DGwK7pZxlXlFr/2E117XhJ+VICYoYa0J3dYYTJRz+YzWO2zCs74q5rYHPteSElIALZ3dj/2PyKXRU2h81hd9hv2m/lPzztcnq8Lnr+Fmppn4RAkBiGuQvrK73UGg8H8zk9Y2Nv8ozyAhZQuP9GjCpIq/OKhn78R0875AnlSggYMAAfHdlbQ4HzmPZKCIRjMKbsO1DNzQKlmnKkBCxIyPmxiv4NmCrKlhCI4BunZ6v/kAzSAlmqkx4FjJOyZAXsaiU9pMqAEPfZZQVs6n16EDD3ySYrkKneIxkyZQWs6h2SwSorkKFWkAwZkgKJ6aqDbgeMg9KlJtoQTEu2lrkd1JZbHXKT9ki9i8yYFL3SXlj46Fz12dcU1Vypu+4tp7K3coN2SwiEoi9iMTd0vSm17w+mdFMGYzVnxatJxSerSrylVEKl7SihNIn1IJgTwiGYiLlYhtVYx6zHBmxEMraPzskuveb5i/5sgzj/XmpFC0MflojFJCRwsxmYiVn4HAuwApt679x6/kL9NfqjDVdph4SAP+/swY4ys4yFmw3FcIzGh5iK+Vil37bslxNPf6ff2pAqtej7cwqRSYQzEYxIAEwsF4fZWI7khEOHKy9Sa757h7xIaYWoYTgV4Pw5hnPQxdg4KjP9+rmmYiryUUzbNcnsgjl7jsQITOZ4rIvcufnSiYazVOgjRQOB/6sCdtUEHmMr9SlLj/9ce5pOMd9oItCS/po55LPxhbI58ad8ZwEV0FaNsuuWykxEIwFLsCnGtvvGr+6vcrWqD1qiYcJIfMLRWBu1bVFOzBqeNRpVOK2jYeFofIZFWMgO+4Az2DDtClnFF42eHI2x+JhfLLEYxGch2lbKIhrhPHCj2Tn9ta6TW1yl9814A/8Gdc3HhOZvFUpH5v8DfKpM3OEGjaEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMDktMDktMTNUMTY6MTI6NTgrMDI6MDAW26xpAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA5LTEzVDE2OjEyOjU4KzAyOjAwZ4YU1QAAAABJRU5ErkJggg==",La=function(e){var t=Ri(),r=50;if(t.elementId=e.elementId,t.media=e.media,t.id=e.id,t.stream=e.stream,t.div=document.createElement("div"),t.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),t.icon=document.createElement("img"),t.icon.setAttribute("id","volume_".concat(t.id)),t.icon.setAttribute("src",Ma),t.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),t.div.appendChild(t.icon),t.icon.onclick=function(e){e.stopPropagation(),t.media.muted?(t.media.muted=!1,t.icon.setAttribute("src",Ma),t.stream.local?t.stream.enableAudio():(t.picker.value=r,t.media.volume=t.picker.value/100)):(t.media.muted=!0,t.icon.setAttribute("src",Na),t.stream.local?t.stream.disableAudio():(r=t.picker.value,t.picker.value=0,t.media.volume=0))},!t.stream.local){t.picker=document.createElement("input"),t.picker.setAttribute("id","picker_".concat(t.id)),t.picker.type="range",t.picker.min=0,t.picker.max=100,t.picker.step=10,t.picker.value=r,t.picker.setAttribute("orient","vertical"),t.div.appendChild(t.picker),t.media.volume=t.picker.value/100,t.media.muted=!1,t.picker.onclick=function(e){return e.stopPropagation()},t.picker.oninput=function(){t.picker.value>0?(t.media.muted=!1,t.icon.setAttribute("src",Ma)):(t.media.muted=!0,t.icon.setAttribute("src",Na)),t.media.volume=t.picker.value/100};var n=function(e){t.picker.setAttribute("style","background: transparent; width: 32px;\n                                         height: 100px; position: absolute; bottom: 90%;\n                                         z-index: 1; right: 0px; -webkit-appearance: slider-vertical;\n                                         bottom: ".concat(t.div.offsetHeight-3,"px; display: ").concat(e))};t.div.onmouseover=function(){n("block")},t.div.onmouseout=function(){n("none")},n("none")}return document.getElementById(t.elementId).appendChild(t.div),t},Ba=function(e){var t=Ri(),r=null,n=e.id||Yt(),i=e.stream,a=e.options||{},o=null,s=null,c=document.getElementById("__recycle_media_bin__");c||((c=document.createElement("div")).setAttribute("id","__recycle_media_bin__"),c.style.display="none",document.body.appendChild(c));var d=document.getElementById(e.elementId);if(d)if(i){if(i.stream){var u,l,p,f,h,m=(u=a.fit,l=i,u?"contain"===u?"contain":"cover":l.desktopStreamId?"contain":"cover");p=d,Array.from(p.children).forEach((function(e){e.className.includes("bytestyle_player")&&(Ai(!1,"Please do not play stream more than one in one element. oldId:".concat(e.id," newId:").concat(n)),Array.from(e.children).filter((function(e){return e.id.indexOf("video")>-1||e.id.indexOf("audio")>-1})).forEach((function(e){e.removeAttribute("src"),e.load()})),p.removeChild(e))})),f=n,(h=document.createElement("div")).setAttribute("id","player_".concat(f)),h.setAttribute("class","bytestyle_player"),h.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),r=h,t.video=function(t,r){var n,i=null,o=null===(n=c)||void 0===n?void 0:n.getElementsByTagName("video");i=o&&o.length?o[0]:document.createElement("video");i.setAttribute("id","video".concat(t)),i.setAttribute("class","bytestyle_stream"),i.style.width="100%",i.style.height="100%",i.style.position="absolute",i.style.objectFit=m,e.mirror&&(i.style.transform="rotateY(180deg)");i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),i.playsinline=!0,r&&(i.muted=!0,i.setAttribute("muted",""));(!0===a.muteAudio||Ni())&&(i.muted=!0);return i}(n,i.local),t.audio=function(e,t){var r,n=null,i=null===(r=c)||void 0===r?void 0:r.getElementsByTagName("audio");n=i&&i.length?i[0]:document.createElement("audio");n.setAttribute("id","audio".concat(e)),n.setAttribute("class","bytestyle_stream"),n.setAttribute("style","width: 100%; height: 100%; position: absolute"),n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),n.playsinline=!0,t&&(n.muted=!0,n.setAttribute("muted",""));!0===a.muteAudio&&(n.muted=!0);return n}(n,i.local),!1!==a.loader&&(o=function(e){var t=document.createElement("img");return t.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),t.setAttribute("id","back_".concat(e)),t.setAttribute("class","bytestyle_loader"),t.setAttribute("src","data:image/gif;base64,R0lGODlhEAAQAPIAAAAAAP///zw8PLy8vP///5ycnHx8fGxsbCH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="),t}(n)),!1!==a.loader&&r.appendChild(o),r.appendChild(t.video),r.appendChild(t.audio),d.appendChild(r),i.local,Ai(d.contains(r),"Create Player failed."),vi("rtc_invoke_status",{sdk_api_name:"new player",message:"".concat(r.id," created in element: ").concat(e.elementId,"."),vid:i.getId(),stream_id:i.getServerId(),stream_user_id:i.uid,pc_session_id:i.pc&&i.pc.pc_session_id}),a.bar&&(s=function(e){var t,r=Ri();r.elementId=e.elementId,r.id=e.id,r.div=document.createElement("div"),r.div.setAttribute("id","bar_".concat(r.id)),r.div.setAttribute("class","bytestyle_bar"),r.bar=document.createElement("div"),r.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),r.bar.setAttribute("id","subbar_".concat(r.id)),r.bar.setAttribute("class","bytestyle_subbar");var n=function(e){var n=e;"block"!==e?n="none":clearTimeout(t),r.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display: ".concat(n))};return r.display=function(){n("block")},r.hide=function(){t=setTimeout(n,1e3)},document.getElementById(r.elementId).appendChild(r.div),r.div.appendChild(r.bar),e.stream.screen||void 0!==e.options&&void 0!==e.options.speaker&&!0!==e.options.speaker||(r.speaker=La({elementId:"subbar_".concat(r.id),id:r.id,stream:e.stream,media:e.media})),r.display(),r.hide(),r}({elementId:"player_".concat(n),id:n,stream:i,media:t.audio,options:a}),r.onmouseover=function(){s.display()},r.onmouseout=function(){s.hide()}),function(){var e=i.stream.getVideoTracks()[0];if(e&&e.getSettings){var t=e.getSettings();rt.verbose("[video getSettings] video(streamId=".concat(i.getId(),") width:").concat(t.width,"px, height:").concat(t.height,"px"))}}(),i.local&&(t.audio.volume=0),t.load=function(){try{t.video&&(rt.debug("."),t.video.load())}catch(e){}},t.mirror=function(e){t.video?t.video.style.transform=e?"rotateY(180deg)":"":rt.error("There is no video in this stream.")},t.destroy=function(){Ai(d.contains(r),"Please don't remove player twice."),vi("rtc_invoke_status",{sdk_api_name:"player_destroyed",message:"".concat(r.id," destroyed in element: ").concat(e.elementId),vid:i.getId(),stream_id:i.getServerId(),stream_user_id:i.uid,pc_session_id:i.pc&&i.pc.pc_session_id});try{for(t.audio.muted=!1,t.video.muted=!1,t.audio.volume=1,t.video.volume=1,t.video.pause(),t.audio.pause(),t.video.load(),t.audio.load();t.audio.attributes.length>0;)t.audio.removeAttribute(t.audio.attributes[0].name);for(;t.video.attributes.length>0;)t.video.removeAttribute(t.video.attributes[0].name);c.appendChild(t.video),c.appendChild(t.audio)}catch(e){Ai(!1,"catch in player.destroy: "+e.message)}d.contains(r)&&d.removeChild(r)};var v=tr((function(){i.emit({type:"first-local-video-render"})})),g=tr((function(){i.emit({type:"first-remote-video-render"})}));t.video.ontimeupdate=function(){i.firstVideoFrameReported||(i.local?v():g(),i.firstVideoFrameReported=!0),i.local||ja(t.video,i,"video")},t.video.onloadeddata=function(){if(rt.verbose("[video loadeddata] video(streamId=".concat(i.getId(),") width:").concat(t.video.videoWidth,"px, height:").concat(t.video.videoHeight,"px")),_(),!i.local){r=i.getId(),performance.mark(r+"_mark7");var e=nr(i.getId());rt.debug("performance: ",JSON.stringify(e)),vi("rtc_invoke_status",{sdk_api_name:"performance",message:e,stream_id:i.getServerId(),vid:i.getId()})}var r};var y=tr((function(){i.emit({type:"first-local-audio-render"})})),b=tr((function(){i.emit({type:"first-remote-audio-render"})}));return t.audio.ontimeupdate=function(){i.firstAudioFrameReported||(i.local?y():b(),i.firstAudioFrameReported=!0),i.local||ja(t.audio,i,"audio")},t.audio.onloadeddata=function(){if(_(),!i.local&&(t=i.getId(),performance.mark(t+"_mark6"),!i.video)){var e=nr(i.getId());rt.debug("performance: ",JSON.stringify(e)),vi("performance",{message:e,stream_id:i.getServerId(),vid:i.getId()})}var t},t.video.onresize=function(){rt.verbose("[video onresize] video(streamId=".concat(i.getId(),") width:").concat(t.video.videoWidth,"px, height:").concat(t.video.videoHeight,"px"))},t.isAudioPlaying=function(){return Mi()?!t.video.muted&&!t.video.paused:!!Ni()&&(!t.audio.muted&&!t.audio.paused)},t.playAudio=function(){Mi()?t.video.muted=!1:Ni()&&(t.audio.muted=!1,t.audio.play().catch((function(){})))},t.updateSrcObject=function(){var e,n;rt.info("updateSrcObject() called",i),i.hasVideo()&&i.stream&&(t.video.srcObject!==i.stream&&(t.video.srcObject=i.stream),Mi()&&t.video.play().catch((function(e){rt.warning("updateVideoObject, call play, err: ",e)}))),i.hasAudio()&&i.stream&&(t.audio.srcObject=(e=i,n=new MediaStream,e.stream.getAudioTracks().forEach((function(e){return n.addTrack(e)})),n),t.audio.play().catch((function(e){rt.warning("updateAudioObject, call play, err: ",e)}))),vi("rtc_invoke_status",{sdk_api_name:"player_update_src_object",message:{id:r.id,local:i.local,hasVideo:!!(t.video.srcObject&&t.video.srcObject.getVideoTracks().length>0),hasAudio:!!(t.audio.srcObject&&t.audio.srcObject.getAudioTracks().length>0)},stream_id:i.getServerId(),vid:i.getId(),stream_user_id:i.uid,pc_session_id:i.pc&&i.pc.pc_session_id})},t.updateSrcObject(),t}rt.warning("Create player failed, play stream should after stream-subscribed.")}else rt.warning("Create player failed, stream can not be null.");else rt.warning("Create player failed, can not find element with id: ".concat(e.elementId));function _(){o&&o.setAttribute("style","display: none")}};function ja(e,t,r){void 0===e.__cumulativeTime&&(e.__cumulativeTime=0),0!==e.currentTime&&(e.currentTime>e.__cumulativeTime&&function(){var n=Math.floor(1e3*(e.currentTime-e.__cumulativeTime)),i=e.currentTime-e.__cumulativeTime>.5,a={playTime:e.currentTime,isStall:i,stallCount:i?1:0,stallDuration:n%2e3};if("video"===r)t.recordedVideoFrames.push(a);else{if("audio"!==r)throw new Error("unknonw mediaType: ".concat(r));t.recordedAudioFrames.push(a)}}(),e.__cumulativeTime=e.currentTime)}function Ua(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Fa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fa(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Fa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Va=0,za=1,Ga=function(){function e(t,i){var a=this;if(r(this,e),n(this,"mergePeerStats",(function(e){if(e){var t=function(){return"video"===a.mediaType&&"up"===a.direction};e.results.forEach((function(e){!function(e){return e.googTrackId===a.trackId&&"ssrc"===e.type}(e)?t()&&function(e){return"VideoBwe"===e.type}(e)&&(a.googActualEncBitrate=e.googActualEncBitrate,a.googAvailableSendBandwidth=e.googAvailableSendBandwidth,a.googRetransmitBitrate=e.googRetransmitBitrate,a.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,a.googTargetEncBitrate=e.googTargetEncBitrate,a.googBucketDelay=e.googBucketDelay,a.googTransmitBitrate=e.googTransmitBitrate):t()?(a.googAvgEncodeMs=e.googAvgEncodeMs,a.googFrameRateInput=e.googFrameRateInput,a.googEncodeUsagePercent=e.googEncodeUsagePercent,a.googFrameRateSent=e.googFrameRateSent,a.googFrameWidthInput=e.googFrameWidthInput,a.googFrameHeightInput=e.googFrameHeightInput,a.packets=e.packetsSent||0,a.packetsLost=e.packetsLost||0,a.videoNetworkElapse=e.googRtt||0):"audio"===a.mediaType&&"up"===a.direction?(a.packets=e.packetsSent||0,a.packetsLost=e.packetsLost||0,a.audioNetworkElapse=e.googRtt||0,a.audioInputLevel=e.audioInputLevel):"audio"===a.mediaType&&"down"===a.direction&&(a.audioOutputLevel=e.audioOutputLevel,a.googDecodingNormal=e.googDecodingNormal)}))}})),n(this,"processCandidatePairReport",(function(e){a.icePairId=e.id,a.iceConsentRequestsSent=e.consentRequestsSent,a.iceRequestsSent=e.requestsSent,a.iceResponsesSent=e.responsesSent,a.iceRequestsReceived=e.requestsReceived,a.iceResponsesReceived=e.responsesReceived,a.iceCurrentRoundTripTime=e.currentRoundTripTime,a.iceTotalRoundTripTime=e.totalRoundTripTime,a.iceBytesReceived=e.bytesReceived,a.iceBytesSent=e.bytesSent,a.icePairState=e.state,a.iceNominated=e.nominated,a.icePairWritable=e.writable,a.icePairRTT=e.currentRoundTripTime,a.iceAvailableIncomingBitrate=e.availableIncomingBitrate,a.iceAvailableOutgoingBitrate=e.availableOutgoingBitrate})),n(this,"processLocalCandidate",(function(e){a.localCandidateType=e.candidateType,a.localIp=e.ip,a.localPort=e.port,a.localNetworkType=e.networkType,a.protocol=e.protocol})),n(this,"processRemoteCandidate",(function(e){a.remoteCandidateType=e.candidateType,a.remoteIp=e.ip,a.remotePort=e.port})),n(this,"processInboundReport",(function(e){a.bytes=e.bytesReceived,a.fractionLost=e.fractionLost,a.kind=e.kind||e.mediaType,a.ssrc=e.ssrc,a.packets=e.packetsReceived,a.packetsLost=e.packetsLost,"audio"===a.kind&&(a.jitter=e.jitter,a.concealedSamples=e.concealedSamples,a.totalSamplesReceived=e.totalSamplesReceived,a.fecPacketsReceived=e.fecPacketsReceived),"video"===a.kind&&(a.nackCount=e.nackCount,a.pliCount=e.pliCount,a.firCount=e.firCount)})),n(this,"processOutboundReport",(function(e){a.bytes=e.bytesSent,a.kind=e.kind||e.mediaType,a.ssrc=e.ssrc,"video"===a.kind&&(a.framesEncoded=e.framesEncoded,a.nackCount=e.nackCount,a.pliCount=e.pliCount,a.qpSum=e.qpSum),"audio"===a.kind&&(a.retransmittedBytesSent=e.retransmittedBytesSent,a.retransmittedPacketsSent=e.retransmittedPacketsSent,a.nackCount=e.nackCount)})),n(this,"processRemoteInboundRtp",(function(e){a.rtt=e.roundTripTime,a.roundTripTimeMeasurements=e.roundTripTimeMeasurements,a.jitter=e.jitter})),n(this,"processSendTrackReport",(function(e){switch(e.kind||a.kind){case"audio":break;case"video":a.frameHeight=e.frameHeight,a.frameWidth=e.frameWidth,a.framesSent=e.framesSent}a.trackId=e.trackIdentifier})),n(this,"processReceiveTrackReport",(function(e){switch(e.jitterBufferDelay&&e.jitterBufferEmittedCount&&(a.jitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount),e.kind||a.kind){case"audio":a.audioLevel=e.audioLevel,a.totalAudioEnergy=e.totalAudioEnergy,a.totalSamplesDuration=e.totalSamplesDuration;break;case"video":a.frameHeight=e.frameHeight,a.frameWidth=e.frameWidth,a.framesReceived=e.framesReceived,a.framesDecoded=e.framesDecoded,a.analyseDecoderError()}a.trackId=e.trackIdentifier})),n(this,"processCodec",(function(e){a.codec=e.mimeType.split("/")[1],a.clockRate=e.clockRate})),n(this,"processSendMediaSourceReport",(function(e){switch(e.kind||a.kind){case"audio":a.audioLevel=e.audioLevel,a.totalAudioEnergy=e.totalAudioEnergy,a.totalSamplesDuration=e.totalSamplesDuration}})),"video"!==t&&"audio"!==t)throw new Error("mediaType must be audio or video");if("up"!==i&&"down"!==i)throw new Error("direction must be up or down");this.mediaType=t,this.direction=i,this.error=Va,this.initMediaComputedProperties(),"video"===this.mediaType&&this.initVideoOnlyCoumputedProperties(),"video"===t&&(this.frameRateDecoded=0,this.frameRateEncoded=0,this.frameRateSent=0,this.frameRateReceived=0)}return Ee(e,[{key:"processStatisticReports",value:function(e){var t,r=Ua(e.values());try{for(r.s();!(t=r.n()).done;){var n=t.value;switch(this.timestamp!=n.timestamp&&this.updateTimestamp(n),n.type){case"candidate-pair":this.processCandidatePairReport(n);break;case"inbound-rtp":this.processInboundReport(n);break;case"outbound-rtp":this.processOutboundReport(n);break;case"remote-inbound-rtp":this.processRemoteInboundRtp(n);break;case"local-candidate":this.processLocalCandidate(n);break;case"remote-candidate":this.processRemoteCandidate(n);break;case"track":"up"===this.direction?this.processSendTrackReport(n):this.processReceiveTrackReport(n);break;case"codec":this.processCodec(n);break;case"media-source":"up"===this.direction&&this.processSendMediaSourceReport(n)}}}catch(e){r.e(e)}finally{r.f()}}},{key:"updateTimestamp",value:function(e){this.timestamp&&(this.timestampInterval=(e.timestamp-this.timestamp)/1e3),this.timestamp=e.timestamp}},{key:"initMediaComputedProperties",value:function(){var e=this;this.timestampInterval=1/0,this.packetsHistory=[],this.packetsLostHistory=[];var t=0;Object.defineProperty(this,"bytes",{enumerable:!0,get:function(){return t},set:function(r){r<e.bytes||(e.bitrate=Math.round(8*(r-e.bytes)/e.timestampInterval),e.bandwidth=Math.round(e.bitrate/1024),t=r)}});var r=0;Object.defineProperty(this,"packets",{enumerable:!0,get:function(){return r},set:function(t){for(e.packetsHistory.push(t-r);e.packetsHistory.length>30;)e.packetsHistory.shift();r=t}});var n=0;Object.defineProperty(this,"packetsLost",{enumerable:!0,get:function(){return n},set:function(t){for(e.packetsLostHistory.push(t-n);e.packetsLostHistory.length>30;)e.packetsLostHistory.shift();n=t}}),Object.defineProperty(this,"packetsLostRate",{enumerable:!0,get:function(){if(e.packetsHistory.length!==e.packetsLostHistory.length)return 0;if(!(e.packetsHistory.length<5)){if(e.packetsHistory<5)return 0;for(var t=0,r=e.packetsHistory.length,n=0;n<r;n++)0!==e.packetsHistory[n]&&(t+=100*e.packetsLostHistory[n]/e.packetsHistory[n]);return t/=r,Math.round(t)/100}}})}},{key:"initVideoOnlyCoumputedProperties",value:function(){var e=this,t=0;Object.defineProperty(this,"framesSent",{enumerable:!0,get:function(){return t},set:function(r){e.frameRateSent=Math.round((r-t)/e.timestampInterval),t=r}});var r=0;Object.defineProperty(this,"framesReceived",{enumerable:!0,get:function(){return r},set:function(t){e.frameRateReceived=Math.round((t-r)/e.timestampInterval),r=t}});var n=0;Object.defineProperty(this,"framesDecoded",{enumerable:!0,get:function(){return n},set:function(t){e.frameRateDecoded=Math.round((t-n)/e.timestampInterval),n=t}});var i=0;Object.defineProperty(this,"framesEncoded",{enumerable:!0,get:function(){return i},set:function(t){e.frameRateEncoded=Math.round((t-i)/e.timestampInterval),i=t}})}},{key:"analyseDecoderError",value:function(){this.frameRateReceived>0&&0===this.frameRateDecoded?this.error|=za:this.error&=~za}},{key:"getServerReportStats",value:function(){var e,t,r=this.getSharedServerReportStats();return"video"===this.mediaType&&"up"===this.direction?Object.assign(r,this.getSentVideoOnlyServerReportStats()):"video"===this.mediaType&&"down"===this.direction?Object.assign(r,this.getReceivedVideoOnlyServerReportStats()):"audio"===this.mediaType&&"up"===this.direction?Object.assign(r,this.getSentAudioOnlyServerReportStats()):"audio"===this.mediaType&&"down"===this.direction&&Object.assign(r,this.getReceivedAudioOnlyServerReportStats()),e=r,t={},Object.keys(e).forEach((function(r){t[Lt(r)]=e[r]})),t}},{key:"getSharedServerReportStats",value:function(){return{bandwidth:this.bandwidth,bitrate:this.bitrate,bytes:this.bytes,direction:this.direction,mediaType:this.mediaType,packets:this.packets,rtt:1e3*this.iceCurrentRoundTripTime,sentPingRequestsBeforeFirstResponse:this.iceRequestsSent,sentPingRequestsTotal:this.iceRequestsSent+this.iceConsentRequestsSent,sentPingResponses:this.iceResponsesSent,recvPingRequests:this.iceRequestsReceived,recvPingResponses:this.iceResponsesReceived,ssrc:this.ssrc,codec:this.codec,iceBytesReceived:100,iceBytesSent:this.iceBytesSent,icePairState:this.icePairState,icePairRTT:this.icePairRTT,icePairWritable:this.icePairWritable,icePairId:this.icePairId,iceNominated:1,localIp:this.localIp,localPort:this.localPort,localCandidateType:this.localCandidateType,localNetworkType:this.localNetworkType,protocol:this.protocol,remoteIp:this.remoteIp,remotePort:this.remotePort,remoteCandidateType:this.remoteCandidateType,iceAvailableIncomingBitrate:100,iceAvailableOutgoingBitrate:100}}},{key:"getSentVideoOnlyServerReportStats",value:function(){return{pliCount:this.pliCoun,firCount:this.firCount,nackCount:this.nackCount,qpSum:this.qpSum,frameSizeHeight:this.frameHeight,frameSizeWidth:this.frameWidth,frameRateSent:this.googFrameRateSent||this.frameRateSent||0,frameRateInput:this.googFrameRateInput||0,frameRateEncoded:this.frameRateEncoded,fractionLost:this.packetsLostRate,videoNetworkElapse:this.videoNetworkElapse,avgEncodeMs:this.googAvgEncodeMs||0,encodeUsagePercent:this.googEncodeUsagePercent||0,actualEncBitrate:this.googActualEncBitrate||0,availableSendBandwidth:this.googAvailableSendBandwidth||0,retransmitBitrate:this.googRetransmitBitrate||0,availableReceiveBandwidth:this.googAvailableReceiveBandwidth||0,targetEncBitrate:this.googTargetEncBitrate||0,bucketDelay:this.googBucketDelay||0,transmitBitrate:this.googTransmitBitrate||0}}},{key:"getReceivedVideoOnlyServerReportStats",value:function(){return{pliCount:this.pliCount,firCount:this.firCount,nackCount:this.nackCount,packetsLost:this.packetsLost,packetsLostRate:this.packetsLostRate,frameSizeHeight:this.frameHeight,frameSizeWidth:this.frameWidth,frameRateOutput:this.frameRateDecoded,frameRateReceived:this.frameRateReceived,frameRateDecoded:this.frameRateDecoded,fractionLost:this.packetsLostRate,jitterBufferDelay:this.jitterBufferDelay}}},{key:"getSentAudioOnlyServerReportStats",value:function(){return{sendLevel:this.audioInputLevel,audioLevel:this.audioLevel,volume:parseInt(255*this.audioLevel),totalAudioEnergy:this.totalAudioEnergy,totalSamplesDuration:this.totalSamplesDuration,fractionLost:this.packetsLostRate,audioNetworkElapse:this.audioNetworkElapse,retransmittedBytesSent:this.retransmittedBytesSent,retransmittedPacketsSent:this.retransmittedPacketsSent,nackCount:this.nackCount,roundTripTimeMeasurements:this.roundTripTimeMeasurements,jitter:this.jitter}}},{key:"getReceivedAudioOnlyServerReportStats",value:function(){return{recvLevel:this.audioOutputLevel,audioLevel:this.audioLevel,volume:parseInt(255*this.audioLevel),totalAudioEnergy:this.totalAudioEnergy,totalSamplesDuration:this.totalSamplesDuration,decodingNormal:this.googDecodingNormal,packetsLost:this.packetsLost,packetsLostRate:this.packetsLostRate,jitter:1e3*this.jitter,fractionLost:this.packetsLostRate,jitterBufferDelay:this.jitterBufferDelay,concealedSamples:this.concealedSamples,totalSamplesReceived:this.totalSamplesReceived,fecPacketsReceived:this.fecPacketsReceived}}},{key:"getSdkStats",value:function(){return"video"===this.mediaType&&"up"===this.direction?this.sentVideoStats:"video"===this.mediaType&&"down"===this.direction?this.recevedVideoStats:"audio"===this.mediaType&&"up"===this.direction?this.sentAudioStats:"audio"===this.mediaType&&"down"===this.direction?this.recevedAudioStats:void 0}},{key:"getClientStats",value:function(){return"video"===this.mediaType&&"up"===this.direction?{CaptureFrameRate:this.googFrameRateInput,CaptureResolutionHeight:this.googFrameHeightInput,CaptureResolutionWidth:this.googFrameWidthInput,EncodeDelay:this.googAvgEncodeMs,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,SendBitrate:this.bitrate/1e3,SendFrameRate:this.frameRateSent,SendResolutionHeight:this.frameHeight,SendResolutionWidth:this.frameWidth,TargetSendBitrate:0,TotalDuration:0,TotalFreezeTime:0}:"video"===this.mediaType&&"down"===this.direction?{End2EndDelay:0,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,RecvBitrate:this.bitrate/1e3,RecvResolutionHeight:this.frameHeight,RecvResolutionWidth:this.frameWidth,RenderFrameRate:this.frameRateDecoded,RenderResolutionHeight:this.frameHeight,RenderResolutionWidth:this.frameWidth,TotalFreezeTime:0,TotalPlayDuration:0,TransportDelay:parseInt(1e3*this.icePairRTT)}:"audio"===this.mediaType&&"up"===this.direction?{CodecType:this.codec,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,RecordingLevel:0|this.audioInputLevel,SamplingRate:this.totalSamplesDuration,SendBitrate:this.bitrate/1e3,SendLevel:this.totalAudioEnergy}:"audio"===this.mediaType&&"down"===this.direction?{CodecType:this.codec,End2EndDelay:0,MuteState:this.muted,PacketLossRate:100*this.packetsLostRate||0,RecvBitrate:this.bitrate/1e3,RecvLevel:this.audioOutputLevel,TotalFreezeTime:0,TotalPlayDuration:0,TransportDelay:parseInt(1e3*this.icePairRTT)}:void 0}},{key:"sentVideoStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),videoSentBytes:this.bytes,videoSentPackets:parseInt(this.packets),videoSentPacketsLost:parseInt(this.packetsLost),videoSentFrameRate:this.frameRateSent,videoSentEncodedFrameRate:this.frameRateEncoded,videoSentResolutionWidth:this.frameWidth,videoSentResolutionHeight:this.frameHeight}}},{key:"recevedVideoStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),videoReceivedBytes:this.bytes,videoReceivedPackets:this.packets,videoReceivedPacketsLost:this.packetsLost,videoReceivedFrameRate:this.frameRateReceived,videoReceivedDecodeFrameRate:this.frameRateDecoded,videoReceivedResolutionWidth:this.frameWidth,videoReceivedResolutionHeight:this.frameHeight}}},{key:"sentAudioStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),audioSentBytes:this.bytes,audioSentPackets:parseInt(this.packets),audioSentPacketsLost:parseInt(this.packetsLost)}}},{key:"recevedAudioStats",get:function(){return{accessDelay:Math.round(1e3*this.iceCurrentRoundTripTime),audioReceivedBytes:this.bytes,audioReceivedPackets:this.packets,audioReceivedPacketsLost:this.packetsLost}}}]),e}();function Ha(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Wa(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return qa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qa(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function qa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ja=function e(i){var a=this;r(this,e),n(this,"rawStatistics",[]),n(this,"clear",(function(){clearInterval(a.statInterval),clearInterval(a.eventLogInterval)})),n(this,"getStats",(function(){var e={};if(a.stream.getState()!==Bi.SUCCESS)return e;var t=a.rawStatistics.reduce((function(e,t){return Math.floor(Math.max(e,t.web_e2e_delay||1e3*t.jitter_buffer_delay))}),0);return Array.from(a.reportStatisticsMap.values()).forEach((function(r){Object.assign(e,r.getSdkStats()),"down"===r.direction&&(e.endToEndDelay=t,e.audioReceivedDelay=t,e.videoReceivedDelay=t)})),e})),n(this,"getVideoStats",(function(){var e,t={},r=Wa(a.reportStatisticsMap.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;"video"===n.mediaType&&(t=n.getClientStats())}}catch(e){r.e(e)}finally{r.f()}return t})),n(this,"getAudioStats",(function(){var e,t={},r=Wa(a.reportStatisticsMap.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;"audio"===n.mediaType&&(t=n.getClientStats())}}catch(e){r.e(e)}finally{r.f()}return t})),n(this,"reportStatisticsMap",new Map),n(this,"extractStreamStats",t(c.mark((function e(){var t,r,n,i,o,s;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.hasPeerConnection()){e.next=2;break}return e.abrupt("return",[]);case 2:if(a.stream.getState()!==Bi.IDLE&&a.stream.getState()!==Bi.CLOSED){e.next=4;break}return e.abrupt("return",[]);case 4:return a.dropDisconnectedTracksRtt(),t=a.stream.getTracksId(),r=a.stream.pc.peerConnection.getSenders?a.stream.pc.peerConnection.getSenders():[],n=r.filter((function(e){return t.includes(e.track&&e.track.id)})).map((function(e){return a.processSender(e)})),i=a.stream.pc.peerConnection.getReceivers?a.stream.pc.peerConnection.getReceivers():[],o=i.filter((function(e){return t.includes(e.track&&e.track.id)})).map((function(e){return a.processReceiver(e)})),s=wi(a.stream),e.next=13,Promise.all(n.concat(o));case 13:return e.abrupt("return",e.sent.filter((function(e){return e})).map((function(e){return Object.assign(e,s)})));case 14:case"end":return e.stop()}}),e)})))),n(this,"hasPeerConnection",(function(){return a.stream&&a.stream.pc&&a.stream.pc.peerConnection})),n(this,"processSender",(function(e){return a.processHandler(e,"up")})),n(this,"processReceiver",(function(e){return a.processHandler(e,"down")})),n(this,"processHandler",function(){var e=t(c.mark((function e(t,r){var n,i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.getStats||!t.track||"video"!==t.track.kind&&"audio"!==t.track.kind){e.next=13;break}return e.next=3,t.getStats();case 3:if(0!==(n=e.sent).size){e.next=6;break}return e.abrupt("return");case 6:return(i=a.reportStatisticsMap.get(t.track))||(i=new Ga(t.track.kind,r)),i.processStatisticReports(n),a.processTrackError(i),a.updateTrackRtt(i),a.reportStatisticsMap.set(t.track,i),e.abrupt("return",i.getServerReportStats());case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),n(this,"processTrackError",(function(e){if(e.error&za){var t="receive: ".concat(e.frameRateReceived," decode: ").concat(e.frameRateDecoded);vi("decoder_error",{message:t}),a.stream.emit(xi({type:"decoder-error",message:t,stream:a.stream}))}})),n(this,"dropDisconnectedTracksRtt",(function(){if(a.stream.stream){var e=a.stream.stream.getTracks().map((function(e){return e.id}));Array.from(a.stream.tracksRtt.keys()).forEach((function(t){e.includes(t)||a.stream.tracksRtt.delete(t)}))}})),n(this,"updateTrackRtt",(function(e){"succeeded"===e.icePairState&&a.stream.tracksRtt.set(e.trackId,{id:e.trackId,rtt:e.icePairRTT,type:e.mediaType,direction:e.direction})})),this.stream=i,this.statInterval=setInterval(t(c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.extractStreamStats();case 3:a.rawStatistics=e.sent,o(a.stream.getPCStats()),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),rt.error(e.t0),a.rawStatistics=[];case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),1e3),this.eventLogInterval=setInterval((function(){var e,t,r;a.rawStatistics.length>0&&(!i.local&&(e=a.rawStatistics,t=d(i,"video"),r=d(i,"audio"),rt.verbose("[stall] video:",t," audio",r),s(e,t,"video"),s(e,r,"audio")),a.rawStatistics.forEach((function(e){if("number"==typeof e.audio_level){var t=e.audio_level;e.audio_level=-10*Math.log10(Math.pow(t,2)),e.volume=255*t}vi("rtc_media_statistics",e)}))),i.hasData()&&vi("rtc_media_statistics",function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ha(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ha(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({media_type:"data",direction:i.local?"up":"down"},i.getMessageStatisticsAndClear()))}),2e3);var o=function(e){var t,r=Wa(a.reportStatisticsMap);try{for(r.s();!(t=r.n()).done;){var n=Re(t.value,2),i=n[0],o=n[1];o.mergePeerStats(e),o.muted=i.muted}}catch(e){r.e(e)}finally{r.f()}};function s(e,t,r){e.forEach((function(e){e.media_type===r&&(e.stall_count=t.stall_count,e.stall_duration=t.stall_duration,e.play_time=t.play_time,e.total_rtt_ms=t.total_rtt_ms,e.web_e2e_delay=-1,-1!==t.total_rtt_ms&&e.jitter_buffer_delay&&(e.web_e2e_delay=Math.floor(t.total_rtt_ms+1e3*e.jitter_buffer_delay)))}))}function d(e,t){var r=0,n=0,i=0,a=e.dataChannelRTT;if("video"===t)e.recordedVideoFrames.forEach(o),e.recordedVideoFrames.length||(n=2e3),e.recordedVideoFrames=[];else{if("audio"!==t)throw new Error("Unknow mediaType: ".concat(t));e.recordedAudioFrames.forEach(o),e.recordedAudioFrames.length||(n=2e3),e.recordedAudioFrames=[]}return{stall_count:r,stall_duration:n,play_time:i,total_rtt_ms:a};function o(e){e.isStall&&(r+=e.stallCount,n+=e.stallDuration),i=e.playTime}}};function Za(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ka(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Za(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Za(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Qa(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ya(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ya(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Ya(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Xa,$a,eo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e,i=Ri(),a=Bi.IDLE,o=e.streamId||"_init_"+Yt().slice(6),d=o;i.class="KernelStream",i.recordedVideoFrames=[],i.recordedAudioFrames=[],i.stream=r.stream,i.audioTransform=r.audioTransform||function(e,t){return t.enqueue(e)},i.videoTransform=r.videoTransform||function(e,t){return t.enqueue(e)},i.uid=r.uid,i.url=r.url,i.recording=r.recording,i.room=void 0,i.local=!1,i.video=r.video,i.audio=r.audio,i.screen=r.screen,i.data=r.data,i.enableMediaType={video:!0,audio:!0},i.videoSize=r.videoSize,i.videoFrameRate=r.videoFrameRate,i.extensionId=r.extensionId,i.desktopStreamId=r.desktopStreamId,i.actions={updateSubscribeState:Ui.FINISHED},i.sequenceId=-1,i.subState={audio:!1,video:!1},r.attributes&&r.attributes.videoDescriptions&&(i.videoDescriptions=r.attributes.videoDescriptions),i.audioMuted=!1,i.videoMuted=!1,i.minVideoBW=100,i.maxVideoBW=500,i.transportType="",i.Connection=Li,i.__logSignaling={},i.tracksRtt=new Map,i.qualityLayer={spatialLayer:1,temporalLayer:1};var u,l,p,f=0,h=0,m=0;i.remoteMSIp="",i.isManualPublished=!1,i.offer="",i.rttTimer=null,i.dataChannelRTT=-1,i.prevMediaOptions=null,i.senders={audio:null,video:null};var v=function(e){e.stream.id===i.getId()&&(i.stream=e.stream,i.emit(xi({type:"added",stream:e.stream})))},g=function(e){var t=e.senders,r=e.streamId;r!==i.getId()&&r!==i.getServerId()||t&&(i.senders=t)},y=function(e){e.stream.id===i.getId()&&i.emit(xi({type:"removed",stream:e.stream}))},b=function(e){switch(e){case"completed":case"connected":i.local&&i.setState(Bi.SUCCESS);break;case"closed":case"failed":i.setStateFailed(new Error("remote stream browser ice failed or closed"))}},_=function(e){return b(e.state)};if(!(void 0===i.videoSize||i.videoSize instanceof Array&&4===i.videoSize.length))throw Error("Invalid Video Size");void 0!==r.local&&!0!==r.local||(i.local=!0),i.local||w();var S=new Ja(i);function k(e){r.attributes=Object.assign(r.attributes||{},e)}function w(){if(!i.local&&i.room){var e=Date.now();i.dataChannelRTT=-1,i.room.sendP2PMessage(i.uid,"__web__rtc__rtt__").then((function(t){if("timeout"!==t){var r=Date.now()-e;r>0&&r<2e3&&(i.dataChannelRTT=r)}else clearTimeout(i.rttTimer)})).catch((function(e){clearTimeout(i.rttTimer)}))}i.rttTimer=setTimeout((function(){w()}),2e3)}i.setState=function(e){rt.debug("[stream] [state] sId: ".concat(i.getId().slice(0,5)," pcId: ").concat(i.pc&&i.pc.pc_session_id.slice(0,5)," state: ").concat(i.pc&&i.pc.peerConnection.iceConnectionState," from: ").concat(a.toString()," to: ").concat(e.toString())),vi("rtc_invoke_status",{sdk_api_name:"stream state change",vid:i.getId(),message:"from: ".concat(a.toString()," to: ").concat(e.toString()),stream_id:i.getServerId(),stream_user_id:i.uid,pc_session_id:i.pc&&i.pc.pc_session_id,conn_state:e.toString(),ice_state:i.pc&&i.pc.peerConnection.iceConnectionState}),a=e,i._state=e},i.getState=function(){return a},i.getRttMean=function(){if(i.getState()===Bi.SUCCESS){var e,t=0,r=Array.from(i.tracksRtt.keys()).length,n=Qa(i.tracksRtt);try{for(n.s();!(e=n.n()).done;){t+=Re(e.value,2)[1].rtt}}catch(e){n.e(e)}finally{n.f()}return t/r}return-1},i.getPCStats=function(){return i.pc&&i.pc.getPCStats()},i.getStats=function(e){var t=S.getStats();if(0!==Object.keys(t).length)return e&&e(t),t},i.getAudioStats=function(){return S.getAudioStats()},i.getVideoStats=function(){var e=S.getVideoStats();return e.TargetSendBitrate=i.maxVideoBW,e},i.getId=function(){return o},i.getServerId=function(){return d},i.setId=function(e){var t="".concat(o,": ").concat(d," -> ").concat(e);vi("rtc_invoke_status",{sdk_api_name:"stream_id_update",message:t}),i.pc&&i.pc.updateLocalStreamId(d,e),d=e},i.getAttributes=function(){if(!i.local)return r.attributes;var e,t=[];if(i.video&&(e={width:i.videoSize?parseInt(i.videoSize[2]):0,height:i.videoSize?parseInt(i.videoSize[3]):0,framerate:i.videoFrameRate?parseInt(i.videoFrameRate[1]):0,maxkbps:i.maxVideoBW?parseInt(i.maxVideoBW):0},t.push(e)),i.simulcast&&i.video){t=t.concat([{width:parseInt(e.width/2),height:parseInt(e.height/2),framerate:parseInt(e.framerate/2),maxkbps:parseInt(e.maxkbps/2)}])}return Ka(Ka({},r.attributes),{},{videoDescriptions:t})},i.getCustomData=function(){return r.customData},i.setLocalOptions=function(e){i.maxVideoBW=e.maxVideoBW,i.minVideoBW=e.minVideoBW,i.simulcast=e.simulcast,i.transportType=e.transportType},i.setMaxVideoBW=function(e){i.maxVideoBW=e},i.setMinVideoBW=function(e){i.minVideoBW=e},i.getLocalOptions=function(){return{simulcast:i.simulcast,minVideoBW:i.minVideoBW,maxVideoBW:i.maxVideoBW,transportType:i.transportType}},i.setRemoteOptions=function(e){i.data=!!e.data,i.setEnableMediaType({video:!1!==e.video,audio:!1!==e.audio}),i.transportType=e.transportType},i.getRemoteOptions=function(){return{data:i.data,video:i.enableMediaType.video,audio:i.enableMediaType.audio,transportType:i.transportType,qualityLayer:i.qualityLayer}},i.isAllActionsFinished=function(){return i.actions.updateSubscribeState===Ui.FINISHED},i.setEnableMediaType=function(e){i.enableMediaType.video=e.video,i.enableMediaType.audio=e.audio,i.player&&i.player.updateSrcObject&&i.player.updateSrcObject()},i.getEnableMediaType=function(){return i.enableMediaType},i.setAttributes=function(e){return i.local&&(k(e),i.room&&i.room.state===ji.CONNECTED&&i.room.dataChannelSignaling)?i.room.dataChannelSignaling.sendSignaling("updateStreamAttributes",{streamId:i.getServerId(),attributes:e}):Promise.resolve()},i.updateAttributesByServerEnd=k,i.hasDisableAudio=function(){if(!1===r.audio)return!0;if(r.attributes&&(!1===r.attributes.audiostream||!1===r.attributes.localaudio))return!0;if(i.room){var e=i.room.remoteUsers.get(i.uid);if(e&&!1===e.attributes.enableaudio)return!0}return!1},i.hasDisableVideo=function(){if(!1===r.video)return!0;if(r.attributes&&(!1===r.attributes.videostream||!1===r.attributes.localvideo))return!0;if(i.room){var e=i.room.remoteUsers.get(i.uid);if(e&&!1===e.attributes.enablevideo)return!0}return!1===i.enableMediaType.video},i.setAudioParam=function(e){i.audioParam=e},i.getAudioParam=function(){return i.audioParam},i.hasAudio=function(){return!1!==i.audio&&void 0!==i.audio},i.hasVideo=function(){return!1!==i.video&&void 0!==i.video},i.hasData=function(){return!1!==i.data&&void 0!==i.data},i.hasScreen=function(){return i.screen},i.hasMedia=function(){return i.audio||i.video||i.screen},i.isExternal=function(){return void 0!==i.url||void 0!==i.recording},i.removePC=function(){i.pc&&(i.pc.emitter.off("add-stream",v),i.pc.emitter.off("remove-stream",y),i.pc.emitter.off("ice-state-change",_),i.pc.emitter.off("add-senders",g),i.pc.refCount-=1,i.pc=null)},i.addPC=function(e){i.removePC(),i.pc=e,e.refCount+=1,i.pc.emitter.on("add-stream",v),i.pc.emitter.on("remove-stream",y),i.pc.emitter.on("ice-state-change",_),i.pc.emitter.on("add-senders",g)},i.init=function(e){i.screen?(i.videoSize=e.videoSize,i.videoFrameRate=e.videoFrameRate):(i.videoSize=e.videoSize||i.videoSize,i.videoFrameRate=e.videoFrameRate||i.videoFrameRate);try{if((r.audio||r.video||r.screen)&&void 0===r.url){rt.info("Requested access to local media");var t=r.video;t&&(t=!0===t?{}:t,void 0!==i.videoSize&&(t.width={min:i.videoSize[0],ideal:i.videoSize[2],max:i.videoSize[2]},t.height={min:i.videoSize[1],ideal:i.videoSize[3],max:i.videoSize[3]}),void 0!==i.videoFrameRate&&(t.frameRate={min:i.videoFrameRate[0],ideal:i.videoFrameRate[1],max:i.videoFrameRate[1]})),!0===r.screen&&(t={},e.videoSize&&(t.width=e.videoSize[0],t.height=e.videoSize[1]),e.videoFrameRate&&(t.frameRate=e.videoFrameRate[0]));var n={video:t,audio:r.audio,fake:r.fake,screen:r.screen,screenAudio:r.screenAudio,extensionId:i.extensionId,desktopStreamId:i.desktopStreamId};i.prevMediaOptions=n,i.Connection.GetUserMedia(n,(function(e){rt.info("User has granted access to local media."),i.stream=e,i.dispatchEvent(xi({type:"access-accepted"})),i.stream.getTracks().forEach((function(e){var t=e,r=t.kind;t.onended=function(e){rt.error("track.onended",e,r),vi("track_error",{message:"".concat(r," track ended"),stream_id:i.getServerId(),vid:i.getId(),log_type:Yi}),i.stream.getTracks().forEach((function(e){e.onended=null}));var t=xi({type:"track-ended",stream:i,message:r});i.dispatchEvent(t)}}))}),(function(e){rt.error("Failed to get access to local media. Error code was",e);var t=xi({type:"access-denied",code:e.code,message:e.name||e.message});i.dispatchEvent(t)}))}else{var a=xi({type:"access-accepted"});i.dispatchEvent(a)}}catch(e){rt.error("Failed to get access to local media. Error was",e);var o=xi({type:"access-denied",message:e});i.dispatchEvent(o)}},i.play=function(e,t){var r=t||{};i.elementId=e,e?(i.player&&(rt.warning("One Stream only play in one player. Removing Last Player."),i.player.destroy(),i.player=null),i.player=Ba({stream:i,elementId:e,mirror:!i.screen&&i.local,options:r})):rt.error("play(elementId): elementId can not be null.")},i.mirror=function(e){i.player?i.player.mirror(e):rt.warning("Stream is not playing.")},i.stop=function(){i.player&&(i.player.destroy(),i.player=void 0)},i.close=function(){if(i.stop(),clearTimeout(i.rttTimer),i.room&&i.room.state===ji.CONNECTED&&i.getState()!==Bi.CLOSED)try{i.local?i.room.unpublish(i):i.room.unsubscribe(i)}catch(e){rt.error("close stream error",i.local,e,i.getId())}if(i.local&&(i.stream&&i.stream.getTracks().forEach((function(e){var t=e;t.onended=null,rt.debug("that.close() -> track.stop()",t.onended),t.stop()})),i.stream=void 0),u&&"closed"!==u.state&&"function"==typeof u.close)try{u.close()}catch(e){rt.error("audioContext.close() error",e)}i.removePC(),S.clear()},i.removeStreamFromPC=function(){},i.removeLivingStream=function(){i.setState(Bi.CLOSED),i.local||(i.stream?(i.close(),delete i.stream):i.removePC())},i.applyBitreate=function(){if(i.pc&&i.pc.peerConnection&&i.stream){var e=i.stream.getVideoTracks();if(e.length){var t=i.pc.peerConnection.getSenders();if(t.length){var r=e[0];t.forEach((function(e){if(e.track===r){var t=e.getParameters();t.encodings&&t.encodings.length||(t.encodings=[{}]),rt.debug("setBitrate, max: ".concat(i.maxVideoBw,", min: ").concat(i.minVideoBW)),t.encodings[0].maxBitrate=1e3*i.maxVideoBW,t.encodings[0].minBitrate=1e3*i.minVideoBW,e.setParameters(t)}}))}}}};var C=function(){if(i.player&&i.stream){var e,t=i.player.video,r=document.defaultView.getComputedStyle(t),n=parseInt(r.getPropertyValue("width"),10),a=parseInt(r.getPropertyValue("height"),10),o=parseInt(r.getPropertyValue("left"),10),c=parseInt(r.getPropertyValue("top"),10);e="object"===s(i.elementId)&&"function"==typeof i.elementId.appendChild?i.elementId:document.getElementById(i.elementId);var d=document.defaultView.getComputedStyle(e),u=parseInt(d.getPropertyValue("width"),10),l=parseInt(d.getPropertyValue("height"),10),p=document.createElement("canvas");return p.id="testing",p.width=u,p.height=l,p.setAttribute("style","display: none"),p.getContext("2d").drawImage(t,o,c,n,a),p}return null};i.getVideoFrameURL=function(e){var t=C();return null!==t?e?t.toDataURL(e):t.toDataURL():null},i.getVideoFrame=function(){var e=C();return null!==e?e.getContext("2d").getImageData(0,0,e.width,e.height):null},i.checkOptions=function(e,t){var r=e;!0===t?(r.audio||r.screen)&&(rt.warning("Cannot update type of subscription"),r.audio=void 0,r.screen=void 0):!1===i.local&&(!0===r.video&&!1===i.hasVideo()&&(rt.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),r.video=!1),!0===r.audio&&!1===i.hasAudio()&&(rt.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),r.audio=!1)),!1===i.local&&(i.hasVideo()||!0!==r.slideShowMode||(rt.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),r.slideShowMode=!1))};var A=function(e){return!!i.stream&&("audio"===e&&i.stream.getAudioTracks().length>0?(i.stream.getAudioTracks().forEach((function(e){return e.enabled=!i.audioMuted})),!0):"video"===e&&i.stream.getVideoTracks().length>0&&(i.stream.getVideoTracks().forEach((function(e){return e.enabled=!i.videoMuted})),!0))};return i.enableAudio=function(){i.audioMuted=!1;var e=A("audio");return i.local&&i.setAttributes({audiostream:!i.audioMuted}),e},i.disableAudio=function(){i.audioMuted=!0;var e=A("audio");return i.local&&i.setAttributes({audiostream:!i.audioMuted}),e},i.enableVideo=function(){i.videoMuted=!1;var e=A("video");return i.local&&i.setAttributes({videostream:!i.videoMuted}),e},i.disableVideo=function(){i.videoMuted=!0;var e=A("video");return i.local&&i.setAttributes({videostream:!i.videoMuted}),e},i.unmuteAudio=i.enableAudio,i.unmuteVideo=i.enableVideo,i.muteAudio=i.disableAudio,i.muteVideo=i.disableVideo,i.isAudioPlaying=function(){return i.player&&i.player.isAudioPlaying()},i.playAudio=function(){return i.player&&i.player.playAudio()},i.saveOffer=function(e){i.offer=e},i._setStaticQualityLayer=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n={qualityLayer:{spatialLayer:e,temporalLayer:t}};i.qualityLayer=n.qualityLayer,i.pc?(i.checkOptions(n,!0),i.room.updateSpec(i.getServerId(),{type:"updatestream",config:n},!i.local)):r("This stream has no peerConnection attached, ignoring")},i._setDynamicQualityLayer=function(e){var t={qualityLayer:{spatialLayer:-1,temporalLayer:-1}};i.checkOptions(t,!0),i.pc?(i.checkOptions(t,!0),i.room.updateSpec(i.getServerId(),{type:"updatestream",config:t},!i.local)):e("This stream has no peerConnection attached, ignoring")},i.updateConfiguration=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(e)if(i.local)if(i.stream){var r=i.stream.getVideoTracks()[0];r?r.applyConstraints(e).then((function(){t()})).catch((function(e){t(e)})):t(new Error("no videoTrack"))}else t(new Error("no mediaStream"));else t(new Error("not local stream"));else t(new Error("no config"))},i.setStateFailed=function(e){return i.getState()===Bi.IDLE||i.getState()===Bi.FAILED||i.getState()===Bi.CLOSED?(clearTimeout(i.rttTimer),!1):(rt.error("setStateFailed",e.message,i.getId()),i.setState(Bi.FAILED),!0)},i.setMediaStream=function(e){if(i.stream=e,e.getAudioTracks().length>0){var t=e.getAudioTracks()[0];i.audio=!0,i.audioMuted=t.muted}if(e.getVideoTracks().length>0){i.video=!0;var r=e.getVideoTracks()[0],n={width:0,height:0,frameRate:0};"function"==typeof r.getSettings&&(n=r.getSettings()),i.videoSize=[120,120,n.width,n.height];var a=n.frameRate;i.videoFrameRate=[a>15?15:10,a],i.videoMuted=r.muted}},i.createOffer=function(e,t){return i.pc.createOffer(e,i.stream,i.getServerId(),t)},i.getMessageStatisticsAndClear=function(){var e={dc_send_total:f,dc_send_ack:h,dc_cost_time:m};return f=0,h=0,m=0,e},i.isIceConnected=function(){return i.pc&&("connected"===i.pc.peerConnection.iceConnectionState||"completed"===i.pc.peerConnection.iceConnectionState)},i.getTracksId=function(){return i.stream?i.stream.getTracks().map((function(e){return e.id})):[]},i.enableLocalTrack=function(){var e=t(c.mark((function e(t,o,s){var d,u,l,p,f;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.stream){e.next=2;break}return e.abrupt("return",!1);case 2:if(d=o[0].toUpperCase()+o.slice(1),u=i.stream["get".concat(d,"Tracks")](),!(!t&&!u.length||t&&u.length)){e.next=6;break}return e.abrupt("return");case 6:if(a!==Bi.SUCCESS){e.next=10;break}if(i.pc&&i.pc.peerConnection){e.next=9;break}return e.abrupt("return",!1);case 9:i.setAttributes(Object.assign(r.attributes||{},n({},"local".concat(o),t))).catch((function(){return!1}));case 10:if(t){e.next=17;break}l=u[0],a===Bi.SUCCESS&&i.senders[o]&&i.senders[o].replaceTrack(null),i.stream.removeTrack(l),l.stop(),e.next=29;break;case 17:return i.prevMediaOptions[o]||(!0,i.prevMediaOptions[o]=!0),i[o]=!0,e.next=22,navigator.mediaDevices.getUserMedia(n({},o,i.prevMediaOptions[o]));case 22:if(p=e.sent,(f=p["get".concat(d,"Tracks")]()).length){e.next=26;break}return e.abrupt("return",!1);case 26:a===Bi.SUCCESS&&i.senders[o]&&i.senders[o].replaceTrack(f[0]),i.stream.addTrack(f[0]),i.player&&i.player.updateSrcObject&&i.player.updateSrcObject();case 29:return e.abrupt("return",!0);case 30:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),i.getAudioTrack=function(){return i.stream&&i.stream.getAudioTracks().length>0?i.stream.getAudioTracks()[0]:null},i.getAudioLevel=function(){if(!i.getAudioTrack())return 0;var e=i.getCurrentTimeDomainData(),t=0;return e.forEach((function(e){return t=Math.max(t,Math.abs(e-128))})),t/128*255},i.getCurrentTimeDomainData=function(){i._setMediaStreamSource();var e=new Uint8Array(2048);return p&&p.getByteTimeDomainData(e),e},i._setMediaStreamSource=function(){if(!p)if(i.stream){var e=window.AudioContext||window.webkitAudioContext;u=new e,l=u.createMediaStreamSource(i.stream),p=u.createAnalyser(),l.connect(p)}else rt.warning("no has stream",i.getId(),i)},i.updateAudioSource=function(){p&&(i.stream?(l&&l.disconnect(),(l=u.createMediaStreamSource(i.stream)).connect(p)):rt.warning("no has stream",i.getId(),i))},i},to=function(){var e={},t={};return e.add=function(e,r){t[e]=r},e.get=function(e){return t[e]},e.has=function(e){return void 0!==t[e]},e.forEach=function(e){for(var r=Object.keys(t),n=0;n<r.length;n+=1){var i=r[n];e(t[i],i)}},e.keys=function(){return Object.keys(t)},e.values=function(){return Object.values(t)},e.remove=function(e){delete t[e]},e},ro=0,no=0;var io=function(e,t,r){var n=t&&r||0,i=t||[],a=(e=e||{}).node||Xa,o=void 0!==e.clockseq?e.clockseq:$a;if(null==a||null==o){var s=Jt();null==a&&(a=Xa=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=$a=16383&(s[6]<<8|s[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),d=void 0!==e.nsecs?e.nsecs:no+1,u=c-ro+(d-no)/1e4;if(u<0&&void 0===e.clockseq&&(o=o+1&16383),(u<0||c>ro)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ro=c,no=d,$a=o;var l=(1e4*(268435455&(c+=122192928e5))+d)%4294967296;i[n++]=l>>>24&255,i[n++]=l>>>16&255,i[n++]=l>>>8&255,i[n++]=255&l;var p=c/4294967296*1e4&268435455;i[n++]=p>>>8&255,i[n++]=255&p,i[n++]=p>>>24&15|16,i[n++]=p>>>16&255,i[n++]=o>>>8|128,i[n++]=255&o;for(var f=0;f<6;++f)i[n+f]=a[f];return t||Qt(i)},ao=Yt;function oo(e,t){Object.values(t).forEach((function(t){for(var r=0;r<t.length;r++)if("msid"===t[r].attribute){var n,i=t[r].value.split(" "),a=Re(i,1)[0];e[a]||(e[a]=[]),(n=e[a]).push.apply(n,tt(t))}}))}function so(e){var t={},r={},n={};return e.media.forEach((function(e){if("audio"===e.type){if(e.ssrcs){for(var i={};e.ssrcs.length;){var a=e.ssrcs.shift();i[a.id]?i[a.id].push(a):i[a.id]=[a]}oo(t,i)}}else if("video"===e.type)if(e.ssrcGroups){var o={};e.ssrcGroups.forEach((function(e){n[e.ssrcs]=e;var t=e.ssrcs.split(" "),r=Re(t,2),i=r[0],a=r[1];o[i]=[],o[a]=[]})),e.ssrcs&&e.ssrcs.forEach((function(e){Array.isArray(o[e.id])&&o[e.id].push(e)})),oo(r,o)}else if(e.ssrcs){for(var s={};e.ssrcs.length;){var c=e.ssrcs.shift();s[c.id]?s[c.id].push(c):s[c.id]=[c]}oo(r,s)}})),{audioSSRCS:t,videoSSRCS:r,videoGroups:n}}ao.v1=io,ao.v4=Yt;var co=new Je,uo=function(){function e(){var t=this;r(this,e),n(this,"beginGetStats",tr((function(){!function(e,t,r){var n,i="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(n="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:i,getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(n.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},n.HTMLVideoElement=function(){}),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(n.screen={width:0,height:0}),"undefined"==typeof URL&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),"undefined"==typeof MediaStreamTrack&&(n.MediaStreamTrack=function(){}),void 0===a&&(n.RTCPeerConnection=function(){}),n.window=global);var a=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"==typeof MediaStreamTrack&&(MediaStreamTrack={});var o={encryption:"sha-256",audio:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},video:{send:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},recv:{tracks:[],codecs:[],availableBandwidth:0,streams:0,framerateMean:0,bitrateMean:0},bytesSent:0,bytesReceived:0,latency:0,packetsLost:0},bandwidth:{systemBandwidth:0,sentPerSecond:0,encodedPerSecond:0,helper:{audioBytesSent:0,videoBytestSent:0},speed:0},results:{},connectionType:{systemNetworkType:((navigator.connection||{}).type||"unknown").toString().toLowerCase(),systemIpAddress:"192.168.1.2",local:{candidateType:[],transport:[],ipAddress:[],networkType:[]},remote:{candidateType:[],transport:[],ipAddress:[],networkType:[]}},resolutions:{send:{width:0,height:0},recv:{width:0,height:0}},internal:{audio:{send:{},recv:{}},video:{send:{},recv:{}},candidates:{}},nomore:function(){l=!0}},c={checkIfOfferer:function(e){"googLibjingleSession"===e.type&&(o.isOfferer=e.googInitiator)}},d=Mi(),u=this;if(!(arguments[0]instanceof a))throw"1st argument is not instance of RTCPeerConnection.";u=arguments[0],arguments[1]instanceof MediaStreamTrack&&(e=arguments[1],t=arguments[2],r=arguments[3]);var l=!1;function p(){f((function(e){if(e&&e.forEach){e.forEach((function(e){Object.keys(c).forEach((function(t){if("function"==typeof c[t])try{c[t](e)}catch(e){console.error(e.message,e.stack,e)}}))}));try{-1!==u.iceConnectionState.search(/failed|closed/gi)&&(l=!0)}catch(e){l=!0}!0===l&&(o.datachannel&&(o.datachannel.state="close"),o.ended=!0),o.results=e,o.audio&&o.video&&(o.bandwidth.speed=o.audio.bytesSent-o.bandwidth.helper.audioBytesSent+(o.video.bytesSent-o.bandwidth.helper.videoBytesSent),o.bandwidth.helper.audioBytesSent=o.audio.bytesSent,o.bandwidth.helper.videoBytesSent=o.video.bytesSent),t(o),l||null!=s(r)&&r&&setTimeout(p,r||1e3)}}))}function f(e){void 0!==window.InstallTrigger||d?u.getStats(window.mediaStreamTrack||null).then((function(t){var r=[];t.forEach((function(e){r.push(e)})),e(r)})).catch(e):u.getStats((function(t){var r=[];t.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)})),e(r)}))}function h(e){var t=e.isRemote;return void 0===t&&("remote-inbound-rtp"===e.type||"remote-outbound-rtp"===e.type)}c.datachannel=function(e){"datachannel"===e.type&&(o.datachannel={state:e.state})},c.googCertificate=function(e){"googCertificate"==e.type&&(o.encryption=e.googFingerprintAlgorithm),"certificate"==e.type&&(o.encryption=e.fingerprintAlgorithm)},c.checkAudioTracks=function(e){if("audio"===e.mediaType){var t=h(e),r=e.id.split("_").pop();if(!0===t?r="recv":!1===t&&(r="send"),r){if(-1===o.audio[r].codecs.indexOf(e.googCodecName||"opus")&&o.audio[r].codecs.push(e.googCodecName||"opus"),e.bytesSent){var n=0;o.internal.audio[r].prevBytesSent||(o.internal.audio[r].prevBytesSent=e.bytesSent);var i=e.bytesSent-o.internal.audio[r].prevBytesSent;o.internal.audio[r].prevBytesSent=e.bytesSent,n=i/1024,o.audio[r].availableBandwidth=n.toFixed(1),o.audio.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,o.internal.audio[r].prevBytesReceived||(o.internal.audio[r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-o.internal.audio[r].prevBytesReceived,o.internal.audio[r].prevBytesReceived=e.bytesReceived,n=i/1024,o.audio.bytesReceived=n.toFixed(1)),e.googTrackId&&-1===o.audio[r].tracks.indexOf(e.googTrackId)&&o.audio[r].tracks.push(e.googTrackId),e.googCurrentDelayMs&&(n=0,o.internal.audio.prevGoogCurrentDelayMs||(o.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs),i=e.googCurrentDelayMs-o.internal.audio.prevGoogCurrentDelayMs,o.internal.audio.prevGoogCurrentDelayMs=e.googCurrentDelayMs,o.audio.latency=i.toFixed(1),o.audio.latency<0&&(o.audio.latency=0)),e.packetsLost&&(n=0,o.internal.audio.prevPacketsLost||(o.internal.audio.prevPacketsLost=e.packetsLost),i=e.packetsLost-o.internal.audio.prevPacketsLost,o.internal.audio.prevPacketsLost=e.packetsLost,o.audio.packetsLost=i.toFixed(1),o.audio.packetsLost<0&&(o.audio.packetsLost=0))}}},c.checkVideoTracks=function(e){if("video"===e.mediaType){var t=h(e),r=e.id.split("_").pop();if(!0===t?r="recv":!1===t&&(r="send"),r){if(-1===o.video[r].codecs.indexOf(e.googCodecName||"VP8")&&o.video[r].codecs.push(e.googCodecName||"VP8"),e.bytesSent){var n=0;o.internal.video[r].prevBytesSent||(o.internal.video[r].prevBytesSent=e.bytesSent);var i=e.bytesSent-o.internal.video[r].prevBytesSent;o.internal.video[r].prevBytesSent=e.bytesSent,n=i/1024,o.video[r].availableBandwidth=n.toFixed(1),o.video.bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,o.internal.video[r].prevBytesReceived||(o.internal.video[r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-o.internal.video[r].prevBytesReceived,o.internal.video[r].prevBytesReceived=e.bytesReceived,n=i/1024,o.video.bytesReceived=n.toFixed(1)),e.googFrameHeightReceived&&e.googFrameWidthReceived&&(o.resolutions[r].width=e.googFrameWidthReceived,o.resolutions[r].height=e.googFrameHeightReceived),e.googFrameHeightSent&&e.googFrameWidthSent&&(o.resolutions[r].width=e.googFrameWidthSent,o.resolutions[r].height=e.googFrameHeightSent),e.googTrackId&&-1===o.video[r].tracks.indexOf(e.googTrackId)&&o.video[r].tracks.push(e.googTrackId),e.framerateMean&&(o.bandwidth.framerateMean=e.framerateMean,n=0,o.internal.video[r].prevFramerateMean||(o.internal.video[r].prevFramerateMean=e.bitrateMean),i=e.bytesSent-o.internal.video[r].prevFramerateMean,o.internal.video[r].prevFramerateMean=e.framerateMean,n=i/1024,o.video[r].framerateMean=i.toFixed(1)),e.bitrateMean&&(o.bandwidth.bitrateMean=e.bitrateMean,n=0,o.internal.video[r].prevBitrateMean||(o.internal.video[r].prevBitrateMean=e.bitrateMean),i=e.bytesSent-o.internal.video[r].prevBitrateMean,o.internal.video[r].prevBitrateMean=e.bitrateMean,n=i/1024,o.video[r].bitrateMean=i.toFixed(1)),e.googCurrentDelayMs&&(n=0,o.internal.video.prevGoogCurrentDelayMs||(o.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs),i=e.googCurrentDelayMs-o.internal.video.prevGoogCurrentDelayMs,o.internal.video.prevGoogCurrentDelayMs=e.googCurrentDelayMs,o.video.latency=i.toFixed(1),o.video.latency<0&&(o.video.latency=0)),e.packetsLost&&(n=0,o.internal.video.prevPacketsLost||(o.internal.video.prevPacketsLost=e.packetsLost),i=e.packetsLost-o.internal.video.prevPacketsLost,o.internal.video.prevPacketsLost=e.packetsLost,o.video.packetsLost=i.toFixed(1),o.video.packetsLost<0&&(o.video.packetsLost=0))}}},c.bweforvideo=function(e){"VideoBwe"===e.type&&(o.bandwidth.availableSendBandwidth=e.googAvailableSendBandwidth,o.bandwidth.googActualEncBitrate=e.googActualEncBitrate,o.bandwidth.googAvailableSendBandwidth=e.googAvailableSendBandwidth,o.bandwidth.googAvailableReceiveBandwidth=e.googAvailableReceiveBandwidth,o.bandwidth.googRetransmitBitrate=e.googRetransmitBitrate,o.bandwidth.googTargetEncBitrate=e.googTargetEncBitrate,o.bandwidth.googBucketDelay=e.googBucketDelay,o.bandwidth.googTransmitBitrate=e.googTransmitBitrate)},c.candidatePair=function(e){if("googCandidatePair"===e.type||"candidate-pair"===e.type||"local-candidate"===e.type||"remote-candidate"===e.type){if("true"==e.googActiveConnection&&(Object.keys(o.internal.candidates).forEach((function(t){var r=o.internal.candidates[t];-1!==r.ipAddress.indexOf(e.googLocalAddress)&&(o.connectionType.local.candidateType=r.candidateType,o.connectionType.local.ipAddress=r.ipAddress,o.connectionType.local.networkType=r.networkType,o.connectionType.local.transport=r.transport),-1!==r.ipAddress.indexOf(e.googRemoteAddress)&&(o.connectionType.remote.candidateType=r.candidateType,o.connectionType.remote.ipAddress=r.ipAddress,o.connectionType.remote.networkType=r.networkType,o.connectionType.remote.transport=r.transport)})),o.connectionType.transport=e.googTransportType,(t=o.internal.candidates[e.localCandidateId])&&t.ipAddress&&(o.connectionType.systemIpAddress=t.ipAddress),(r=o.internal.candidates[e.remoteCandidateId])&&r.ipAddress&&(o.connectionType.systemIpAddress=r.ipAddress)),"candidate-pair"===e.type&&!0===e.selected&&!0===e.nominated&&"succeeded"===e.state)var t=o.internal.candidates[e.remoteCandidateId],r=o.internal.candidates[e.remoteCandidateId];if("local-candidate"===e.type&&(o.connectionType.local.candidateType=e.candidateType,o.connectionType.local.ipAddress=e.ipAddress,o.connectionType.local.networkType=e.networkType,o.connectionType.local.transport=e.mozLocalTransport||e.transport),"remote-candidate"===e.type&&(o.connectionType.remote.candidateType=e.candidateType,o.connectionType.remote.ipAddress=e.ipAddress,o.connectionType.remote.networkType=e.networkType,o.connectionType.remote.transport=e.mozRemoteTransport||e.transport),d){var n=e.localCandidateId?"send":"recv";if(!n)return;if(e.bytesSent){var i=0;o.internal.video[n].prevBytesSent||(o.internal.video[n].prevBytesSent=e.bytesSent);var a=e.bytesSent-o.internal.video[n].prevBytesSent;o.internal.video[n].prevBytesSent=e.bytesSent,i=a/1024,o.video[n].availableBandwidth=i.toFixed(1),o.video.bytesSent=i.toFixed(1)}e.bytesReceived&&(i=0,o.internal.video[n].prevBytesReceived||(o.internal.video[n].prevBytesReceived=e.bytesReceived),a=e.bytesReceived-o.internal.video[n].prevBytesReceived,o.internal.video[n].prevBytesReceived=e.bytesReceived,i=a/1024,o.video.bytesReceived=i.toFixed(1)),e.availableOutgoingBitrate&&(i=0,o.internal.video[n].prevAvailableOutgoingBitrate||(o.internal.video[n].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate),a=e.availableOutgoingBitrate-o.internal.video[n].prevAvailableOutgoingBitrate,o.internal.video[n].prevAvailableOutgoingBitrate=e.availableOutgoingBitrate,i=a/1024,o.video.availableOutgoingBitrate=i.toFixed(1)),e.availableIncomingBitrate&&(i=0,o.internal.video[n].prevAvailableIncomingBitrate||(o.internal.video[n].prevAvailableIncomingBitrate=e.availableIncomingBitrate),a=e.availableIncomingBitrate-o.internal.video[n].prevAvailableIncomingBitrate,o.internal.video[n].prevAvailableIncomingBitrate=e.availableIncomingBitrate,i=a/1024,o.video.availableIncomingBitrate=i.toFixed(1))}}};var m={},v={},g={},y={};c.localcandidate=function(e){"localcandidate"!==e.type&&"local-candidate"!==e.type||e.id&&(m[e.id]||(m[e.id]=[]),v[e.id]||(v[e.id]=[]),g[e.id]||(g[e.id]=[]),y[e.id]||(y[e.id]=[]),e.candidateType&&-1===m[e.id].indexOf(e.candidateType)&&m[e.id].push(e.candidateType),e.transport&&-1===v[e.id].indexOf(e.transport)&&v[e.id].push(e.transport),e.ipAddress&&-1===g[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&g[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===y[e.id].indexOf(e.networkType)&&y[e.id].push(e.networkType),o.internal.candidates[e.id]={candidateType:m[e.id],ipAddress:g[e.id],portNumber:e.portNumber,networkType:y[e.id],priority:e.priority,transport:v[e.id],timestamp:e.timestamp,id:e.id,type:e.type},o.connectionType.local.candidateType=m[e.id],o.connectionType.local.ipAddress=g[e.id],o.connectionType.local.networkType=y[e.id],o.connectionType.local.transport=v[e.id])};var b={},_={},S={},k={};c.remotecandidate=function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||e.id&&(b[e.id]||(b[e.id]=[]),_[e.id]||(_[e.id]=[]),S[e.id]||(S[e.id]=[]),k[e.id]||(k[e.id]=[]),e.candidateType&&-1===b[e.id].indexOf(e.candidateType)&&b[e.id].push(e.candidateType),e.transport&&-1===_[e.id].indexOf(e.transport)&&_[e.id].push(e.transport),e.ipAddress&&-1===S[e.id].indexOf(e.ipAddress+":"+e.portNumber)&&S[e.id].push(e.ipAddress+":"+e.portNumber),e.networkType&&-1===k[e.id].indexOf(e.networkType)&&k[e.id].push(e.networkType),o.internal.candidates[e.id]={candidateType:b[e.id],ipAddress:S[e.id],portNumber:e.portNumber,networkType:k[e.id],priority:e.priority,transport:_[e.id],timestamp:e.timestamp,id:e.id,type:e.type},o.connectionType.remote.candidateType=b[e.id],o.connectionType.remote.ipAddress=S[e.id],o.connectionType.remote.networkType=k[e.id],o.connectionType.remote.transport=_[e.id])},c.dataSentReceived=function(e){!e.googCodecName||"video"!==e.mediaType&&"audio"!==e.mediaType||(e.bytesSent&&(o[e.mediaType].bytesSent=parseInt(e.bytesSent)),e.bytesReceived&&(o[e.mediaType].bytesReceived=parseInt(e.bytesReceived)))},c.inboundrtp=function(e){if(d&&"inbound-rtp"===e.type){var t=e.mediaType||"audio",r=e.isRemote?"recv":"send";if(r){if(e.bytesSent){var n=0;o.internal[t][r].prevBytesSent||(o.internal[t][r].prevBytesSent=e.bytesSent);var i=e.bytesSent-o.internal[t][r].prevBytesSent;o.internal[t][r].prevBytesSent=e.bytesSent,n=i/1024,o[t][r].availableBandwidth=n.toFixed(1),o[t].bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,o.internal[t][r].prevBytesReceived||(o.internal[t][r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-o.internal[t][r].prevBytesReceived,o.internal[t][r].prevBytesReceived=e.bytesReceived,n=i/1024,o[t].bytesReceived=n.toFixed(1))}}},c.outboundrtp=function(e){if(d&&"outbound-rtp"===e.type){var t=e.mediaType||"audio",r=e.isRemote?"recv":"send";if(r){if(e.bytesSent){var n=0;o.internal[t][r].prevBytesSent||(o.internal[t][r].prevBytesSent=e.bytesSent);var i=e.bytesSent-o.internal[t][r].prevBytesSent;o.internal[t][r].prevBytesSent=e.bytesSent,n=i/1024,o[t][r].availableBandwidth=n.toFixed(1),o[t].bytesSent=n.toFixed(1)}e.bytesReceived&&(n=0,o.internal[t][r].prevBytesReceived||(o.internal[t][r].prevBytesReceived=e.bytesReceived),i=e.bytesReceived-o.internal[t][r].prevBytesReceived,o.internal[t][r].prevBytesReceived=e.bytesReceived,n=i/1024,o[t].bytesReceived=n.toFixed(1))}}},c.track=function(e){if(d&&"track"===e.type){var t=!0===e.remoteSource?"send":"recv";e.frameWidth&&e.frameHeight&&(o.resolutions[t].width=e.frameWidth,o.resolutions[t].height=e.frameHeight)}};var w={audio:{send:[],recv:[]},video:{send:[],recv:[]}};c.ssrc=function(e){if(e.googCodecName&&("video"===e.mediaType||"audio"===e.mediaType)&&"ssrc"===e.type){var t=e.id.split("_").pop();-1===w[e.mediaType][t].indexOf(e.ssrc)&&w[e.mediaType][t].push(e.ssrc),o[e.mediaType][t].streams=w[e.mediaType][t].length}},p()}(t._pc,(function(e){t.pcStats=e}),1e3)}))),this._init()}var i,a,o,d,u,l,p;return Ee(e,[{key:"_init",value:function(){this._pc=new RTCPeerConnection({iceServers:[],bundlePolicy:"max-bundle",sdpSemantics:"unified-plan"}),this._pcHandler(),this.refCount=0,this.pc_session_id=Yt(),this.pcStats=null,this._emitter=Ri(),this._dataChannel=null,this._transceivers4stream={},this._mid_msid={},this.iceOptions={offer:{},answer:{}}}},{key:"createDataChannel",value:function(e){return this._dataChannel=this._pc.createDataChannel(e,{negotiated:!1}),this._dataChannel}},{key:"getDefaultSDP",value:(p=t(c.mark((function e(){var t,r,n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("cache_sdp"))||"string"!=typeof t){e.next=3;break}return e.abrupt("return",{type:"offer",sdp:t});case 3:return(r=new RTCPeerConnection).createDataChannel("default"),r.addTransceiver("audio",{direction:"sendrecv"}),r.addTransceiver("video",{direction:"sendrecv"}),e.next=9,r.createOffer();case 9:return n=e.sent,r.close(),localStorage.setItem("cache_sdp",n.sdp),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"safeClose",value:function(){try{this._dataChannel&&"open"===this._dataChannel.readyState&&this._dataChannel.close(),this._pc&&this._pc.close()}catch(e){}}},{key:"stopTransceiver",value:(l=t(c.mark((function e(r,n){var i=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=t(c.mark((function e(t,a){var o,s,d,u,l,p,f,h,m;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i._transceivers4stream[r]){e.next=2;break}return e.abrupt("return",t());case 2:o=i._transceivers4stream[r],s=o.audio,d=o.video,u={},!n&&s&&s.mid&&(u[s.mid]=s.mid),d&&d.mid&&(u[d.mid]=d.mid),l=Be.parse(i._pc.localDescription.sdp),p=Be.parse(i._pc.remoteDescription.sdp),f="",l.media.forEach((function(e,t){u[e.mid]?(i._closeMline(e),i._closeMline(p.media[t])):"inactive"!==e.direction&&(f+=" ".concat(e.mid))})),f=f.trim();try{l.groups[0].mids=f,p.groups[0].mids=f}catch(e){}return h=new RTCSessionDescription({type:"offer",sdp:Be.write(l)}),m=new RTCSessionDescription({type:"answer",sdp:Be.write(p)}),e.next=16,i._pc.setLocalDescription(h);case 16:return e.next=18,i._pc.setRemoteDescription(m);case 18:n?i._transceivers4stream[r].video=null:(delete i._transceivers4stream[r],s&&delete i._mid_msid[s.mid]),d&&delete i._mid_msid[d.mid],t();case 21:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return l.apply(this,arguments)})},{key:"getPCStats",value:function(){return this.pcStats}},{key:"createOffer",value:function(e,r,n,i){var a=this;return new Promise(function(){var o=t(c.mark((function t(o,s){var d;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(vi("rtc_begin_create_offer",{direction:e?"down":"up",stream_id:n,pc_session_id:a.pc_session_id}),t.prev=1,e||!r){t.next=7;break}return t.next=5,a._createSendonlyOffer(r,n,i);case 5:t.next=9;break;case 7:return t.next=9,a._createRecvonlyOffer(n);case 9:d=a.unified2planb(a._pc.localDescription),o(d),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),s(t.t0);case 16:case"end":return t.stop()}}),t,null,[[1,13]])})));return function(e,t){return o.apply(this,arguments)}}())}},{key:"_createSendonlyOffer",value:(u=t(c.mark((function e(t,r,n){var i,a,o,s,d,u,l,p=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.getAudioTracks()[0],a=t.getVideoTracks()[0],o=this._pc.addTransceiver(i||"audio",{direction:"sendonly",streams:[t]}),s={direction:"sendonly",streams:[t]},"number"==typeof n.maxVideoBW&&(s.sendEncodings=[{maxBitrate:1e3*n.maxVideoBW}]),d=this._pc.addTransceiver(a||"video",s),e.next=8,this._pc.createOffer();case 8:return u=e.sent,l=Be.parse(u.sdp),Array.isArray(l.media)&&l.media.forEach((function(e){for(var t=0,r=Object.entries(p.iceOptions.offer);t<r.length;t++){var n=Re(r[t],2),i=n[0],a=n[1];e[i]=a}})),u=Be.write(l),vi("rtc_create_offer",{error_code:0,message:u,direction:"up",stream_id:r,pc_session_id:this.pc_session_id}),e.next=15,this._pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:u}));case 15:return this._transceivers4stream[r]={audio:o,video:d},this.emitter.emit({type:"add-senders",streamId:r,senders:{audio:o.sender,video:d.sender}}),e.abrupt("return",{audioTransceiver:o,videoTransceiver:d});case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return u.apply(this,arguments)})},{key:"_createRecvonlyOffer",value:(d=t(c.mark((function e(t){var r,n,i,a,o=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,n=null,this._transceivers4stream[t]&&(r=this._transceivers4stream[t].audio,n=this._transceivers4stream[t].video),r||(r=this._pc.addTransceiver("audio",{direction:"recvonly"})),n||(n=this._pc.addTransceiver("video",{direction:"recvonly"})),e.next=7,this._pc.createOffer();case 7:return i=e.sent,a=Be.parse(i.sdp),Array.isArray(a.media)&&a.media.forEach((function(e){for(var t=0,r=Object.entries(o.iceOptions.offer);t<r.length;t++){var n=Re(r[t],2),i=n[0],a=n[1];e[i]=a}})),i=Be.write(a),vi("rtc_create_offer",{error_code:0,message:i,direction:"down",stream_id:t,pc_session_id:this.pc_session_id}),e.next=14,this._pc.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:i}));case 14:return this._transceivers4stream[t]={audio:r,video:n},this._mid_msid[r.mid]=t,this._mid_msid[n.mid]=t,e.abrupt("return",{audioTransceiver:r,videoTransceiver:n});case 18:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"setRemoteDesc",value:(o=t(c.mark((function e(t){var r;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("have-local-offer"===this._pc.signalingState){e.next=3;break}return e.next=3,this._pc.setLocalDescription();case 3:return vi("rtc_recv_answer",{answer_type:"answer",message:t.sdp}),e.next=6,this.planb2unified(t);case 6:return r=e.sent,e.next=9,this._pc.setRemoteDescription(r);case 9:case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_closeMline",value:function(e){e.direction="inactive",e.port=0,delete e.ext,delete e.ssrcs,delete e.ssrcGroups,delete e.simulcast,delete e.simulcast_03,delete e.rids,delete e.extmapAllowMixed}},{key:"rollback",value:function(){"closed"!==this._pc.signalingState&&"stable"!==this._pc.signalingState&&this._pc.setLocalDescription({type:"rollback"})}},{key:"unified2planb",value:(a=t(c.mark((function e(t){var r,n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=co.toPlanB(t),(n=Be.parse(r.sdp)).msidSemantic.token="",n.media.forEach((function(e){e.direction="sendrecv"}));try{n.groups[0].mids="data audio video"}catch(e){}return e.abrupt("return",new RTCSessionDescription({type:t.type,sdp:Be.write(n)}));case 7:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"planb2unified",value:(i=t(c.mark((function e(t){var r,n,i,a,o,s,d,u,l,p,f,h=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=Be.parse(this._pc.localDescription.sdp),n=Be.parse(t.sdp),i=n.media,a=null,o=null,s=null,d=[],u=so(n),l=u.audioSSRCS,p=u.videoSSRCS,f=u.videoGroups,i.forEach((function(e){for(var t=0,r=Object.entries(h.iceOptions.answer);t<r.length;t++){var n=Re(r[t],2),i=n[0],c=n[1];e[i]=c}"application"===e.type?a=e:"audio"===e.type?delete(o=xe(e)).ssrcs:"video"===e.type&&(delete(s=xe(e)).ssrcs,delete s.ssrcGroups)})),r.media.forEach((function(e){var t=null,r=e.mid;switch(e.type){case"application":a.mid=r,d.push(a);break;case"audio":if((t=xe(o)).mid=r,"sendonly"===e.direction)t.direction="recvonly";else if("inactive"===e.direction)t.direction="inactive",t.port=0;else if("recvonly"===e.direction&&(t.direction="sendonly",h._mid_msid[r])){var n=h._mid_msid[r];l[n]&&(t.ssrcs=l[n],delete l[n])}d.push(t);break;case"video":if((t=xe(s)).mid=r,"sendonly"===e.direction)t.direction="recvonly";else if("inactive"===e.direction)t.direction="inactive",t.port=0;else if("recvonly"===e.direction&&(t.direction="sendonly",h._mid_msid[r])){var i=h._mid_msid[r];if(p[i]&&p[i].length){t.ssrcs=p[i];for(var c=p[i][0].id,u=0,m=Object.keys(f);u<m.length;u++){var v=m[u];-1!==v.indexOf(c)&&function(){t.ssrcGroups=[f[v]],delete f[v];var e=t.ssrcs;t.ssrcs=[],v.split(" ").forEach((function(r){e.forEach((function(e){"".concat(e.id)===r&&t.ssrcs.push(e)}))}))}()}delete p[i]}}d.push(t)}})),n.media=d;try{n.groups=[{type:"BUNDLE",mids:r.groups[0].mids}]}catch(e){}return e.abrupt("return",new RTCSessionDescription({type:"answer",sdp:Be.write(n)}));case 17:e.prev=17,e.t0=e.catch(0),console.error("plan2unified error",e.t0);case 20:case"end":return e.stop()}}),e,this,[[0,17]])}))),function(e){return i.apply(this,arguments)})},{key:"_pcHandler",value:function(){var e=this;this._pc.onconnectionstatechange=function(){var t=e._pc.connectionState;"failed"===t&&e.emitter.emit(Ii({type:"ice-state-change",state:t}))},this._pc.oniceconnectionstatechange=function(){var t=e._pc.iceConnectionState;switch(t){case"completed":case"connected":e.beginGetStats()}e.oniceconnectionstatechange&&e.oniceconnectionstatechange(t),e.emitter.emit(Ii({type:"ice-state-change",state:t})),vi("rtc_ice_state",{pc_session_id:e.pc_session_id,ice_state:t&&t.toUpperCase()})},this._pc.ontrack=function(t){if(Array.isArray(t.streams)&&t.streams.length){var r=t.streams[0];e.emitter.emit(Ii({type:"add-stream",stream:r}))}}}},{key:"updateLocalStreamId",value:function(e,t){this._transceivers4stream[e]&&(this._transceivers4stream[t]=this._transceivers4stream[e],delete this._transceivers4stream[e])}},{key:"hasSubscribedStreamId",value:function(e){return!!this._transceivers4stream[e]}},{key:"peerConnection",get:function(){return this._pc}},{key:"emitter",get:function(){return this._emitter}},{key:"connected",get:function(){return this._pc&&"closed"!==this._pc.signalingState}}]),e}(),lo=1,po=function(){function e(t){r(this,e),n(this,"lockingPromise",Promise.resolve()),n(this,"locks",0),n(this,"name",""),n(this,"lockId",void 0),this.lockId=lo++,t&&(this.name=t),console.log("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}return Ee(e,[{key:"lock",value:function(){var e,t=this;this.locks+=1,console.log("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,"."));var r=new Promise((function(r){e=function(){t.locks-=1,console.log("[lock-".concat(t.name,"-").concat(t.lockId,"] is not locked, current queue ").concat(t.locks,".")),r()}})),n=this.lockingPromise.then((function(){return e}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),n}},{key:"isLocked",get:function(){return this.locks>0}}]),e}();function fo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ho(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fo(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var mo=null,vo=null,go=null,yo=null,bo=null,_o=null,So=null,ko=!1,wo={Room:function(){function e(t){var i=this,a=t.monitor,o=t.client;r(this,e),n(this,"enableAudioVolumeIndicator",(function(){i.volumeIndicatorInterval||(i.volumeIndicatorInterval=setInterval((function(){var e=[];i.remoteStreams.forEach((function(t){t.getState()===Bi.SUCCESS&&e.push({uid:t.uid,streamId:t.getId(),level:t.getAudioLevel()})}));i.dispatchEvent(Ei({type:"volume-indicator",volumes:e}))}),2e3))})),Ri(this),this.monitor=a,this.client=o,this.localStreams=new to,this.remoteStreams=new to,this.remoteUsers=new to,this.handler=null,this.state=ji.DISCONNECTED,this.dataChannel=null,this.dataChannelSignaling=null,this._iceState=null,this._pcReconnectedCount=0,this._messageId=0,this.volumeIndicatorInterval=null,this.pLock=new po("Room"),window.__room=this}var i,a,o,s,d,u,l,p,f,h,m,v,g,y,b;return Ee(e,[{key:"join",value:(b=t(c.mark((function e(t){var r=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return go=t,e.abrupt("return",new Promise((function(e,t){mo=e,vo=t,r._join("joinRoom",e,t)})));case 2:case"end":return e.stop()}}),e)}))),function(e){return b.apply(this,arguments)})},{key:"renewToken",value:(y=t(c.mark((function e(t){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.join(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"_join",value:(g=t(c.mark((function e(r){var n,i,a,o,s,d=this,u=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:function(){},i=u.length>2&&void 0!==u[2]?u[2]:function(){},this._setRoomState(ji.CONNECTING),a=go,this.handler&&(this.handler.emitter.removeAllEventListeners(),this.handler.safeClose()),this.handler=new uo,this._handleHandler(),this.dataChannel=this.handler.createDataChannel("signaling"),o=null,bo&&_o)try{o=[{feedbackIP:_o.publicIPs[0].ip,feedbackReason:{type:"NODE_CHANGED",reason:bo}}]}catch(e){}(s=new wa(this.handler.peerConnection,ho(ho({},a.params),{},{role:a.role,expectedAddr:a._mediaServerAddr}),this.monitor,yo,o)).connect().then((function(){d.handler.iceOptions=s.offerAndAnswerICEOptions,_o=s.iceConfig,yo=null,bo=null})).catch(i),this._handleDataChannel().then(t(c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.handler.getDefaultSDP();case 2:a.sdpInfo=e.sent,a.options?a.options.enableUnBundleMode=!0:a.options={enableUnBundleMode:!0},d._sendSignaling(r,a).then((function(e){if(200!==e.code)return i(e);n(e),d._handleJoinSucc(e)})).catch(i);case 5:case"end":return e.stop()}}),e)}))));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"leaveRoom",value:(v=t(c.mark((function e(t){var r=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._sendSignaling("leaveRoom",t).then((function(e){200===e.code&&(r._setRoomState(ji.DISCONNECTED),clearInterval(r.volumeIndicatorInterval),r.remoteStreams.values().forEach((function(e){var t=xi({type:"stream-removed",stream:e});clearTimeout(e.rttTimer),r.dispatchEvent(t)})),r.handler&&r.handler.safeClose())})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"publish",value:(m=t(c.mark((function e(t){var r,n,i,a,o,s,d=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>1&&void 0!==d[1]?d[1]:{},this._assertHandlerNotAlive(),e.next=4,this.pLock.lock();case 4:return n=e.sent,e.prev=5,t.setState(Bi.CONNECTING),t.uid=this.client.id,t.room=this,t.addPC(this.handler),i=t.stream,a={audio:!0,video:!0,screen:t.hasScreen(),attributes:t.getAttributes()},e.next=14,this.handler.createOffer(!1,i,t.getServerId(),r);case 14:return o=e.sent,a.sdpInfo=o,e.next=18,this._sendSignaling("publish",a);case 18:if(200!==(s=e.sent).code){e.next=26;break}return t.setId(s.streamId),t.setState(Bi.SUCCESS),this.localStreams.add(t.getId(),t),t.sequenceId=s.relayMessage.sequenceId,e.next=26,this.handler.setRemoteDesc({sdp:s.relayMessage.sdp});case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(5),this.handler.rollback();case 31:return e.prev=31,n(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[5,28,31,34]])}))),function(e){return m.apply(this,arguments)})},{key:"unpublish",value:(h=t(c.mark((function e(t){var r,n,i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertHandlerNotAlive(),e.next=3,this.pLock.lock();case 3:if(r=e.sent,t){e.next=6;break}return e.abrupt("return");case 6:if(e.prev=6,n=t.getServerId(),!this.localStreams.has(t.getId())){e.next=21;break}return e.next=11,this._sendSignaling("unpublish",{streamId:n});case 11:if(200!==e.sent.code){e.next=21;break}return t.removeLivingStream(),t.removePC(),this.localStreams.remove(t.getId()),e.next=18,this.handler.stopTransceiver(t.getServerId());case 18:i=xi({type:"stream-removed",stream:t}),clearTimeout(t.rttTimer),this.dispatchEvent(i);case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(6),this.handler.rollback();case 26:return e.prev=26,r(),e.finish(26);case 29:case"end":return e.stop()}}),e,this,[[6,23,26,29]])}))),function(e){return h.apply(this,arguments)})},{key:"subscribe",value:(f=t(c.mark((function e(t){var r,n,i,a,o,s,d,u,l=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:{},this._assertHandlerNotAlive(),e.next=4,this.pLock.lock();case 4:return n=e.sent,e.prev=5,i="boolean"==typeof r.audio?r.audio:t.hasAudio(),a="boolean"==typeof r.video?r.video:t.hasVideo(),ko&&(i=!0),t.subState={audio:i,video:a},o={audio:!0,video:!0,data:!0,streamId:t.getServerId(),config:{enableMediaType:{audio:i,video:a},qualityLayer:{spatialLayer:0}},streamUserId:t.uid},e.next=13,this.handler.createOffer(!0,t.stream,t.getServerId(),r);case 13:return s=e.sent,o.sdpInfo=s,e.next=17,this._sendSignaling("subscribe",o);case 17:if(200!==(d=e.sent).code){e.next=26;break}if(this.remoteStreams.add(t.getServerId(),t),u=d.relayMessage.sequenceId,!(t.sequenceId>u)){e.next=23;break}return e.abrupt("return");case 23:return t.sequenceId=u,e.next=26,this.handler.setRemoteDesc({sdp:d.relayMessage.sdp});case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(5),this.handler.rollback();case 31:return e.prev=31,n(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[5,28,31,34]])}))),function(e){return f.apply(this,arguments)})},{key:"updateSubscribe",value:(p=t(c.mark((function e(t,r){var n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject());case 2:return n=t.getServerId(),e.abrupt("return",this._sendSignaling("updateSubscribe",{roomId:this.monitor.getRoomId(),streamList:[n],config:{enableMediaType:{audio:r.audio,video:r.video}}}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"updateSpec",value:(l=t(c.mark((function e(t,r,n){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:this._sendSignaling("updateSubscribe",{roomId:this.monitor.getRoomId(),streamList:[t],config:r.config});case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"unsubscribe",value:(u=t(c.mark((function e(t){var r,n,i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._assertHandlerNotAlive(),e.next=3,this.pLock.lock();case 3:if(r=e.sent,e.prev=4,t){e.next=7;break}return e.abrupt("return");case 7:if(n=t.getServerId(),t.subState.video=!1,ko||(t.subState.audio=!1),i=!t.subState.audio&&!t.subState.video,!this.remoteStreams.has(n)){e.next=26;break}return e.next=14,this._sendSignaling("unsubscribe",{streamId:n,audio:!0,video:!0});case 14:if(200!==e.sent.code){e.next=26;break}if(!i){e.next=24;break}return t.removeLivingStream(),t.removePC(),this.remoteStreams.remove(n),e.next=22,this.handler.stopTransceiver(n);case 22:e.next=26;break;case 24:return e.next=26,this.handler.stopTransceiver(n,!0);case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(4),this.handler.rollback();case 31:return e.prev=31,r(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[4,28,31,34]])}))),function(e){return u.apply(this,arguments)})},{key:"sendP2PMessage",value:(d=t(c.mark((function e(t,r){var n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("open"===this.dataChannel.readyState){e.next=2;break}return e.abrupt("return",Promise.reject(new qt("",qt.GET_ROOM_INVALID_RESPONSE)));case 2:return"string"!=typeof r&&(r=JSON.stringify(r)),n={ver:1,id:this._messageId++,time:Date.now(),dir:Ca.MESSAGE_DIRECTION_SEND,type:Aa,err:Ra,app:this.monitor.getAppId(),room:this.monitor.getRoomId(),from:this.monitor.getUserId(),to:t,msg:r},e.abrupt("return",this.dataChannelSignaling.sendP2PMessage(n));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"getLocalAudioStats",value:function(){var e={};return this.localStreams.forEach((function(t){t.getState()===Bi.SUCCESS&&(e[t.uid]=t.getAudioStats())})),e}},{key:"getLocalVideoStats",value:function(){var e={};return this.localStreams.forEach((function(t){t.getState()===Bi.SUCCESS&&(e[t.uid]=t.getVideoStats())})),e}},{key:"getRemoteAudioStats",value:function(){var e={};return this.remoteStreams.forEach((function(t){t.getState()===Bi.SUCCESS&&(e[t.uid]=t.getAudioStats())})),e}},{key:"getRemoteVideoStats",value:function(){var e={};return this.remoteStreams.forEach((function(t){t.getState()===Bi.SUCCESS&&(e[t.uid]=t.getVideoStats())})),e}},{key:"_sendSignaling",value:(s=t(c.mark((function e(t,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dataChannelSignaling){e.next=2;break}return e.abrupt("return",Promise.reject());case 2:return e.abrupt("return",this.dataChannelSignaling.sendSignaling(t,r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"_handleJoinSucc",value:function(e,t){this._setRoomState(ji.CONNECTED),clearInterval(So),ko=e.roomAttributes.multiChatMode;var r=e.clientsDetail,n=e.streams;this._handleRemoteStreams(n),this._handleRemoteUsers(r),this._handleStreamConnected()}},{key:"_handleStreamConnected",value:function(){var e=this;this.localStreams.values().forEach((function(t){t.addPC(e.handler),e.publish(t)})),this.remoteStreams.values().forEach((function(t){t.addPC(e.handler),t.getState()===Bi.FAILED&&e.subscribe(t)}))}},{key:"_handleRemoteUsers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r={};this.remoteUsers.keys().forEach((function(e){return r[e]=!0})),t.forEach((function(t){var n=t.clientId;n!==e.client.id&&(r[n]||(e._handleUserConnection(t),r[n]=!1))})),Object.entries(r).forEach((function(t){var r=Re(t,2),n=r[0];r[1]&&e._handleUserDisconnection(e.remoteUsers.get(n))}))}},{key:"_handleUserConnection",value:function(e){if(e.clientId!==this.client.id&&!this.remoteUsers.get(e.clientId)){this.remoteUsers.add(e.clientId,e);var t=Ei({type:"userConnection",message:e});this.emit(t)}}},{key:"_handleUserDisconnection",value:function(e){var t=this;this.remoteUsers.get(e.id)&&this.remoteUsers.remove(e.id);var r=Ei({type:"userDisconnection",message:e});setTimeout((function(){return t.emit(r)}),0)}},{key:"_handleRemoteStreams",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r={};this.remoteStreams.keys().forEach((function(e){return r[e]=!0})),t.forEach((function(t){if(t.clientId!==e.client.id){var n=t.streamId;r[n]||e._handleAddStream(t),r[n]=!1}})),Object.entries(r).forEach((function(t){var r=Re(t,2),n=r[0];if(r[1]){var i=e.remoteStreams.get(n);if(i){e.remoteStreams.remove(n);var a=xi({type:"stream-removed",stream:i});e.dispatchEvent(a)}}}))}},{key:"_handleAddStream",value:function(e){if(e.isReady){var t=null;if(e.clientId!==this.client.id){if(t=this.remoteStreams.get(e.streamId))ko&&(t.subState.video=!0);else{(t=eo({streamId:e.streamId,initStreamId:e.initStreamId,uid:e.clientId,local:!1,audio:!!ko||e.audio,video:e.video,data:e.data,screen:e.screen,attributes:e.attributes,customData:e.customData})).on("added",this._handleStreamSubscribed.bind(this,t)),this.remoteStreams.add(t.getId(),t),t.room=this,t.addPC(this.handler);var r=xi({type:"stream-added",stream:t});this.dispatchEvent(r)}this._emitAudioEnable(!t.hasDisableAudio(),t),this._emitVideoEnable(!t.hasDisableVideo(),t)}else{if(!(t=this.localStreams.values().find((function(t){return e.streamId===t.getServerId()}))))return;var n=xi({type:"stream-added",stream:t});this.dispatchEvent(n)}}}},{key:"_handleOnPushTrack",value:(o=t(c.mark((function e(t){var r,n,i,a,o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pLock.lock();case 2:if(r=e.sent,e.prev=3,n=t.streamId,i=t.message,this._handleAddStream(t),(a=this.remoteStreams.get(n)).subState.audio=!0,this.handler.hasSubscribedStreamId(n)){e.next=12;break}return e.next=12,this.handler.createOffer(!0,null,n,{});case 12:if(o=t.message.sequenceId,!(a.sequenceId>o)){e.next=15;break}return e.abrupt("return");case 15:return a.sequenceId=o,e.next=18,this.handler.setRemoteDesc(i);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),this.handler.rollback();case 23:return e.prev=23,r(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e){return o.apply(this,arguments)})},{key:"_handleOnRemoveTrack",value:(a=t(c.mark((function e(t){var r,n,i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pLock.lock();case 2:if(r=e.sent,e.prev=3,n=t.streamId,(i=this.remoteStreams.get(n))&&(i.subState.audio=!1),i.subState.audio||i.subState.video){e.next=10;break}return e.next=10,this.handler.stopTransceiver(n);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),this.handler.rollback();case 15:return e.prev=15,r(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return a.apply(this,arguments)})},{key:"_emitAudioEnable",value:function(e,t){this.dispatchEvent(Ei({type:"audio-enable",enable:e,stream:t}))}},{key:"_emitVideoEnable",value:function(e,t){t&&t.player&&t.player.video&&(rt.debug("emitVideoEnable updateSrcObject"),t.player.updateSrcObject()),this.dispatchEvent(Ei({type:"video-enable",enable:e,stream:t}))}},{key:"_handleStreamSubscribed",value:function(e,t){if(e.setState(Bi.SUCCESS),e.player)e.player.updateSrcObject();else{var r=xi({type:"stream-subscribed",stream:e});this.dispatchEvent(r)}e&&t.stream&&(e.audioMuted?e.disableAudio():e.enableAudio(),e.videoMuted?e.disableVideo():e.enableVideo())}},{key:"_handleRemoveStream",value:(i=t(c.mark((function e(t){var r,n,i,a;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.pLock.lock();case 2:if(r=e.sent,e.prev=3,n=t.streamId,i=null,t.clientId!==this.client.id){e.next=13;break}if(!ko||t.message){e.next=9;break}return e.abrupt("return");case 9:i=this.localStreams.get(n),this.publish(i),e.next=23;break;case 13:if(!(i=this.remoteStreams.get(n))){e.next=23;break}if(ko&&!t.message||(i.subState.audio=!1),i.subState.video=!1,i.subState.audio||i.subState.video){e.next=23;break}return e.next=19,this.handler.stopTransceiver(n);case 19:this.remoteStreams.remove(n),i.removeLivingStream(),a=xi({type:"stream-removed",stream:i}),this.dispatchEvent(a);case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(3),this.handler.rollback();case 28:return e.prev=28,r(),e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[3,25,28,31]])}))),function(e){return i.apply(this,arguments)})},{key:"_setRoomState",value:function(e){e!==this.state&&(this.state=e,this.dispatchEvent(Ei({type:"connection-state-change",prevState:this.state,curState:e})))}},{key:"_handleDataChannel",value:function(){var e=this;return new Promise((function(t,r){e.dataChannel.onopen=function(){e.dataChannelSignaling=new Da(e.dataChannel,e.monitor),e._handleSignaling(),t()};var n=function(){"connected"!==e._iceState&&"completed"!==e._iceState||e.handler.emitter.emit({type:"ice-state-change",state:"failed"})};e.dataChannel.onerror=n,e.dataChannel.onclose=n}))}},{key:"_handleUpdateStreamAttributes",value:function(e){var t=this.remoteStreams.get(e.streamId);t&&(t.updateAttributesByServerEnd(e.attributes),e.attributes&&(!1===e.attributes.audiostream||!1===e.attributes.localaudio?this._emitAudioEnable(!1,t):!0!==e.attributes.audiostream&&!0!==e.attributes.localaudio||this._emitAudioEnable(!0,t),!1===e.attributes.videostream||!1===e.attributes.localvideo?this._emitVideoEnable(!1,t):!0!==e.attributes.videostream&&!0!==e.attributes.localvideo||this._emitVideoEnable(!0,t)))}},{key:"_handleUpdateUserAttributes",value:function(e){var t=this.remoteStreams.get(e.clientId);t?Object.assign(t.attributes,e.attributes):this._handleUserConnection(e)}},{key:"_handleSignaling",value:function(){var e=this;this.dataChannelSignaling&&(this.dataChannelSignaling.on("onUpdateRoomAttributes",(function(e){var t;null!=e&&null!==(t=e.roomAttributes)&&void 0!==t&&t.multiChatMode&&(ko=!0,rt.debug("multiChatMode from updateRoomAttributes"))})),this.dataChannelSignaling.on("onPushTrack",this._handleOnPushTrack.bind(this)),this.dataChannelSignaling.on("onRemoveTrack",this._handleOnRemoveTrack.bind(this)),this.dataChannelSignaling.on("userConnection",this._handleUserConnection.bind(this)),this.dataChannelSignaling.on("userDisconnection",this._handleUserDisconnection.bind(this)),this.dataChannelSignaling.on("onAddStream",this._handleAddStream.bind(this)),this.dataChannelSignaling.on("postProcessingMessage",(function(t){var r,n=(null==t||null===(r=t.body)||void 0===r?void 0:r.error)||0,i=Ei({type:"live-transcoding-result",code:n,message:["success","parameter error","subscription timeout","ffmpeg error","cdn error"][n]});e.dispatchEvent(i)})),this.dataChannelSignaling.on("onRemoveStream",this._handleRemoveStream.bind(this)),this.dataChannelSignaling.on("streamFailed",(function(t){var r=t.streamId,n=e.localStreams.get(r);n?e.publish(n):(n=e.remoteStreams.get(r))&&e.subscribe(n)})),this.dataChannelSignaling.on("onUpdateStreamAttributes",this._handleUpdateStreamAttributes.bind(this)),this.dataChannelSignaling.on("onUpdateUserAttributes",this._handleUpdateUserAttributes.bind(this)),this.dataChannelSignaling.on("onCustomMessage",(function(t){var r=Ei({type:"custom-message",message:t});e.dispatchEvent(r)})),["user-message-received","p2p-message-send-success","p2p-message-send-failed"].forEach((function(t){e.dataChannelSignaling.on(t,(function(r){var n=Ei({type:t,message:r});e.dispatchEvent(n)}))})),this.dataChannelSignaling.on("nodeChange",(function(t){var r=t.nodes,n=t.reason;e.monitor.eventLog("rtc_node_change",{error_code:0,reason:JSON.stringify(n),message:JSON.stringify(r)}),Array.isArray(r)&&r.length?yo=r[0]:bo=n,e.state!==ji.CONNECTED?e._join("reconnected",mo,vo):e._join("reconnected")})))}},{key:"_handleHandler",value:function(){var e=this;this.handler.emitter.on("ice-state-change",(function(t){var r=t.state;switch(r){case"failed":case"closed":e.state===ji.CONNECTED&&(So=setInterval((function(){e._join("reconnected")}),3e3))}e._iceState=r,e.emit(Ei({type:"ice-state-change",state:r}))}))}},{key:"_assertHandlerNotAlive",value:function(){if(!this.handler||!this.handler.connected)throw new qt("pc not connected",qt.NOT_IN_ROOM)}},{key:"sendSignaling",get:function(){return this._sendSignaling.bind(this)}}]),e}(),LicodeEvent:Ti,RoomEvent:Ei,StreamEvent:xi,Stream:eo,Logger:rt,Player:Ba,Events:Oi,constants:Fi},Co=function(){for(var e,t,r=-1,n=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i=[],a=0;a<n.length;a+=1)i[n[a]]=a;var o=function(r){e=r,t=0},s=function(){if(!e)return r;if(t>=e.length)return r;var n=255&e.charCodeAt(t);return t+=1,n},c=function(){if(!e)return r;for(;;){if(t>=e.length)return r;var n=e.charAt(t);if(t+=1,i[n])return i[n];if("A"===n)return 0}},d=function(e){var t=e.toString(16);return 1===t.length&&(t="0".concat(t)),t="%".concat(t),unescape(t)};return{encodeBase64:function(e){var t,i,a;o(e),t="";var c=new Array(3);for(i=0,a=!1;!a&&(c[0]=s())!==r;)c[1]=s(),c[2]=s(),t+=n[c[0]>>2],c[1]!==r?(t+=n[c[0]<<4&48|c[1]>>4],c[2]!==r?(t+=n[c[1]<<2&60|c[2]>>6],t+=n[63&c[2]]):(t+=n[c[1]<<2&60],t="".concat(t,"="),a=!0)):(t+=n[c[0]<<4&48],t="".concat(t,"="),t="".concat(t,"="),a=!0),(i+=4)>=76&&(t="".concat(t,"\n"),i=0);return t},decodeBase64:function(e){var t,n;o(e),t="";var i=new Array(4);for(n=!1;!n&&(i[0]=c())!==r&&(i[1]=c())!==r;)i[2]=c(),i[3]=c(),t+=d(i[0]<<2&255|i[1]>>4),i[2]!==r?(t+=d(i[1]<<4&255|i[2]>>2),i[3]!==r?t+=d(i[2]<<6&255|i[3]):n=!0):n=!0;return t}}}();function Ao(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ro(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ao(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ao(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function To(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rtc",n=!1,i=e.reduce((function(e,i){var a=Yt(),o=pr(i),s=Ro(Ro({},t),{},{configID:a}),c=Date.now();vi(r+"_get_config",{type:"request",error_code:0,message:s,host:o,config_id:a,event_starttime:c});var d=ur(i),u=null;return d?(u=Promise.resolve(d),vi(r+"_get_config",{type:"cache",error_code:0,message:d,host:o,config_id:d.config_id,event_starttime:c})):u=ir(i,s).then((function(e){if(vi(r+"_get_config",{type:"server",error_code:0,message:e,host:o,config_id:a,event_starttime:c}),!n)return cr(i,Object.assign(e,{config_id:a})),gi(o),n=!0,e}),(function(e){return vi(r+"_get_config",{type:"server",error_code:9992,message:e,host:o,config_id:a,event_starttime:c}),new Promise((function(t,r){return r(e)}))})),e.push(u),e}),[]);return $t(i)}function Eo(){return(Eo=t(c.mark((function e(t){var r,n,i=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},n={deviceType:"web",deviceID:yi(),appID:r.appId,businessID:r.businessId,roomID:r.roomId,userID:r.userId,ip:r._userAgentIP||void 0,labelSelector:"sdkVersion=".concat(Vi.version),keys:t},e.prev=2,e.next=5,To(Vi.configServerUrls,n,"rtc");case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,To(Vi.configServerUrls,n,"rtc");case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function xo(){return(xo=t(c.mark((function e(t){var r,n,i=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},n={deviceType:"web",deviceID:yi(),appID:r.appId,businessID:r.businessId,roomID:r.roomId,userID:r.userId,ip:r._userAgentIP||void 0,labelSelector:"sdkVersion=".concat(Vi.version),keys:t},e.prev=2,e.next=5,To(Vi.onerConfigServerUrls,n,"oner");case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,To(Vi.onerConfigServerUrls,n,"oner");case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Io(e,t,r,n){return e?"Bearer "+e:"Basic "+function(e,t,r){return Co.encodeBase64([e,t,r].join(":"))}(t,r,n)}var Po=Object.freeze({__proto__:null,getServerConfig:function(e){return Eo.apply(this,arguments)},getOnerServerConfig:function(e){return xo.apply(this,arguments)},tokenToAuthorization:Io});function Oo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){var r=t.filter((function(e){return""!==e.label}));e(r)}),t):t(new Error("Please make sure your website enables 'https' protocol. If there is still a problem, maybe your browser does not support webrtc"))}function Do(){var e,t={},r=function(){return n().os},n=(e=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(r[1]))return{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""};"Chrome"===r[1]&&null!=(e=t.match(/(OPR(?=\/))\/?(\d+)/i))&&(r=e),"Chrome"===r[1]&&null!=(e=t.match(/(mqqbrowser(?=\/))\/?(\d+)/i))&&(r=e),"Chrome"===r[1]&&null!=(e=t.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(r=e),"Safari"===r[1]&&null!=(e=t.match(/version\/(\d+)/i))&&(r[2]=e[1]);var n=void 0,i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var a in i){var o=i[a];if(o.r.test(navigator.userAgent)){n=o.s;break}}return{name:r[1],version:r[2],os:n}}(),function(){return e});return t.getBrowserInfo=n,t.getBrowserVersion=function(){return n().version},t.getBrowserOS=r,t.isChrome=function(){var e=n();return e.name&&"Chrome"===e.name},t.isSafari=function(){var e=n();return e.name&&"Safari"===e.name},t.isFireFox=function(){var e=n();return e.name&&"Firefox"===e.name},t.isOpera=function(){var e=n();return e.name&&"OPR"===e.name},t.isQQBrowser=function(){var e=n();return e.name&&"MQQBrowser"===e.name},t.isWeChatBrowser=function(){var e=n();return e.name&&"MicroMessenger"===e.name},t.isSupportedPC=function(){var e=r();return"Linux"===e||"Mac OS X"===e||"Mac OS"===e||-1!==e.indexOf("Windows")},t.isSupportedMobile=function(){var e=r();return"Android"===e||"iOS"===e},t}var Mo=window.AudioContext||window.webkitAudioContext,No=null,Lo=null,Bo=null,jo=function(){function e(){if(r(this,e),No)return No;No=this}var n,i;return Ee(e,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this.localGainNode),this._localSource=this.sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this.localGainNode).connect(this.audioDestionation)}},{key:"mixMp3File",value:(i=t(c.mark((function e(t){var r,n,i,a,o,s,d,u,l=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filePath,t.cacheResource,n=t.cycle,i=t.loop,a=t.playTime,o=void 0===a?0:a,s=t.muted,d=void 0!==s&&s,u=t.replace,this._mp3Audio&&(this._mp3Audio.pause(),this._mp3Audio=null),this._mp3Source&&this._mp3Source.disconnect(this.mp3GainNode),this._mp3Audio=new Audio(r),i?this._mp3Audio.loop=!0:n>0&&(this._mp3Audio.cycle=parseInt(n),this._mp3Audio.onended=function(){l._mp3Audio.cycle-- >0&&l._mp3Audio.play()}),o&&(this._mp3Audio.currentTime=o/1e3),u&&(this.localGainNode.value=0),e.next=9,this._mp3Audio.play();case 9:this._mp3Source=this.sharedAudioContext.createMediaElementSource(this._mp3Audio),this._mp3Source.connect(this.mp3GainNode).connect(this.audioDestionation),d?(this.mp3GainNode.lastConnectToDestination&&this.mp3GainNode.disconnect(Lo.destination),this.mp3GainNode.lastConnectToDestination=!1):(this.mp3GainNode.connect(Lo.destination),this.mp3GainNode.lastConnectToDestination=!0);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"stopMix",value:function(){this._mp3Audio.pause(),this._mp3Source.disconnect(this.mp3GainNode),this._localSource.disconnect(this.localGainNode),this.mp3GainNode.disconnect(this.audioDestionation),this.localGainNode.disconnect(this.audioDestionation),this.mp3GainNode.lastConnectToDestination&&this.mp3GainNode.disconnect(Lo.destination)}},{key:"getAudioMixingDuration",value:function(){return 1e3*this._mp3Audio.duration}},{key:"getAudioMixingCurrentPosition",value:function(){return 1e3*this._mp3Audio.currentTime}},{key:"setAudioMixingPosition",value:(n=t(c.mark((function e(t){var r,n=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:function(){},e.prev=1,this._mp3Audio.currentTime=t/1e3,e.next=5,this._mp3Audio.play();case 5:r(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),r("play failed");case 11:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return n.apply(this,arguments)})},{key:"getAudioMixingVolume",value:function(){return this._mp3GainNode.gain.value}},{key:"adjustAudioMixingVolume",value:function(e){this._mp3GainNode.gain.value=Number(e)/100}},{key:"isSupport",value:function(){return!!Mo}},{key:"pauseMp3",value:function(){this._mp3Audio.pause()}},{key:"resumeMp3",value:function(){return this._mp3Audio.play()}},{key:"mixTrack",get:function(){return this.audioDestionation.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return Lo||(Lo=Mo?new Mo:null,Ai(Lo,"not support sharedAudioContext"),Lo&&Ai("suspended"!==Lo.state,"AudioContext is suspending")),Lo}},{key:"audioDestionation",get:function(){return Bo||(Bo=Lo.createMediaStreamDestination()),Bo}},{key:"mp3GainNode",get:function(){return this._mp3GainNode||(this._mp3GainNode=Lo.createGain(),this._mp3GainNode.gain.value=1),this._mp3GainNode}},{key:"localGainNode",get:function(){return this._localGainNode||(this._localGainNode=Lo.createGain(),this._localGainNode.gain.value=1),this._localGainNode}}]),e}(),Uo=[[14400,[[15,5e4]]],[19200,[[15,65e3]]],[32400,[[15,1e5]]],[43200,[[15,12e4]]],[57600,[[15,14e4]]],[76800,[[15,2e5]]],[101760,[[15,22e4]]],[129600,[[15,26e4],[30,4e5]]],[172800,[[15,32e4],[30,49e4]]],[230400,[[15,4e5],[30,6e5]]],[307200,[[10,4e5],[15,5e5],[30,75e4]]],[407040,[[15,61e4],[30,93e4]]],[691200,[[15,91e4],[30,138e4]]],[921600,[[15,113e4],[30,171e4]]],[2073600,[[15,208e4],[30,315e4],[60,478e4]]],[3686400,[[30,485e4],[60,65e5]]],[8294400,[[30,65e5],[60,65e5]]]];var Fo=wo.constants,Vo=(Fo.DC_MESSAGE_CODE,Fo.DC_MESSAGE_DIRECTION,Fo.DC_MESSAGE_FUNCTION_TYPE,new Map),zo=function(e){var r=e,n=new jo,i=null,a=Vo.get(r.stream);if(a)return a;var o=Wo();o.class="VStream",o.videoParam={},o.screenParam={},o.client=null,window.navigator.userAgent.match(/firefox/i)||(o.videoParam={videoSize:[120,120,640,480],videoFrameRate:[10,15],minVideoBW:parseInt(500/3),maxVideoBW:500}),o._audioProfile="music_standard",o.audioParam=_(o._audioProfile),Vo.set(r.stream,o),r.stream?(Object.defineProperty(o,"stream",{value:r.stream,enumerable:!1}),o.stream.on("track-ended",(function(e){if(o.emit({type:"track-ended",message:"".concat(e.message," track ended"),code:qt.TRACK_ENDED}),o.stream.room){var t=o.getMediaStream();t&&t.getTracks().every((function(e){return"ended"===e.readyState}))&&o.stream.room.unpublish(e.stream,(function(e,t){e?rt.error("stream-ended unpublish error",e):rt.debug("stream-ended unpublish result",t)}))}else rt.error("track-ended that.stream.room null",o.stream.room)})),o.stream.on("bandwidth-alert",(function(e){o.dispatchEvent({type:e.type,message:e.message,bandwidth:e.bandwidth})})),o.stream.on("data-channel-open",(function(e){})),o.stream.on("data-channel-close",(function(e){})),o.stream.on("message-received",(function(e){})),o.stream.on("send-message-failed",(function(e){})),o.stream.on("decoder-error",(function(e){o.emit({type:e.type,message:e.message})})),o.stream.local?(o.stream.on("first-local-audio-render",tr((function(e){o.stream.room&&o.stream.room.emit({type:e.type,stream:o})}))),o.stream.on("first-local-video-render",tr((function(e){o.stream.room&&o.stream.room.emit({type:e.type,stream:o})})))):(o.stream.on("first-remote-audio-render",tr((function(e){o.stream.room&&o.stream.room.emit({type:e.type,stream:o})}))),o.stream.on("first-remote-video-render",tr((function(e){o.stream.room&&o.stream.room.emit({type:e.type,stream:o})}))))):rt.error(new Error("new VStream error"),r);var s;o.init=(s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};b("rtc_sdk_api_call",{sdk_api_name:"stream.init"});var i={event_starttime:new Date};if(o.stream.setAudioParam(o.audioParam),r.mediaStream)return rt.warning("spec.mediaStream",r.mediaStream),o.stream.setMediaStream(r.mediaStream),p(i,null,{stream_source:"mediaStream"}),void e();o.stream.on("access-accepted",function(){var r=t(c.mark((function t(r){return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:rt.debug("Access to webcam and/or microphone granted",r),o.dispatchEvent(Zo({type:"accessAllowed"})),p(i,null,r),e();case 4:case"end":return t.stop()}}),t)})));return function(e){return r.apply(this,arguments)}}()),o.stream.on("access-denied",function(){var e=t(c.mark((function e(t){var i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(rt.error("Access to webcam and/or microphone rejected",t),i=qt.VDM_CAMERA_NOT_AUTHORIZED,!r.audio){e.next=14;break}return e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:r.audio});case 6:e.sent.getAudioTracks().forEach((function(e){return e.stop()})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),i=qt.ADM_NO_PERMISSION,b("rtc_permission",{permission_type:"audio",authorization_status:!1,message:"permission_denied"});case 14:r.video&&i===qt.VDM_CAMERA_NOT_AUTHORIZED&&b("rtc_permission",{permission_type:"video",authorization_status:!1,message:"permission_denied"}),rt.error("callback error.code",i),o.dispatchEvent(Zo({type:"accessDenied",message:t.message,code:i})),n(new qt(t.message,i,t));case 18:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()),rt.debug("that.stream.init(videoSize, videoFrameRate)",o.videoParam),o.stream.screen?o.stream.init(o.screenParam):o.stream.init(o.videoParam)},function(e,t){var r=new Promise((function(e,t){return s(e,t)}));return r.then(e,t),r});o.play=function(e,t,r){return b("rtc_sdk_api_call",{sdk_api_name:"play"}),o.stream.play(e,t,r)};o.getMediaStream=function(){return o.stream&&o.stream.stream};o.setVideoBitrate=function(e){if(!Array.isArray(e))throw new Error("parameter for setVideoBitRate is incorrect.");o.videoParam.minVideoBW=e[0],o.videoParam.maxVideoBW=e[1]};o.setVideoProfile=function(e){if(b("rtc_sdk_api_call",{sdk_api_name:"setVideoProfile",sdk_api_args:[e]}),rt.debug("setVideoProfile",e),!$i[e.toUpperCase()])throw new Error(e+"");var t=function(e){var t=e&&$i[e.toUpperCase()];return t?{resolution:{width:parseInt(t[0].split("x")[0]),height:parseInt(t[0].split("x")[1])},frameRate:{min:t[1]>15?15:10,max:t[1]},bitrate:{min:parseInt(t[2]/3),max:t[2]}}:{}}(e);o.setVideoEncoderConfiguration(t)};o.setVideoEncoderConfiguration=function(e){if(e){var t=e.resolution,r=t&&(t.width!==o.videoParam.videoSize[2]||t.height!==o.videoParam.videoSize[3]),n=e.frameRate,i=n&&(n.min!==o.videoParam.videoFrameRate[0]||n.max!==o.videoParam.videoFrameRate[1]),a=e.bitrate,s=a&&(a.min!==o.videoParam.minVideoBW||a.max!==o.videoParam.maxVideoBW);t&&t.width&&t.height&&(o.videoParam.videoSize=[120,120,t.width,t.height]),n&&n.min&&n.max&&(o.videoParam.videoFrameRate=[n.min,n.max]),a&&a.min&&a.max&&(o.videoParam.minVideoBW=a.min,o.videoParam.maxVideoBW=a.max),o.stream&&o.stream.stream&&(r||i)&&o.stream.updateConfiguration(o._getVideoParamForConstants(),(function(e){e&&rt.error("updateConfiguration error at ".concat(e.message))})),o.stream&&o.stream.room&&o.stream.pc&&s&&(o.stream.setMaxVideoBW(a.max),o.stream.setMinVideoBW(a.min),o.stream.applyBitreate())}};o.getStats=function(e){return o.stream.getStats(e)};o.stop=function(){return b("rtc_sdk_api_call",{sdk_api_name:"stop"}),o.stream.stop()};o.close=function(){b("rtc_sdk_api_call",{sdk_api_name:"closeStream"}),o._clear(),o.stream.close()};o.enableAudio=function(){return b("rtc_sdk_api_call",{sdk_api_name:"enableAudio"}),o.stream.enableAudio()};o.disableAudio=function(){return b("rtc_sdk_api_call",{sdk_api_name:"disableAudio"}),o.stream.disableAudio()};o.enableVideo=function(){return b("rtc_sdk_api_call",{sdk_api_name:"enableVideo"}),o.stream.enableVideo()};o.disableVideo=function(){return b("rtc_sdk_api_call",{sdk_api_name:"disableVideo"}),o.stream.disableVideo()};o.unmuteAudio=function(){return b("rtc_sdk_api_call",{sdk_api_name:"unmuteAudio"}),o.stream.unmuteAudio()};o.muteAudio=function(){return b("rtc_sdk_api_call",{sdk_api_name:"muteAudio"}),o.stream.muteAudio()};o.unmuteVideo=function(){return b("rtc_sdk_api_call",{sdk_api_name:"unmuteVideo"}),o.stream.unmuteVideo()};o.muteVideo=function(){return b("rtc_sdk_api_call",{sdk_api_name:"muteVideo"}),o.stream.muteVideo()};var d=function(){var e=t(c.mark((function e(t){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.stream){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,o.stream.enableLocalTrack(t,"video",r.video);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();o.enableLocalVideo=d;var u=function(){var e=t(c.mark((function e(t){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.stream){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,o.stream.enableLocalTrack(t,"audio",r.audio);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();o.enableLocalAudio=u;o.getId=function(){return o.stream.getId()};o.hasAudio=function(){return o.stream.hasAudio()};o.hasVideo=function(){return o.stream.hasVideo()};var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return b("rtc_sdk_api_call",{sdk_api_name:"replaceTrack"}),g(e,t,r)};o.replaceTrack=l;o.getAudioLevel=function(){return o.stream?o.stream.getAudioLevel():0};o.isAudioPlaying=function(){var e;return b("rtc_sdk_api_call",{sdk_api_name:"isAudioPlaying"}),(e=o.stream).isAudioPlaying.apply(e,arguments)};o.playAudio=function(){var e;return b("rtc_sdk_api_call",{sdk_api_name:"playAudio"}),(e=o.stream).playAudio.apply(e,arguments)};o.getCustomData=function(){var e;return(e=o.stream).getCustomData.apply(e,arguments)};o._setStaticQualityLayer=function(){var e;return(e=o.stream)._setStaticQualityLayer.apply(e,arguments)};function p(e,t,r){o.stream.stream&&o.stream.stream.getTracks().forEach((function(n){b("rtc_permission",{permission_type:n.kind,authorization_status:!0,message:"permission_authored"}),b("rtc_create_media",Object.assign({media_type:n.kind},e),t,r)}))}o.getRttMean=function(){var e;return(e=o.stream).getRttMean.apply(e,arguments)},Object.defineProperty(o,"uid",{get:function(){return o.stream.uid}}),o.getVideoProfile=function(){return o.videoParam.videoSize[2]+"P"},o.getVideoEncoderConfiguration=function(){return{resolution:{width:o.videoParam.videoSize[2],height:o.videoParam.videoSize[3]},frameRate:{min:o.videoParam.videoFrameRate[0],max:o.videoParam.videoFrameRate[1]},bitrate:{min:o.videoParam.minVideoBW,max:o.videoParam.maxVideoBW}}},o._getVideoParamForConstants=function(){return{width:o.videoParam.videoSize[2],height:o.videoParam.videoSize[3],frameRate:{min:o.videoParam.videoFrameRate[0],max:o.videoParam.videoFrameRate[1],ideal:o.videoParam.videoFrameRate[1]}}},o.setVideoBitRate=function(e){rt.warning("setVideoBitRate is deprecated, please use setVideoBitrate"),o.setVideoBitrate(e)},o.setMaxVideoBitrate=function(e){var t=o.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].maxBitrate=1e3*e,t.setParameters(r)}};o.setScreenParameters=function(e){b("rtc_sdk_api_call",{sdk_api_name:"setScreenParameters",sdk_api_args:[e]});var t=e.width,r=e.height,n=e.frameRate,i=e.bitrate;if(r&&t&&(o.screenParam.videoSize=[t,r,t,r]),n&&(o.screenParam.videoFrameRate=[n,n]),i)o.screenParam.maxVideoBW=i,o.screenParam.minVideoBW=i,o.stream.setMaxVideoBW(i),o.stream.setMinVideoBW(i);else if(t&&r&&n){var a=function(e,t,r){for(var n,i,a=e*t,o=0;o<=Uo.length-1;o++)if(a<=Uo[o][0]){n=Uo[o][1];break}n||(n=Uo[Uo.length-1][1]);for(var s=0;s<=n.length-1;s++)if(r<=n[s][0]){i=n[s][1];break}return i||(i=n[n.length-1][1]),i}(t,r,n)/1e3;o.screenParam.maxVideoBW=a,o.screenParam.minVideoBW=a,o.stream.setMaxVideoBW(a),o.stream.setMinVideoBW(a)}},o.setResolutionScaleDown=function(e){var t=o.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].scaleResolutionDownBy=e,t.setParameters(r)}},o.setEncodingActive=function(e){var t=o.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].active=e,t.setParameters(r)}},o.setMaxFramerate=function(e){var t=o.getVideoSender();if(t){var r=t.getParameters();r.encodings[0].maxFramerate=e,t.setParameters(r)}},o.getVideoBitrate=function(){return[o.videoParam.minVideoBW,o.videoParam.maxVideoBW]},o.getVideoSender=function(){var e=m();if(e&&e.getSenders)return e.getSenders().find((function(e){return"video"===e.track.kind}))},o.getAttributes=function(){var e;console.log(r.screen),r.screen?(e=o.screenParam,console.log(o.screenParam)):e=o.videoParam;var t=e,n=t.videoFrameRate,i=t.minVideoBW,a=t.maxVideoBW,s=t.videoSize;return{resolution:{width:s&&s[2],height:s&&s[3]},minFrameRate:n&&n[0],maxFrameRate:n&&n[1],minVideoBW:i,maxVideoBW:a}};o.startAudioMixing=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t=Ho("audio_mixing_failure",t),b("rtc_sdk_api_call",{sdk_api_name:"startAudioMixing",sdk_api_args:[e]});var r=o.getMediaStream();if(i=o.getAudioTrack(),n.isSupport())if(r)if(i)try{n.mixMediaStream(r),n.mixMp3File(e).then((function(){g(n.mixTrack,(function(){t()}),(function(e){t("startAudioMixing replaceTrack failed"+e)}))})).catch((function(e){t("startAudioMixing mixMp3File failed"+e.message)}))}catch(e){t("startAudioMixing failed "+e.message)}else t("no audio track to mix");else t("not has mediaStream");else t("not support audio mixer")};o.stopAudioMixing=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};e=Ho("audio_mixing_failure",e),b("rtc_sdk_api_call",{sdk_api_name:"stopAudioMixing"});try{n.pauseMp3(),g(i,(function(){e()}),(function(t){e("stop audio failed:"+t)}))}catch(t){e("stop audio failed"+t.message)}};var f=function(){var e=t(c.mark((function e(){var t,r=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Ho("audio_mixing_failure",t=r.length>0&&void 0!==r[0]?r[0]:function(){}),b("rtc_sdk_api_call",{sdk_api_name:"pauseAudioMixing"});try{n.pauseMp3(),t()}catch(e){t("pause audio failed")}case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();o.pauseAudioMixing=f;o.getAudioMixingDuration=function(){return n.getAudioMixingDuration()};o.getAudioMixingCurrentPosition=function(){return n.getAudioMixingCurrentPosition()};var h=function(){var e=t(c.mark((function e(t){var r,i,a=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.length>1&&void 0!==a[1]?a[1]:function(){},i=Ho("audio_mixing_failure",r);try{n.setAudioMixingPosition(t,i),i()}catch(e){i("play failed")}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();o.setAudioMixingPosition=h;function m(){return o.stream&&o.stream.pc&&o.stream.pc.peerConnection&&o.stream.pc.peerConnection}o.adjustAudioMixingVolume=function(e){n.adjustAudioMixingVolume(e)},o.setAudioEncoderConfiguration=function(e,t,r){o.audioParam={sampleRate:e,stereo:t,bitrate:r}},o.setAudioProfile=function(e){var t=_(e);if(!t)throw new Error(e+"");o._audioProfile=e,o.audioParam=t},o._clear=function(){try{o._releaseMediaStreamSource()}catch(e){rt.error("byteStream._clear() error",e)}},o.getAudioStats=function(){return o.stream.getAudioStats()},o.getVideoStats=function(){return o.stream.getVideoStats()},o._releaseMediaStreamSource=function(){};o.getVideoTrack=function(){return o.getMediaStream()&&o.getMediaStream().getVideoTracks().length>0?o.getMediaStream().getVideoTracks()[0]:null};o.getAudioTrack=function(){return o.getMediaStream()&&o.getMediaStream().getAudioTracks().length>0?o.getMediaStream().getAudioTracks()[0]:null};o.mirror=function(e){return b("rtc_sdk_api_call",{sdk_api_name:"mirror"}),o.stream.mirror(e)},o.replaceTrackForLocal=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=o.stream.stream;i||n("no mediaStream"),"audio"===e.kind?t=i.getAudioTracks()[0]:"video"===e.kind&&(t=i.getVideoTracks()[0]),t||n("no track in stream"),i.removeTrack(t),i.addTrack(e),o.stream.player&&o.stream.player.updateSrcObject(),r()},o.getVideoDescriptions=function(){return o.stream?o.stream.videoDescriptions:new qt("no stream")},o.sendMessage=function(){console.warn("client.sendP2PMessage")},o.sentMessages=function(){return 0},o.setTransform=function(e,t){o.stream&&(e&&(o.stream.audioTransform=e),t&&(o.stream.videoTransform=t))};var v=function(){var e=t(c.mark((function e(t){var n,i,a,s,d,u,p;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.microphoneId,i=t.cameraId,o.stream&&o.stream.stream){e.next=3;break}return e.abrupt("return",!1);case 3:if(a={},i&&i!==r.cameraId&&(a.video=Object.assign({},r.video,{deviceId:i})),n&&n!==r.microphoneId&&(a.audio=Object.assign({},r.audio,{deviceId:n})),a.video||a.audio){e.next=8;break}return e.abrupt("return",!1);case 8:return e.next=10,navigator.mediaDevices.getUserMedia(a);case 10:if(s=e.sent,(d=s.getTracks()).length){e.next=14;break}return e.abrupt("return",!1);case 14:if(o.stream.stream.getTracks().forEach((function(e){a[e.kind]&&(o.stream.stream.removeTrack(e),e.stop())})),d.forEach((function(e){o.stream.stream.addTrack(e)})),o.stream._state!==Bi.SUCCESS){e.next=27;break}u=0;case 18:if(!(u<d.length)){e.next=27;break}return p=void 0,e.next=22,l(d[u],(function(){}),(function(){p=!0}));case 22:if(!p){e.next=24;break}return e.abrupt("return",!1);case 24:u++,e.next=18;break;case 27:return Object.assign(r,a),n&&(r.microphoneId=n),i&&(r.cameraId=i),o.stream.updateAudioSource(),e.abrupt("return",!0);case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function g(e){return y.apply(this,arguments)}function y(){return(y=t(c.mark((function e(t){var r,n,i,a,s=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:function(){},n=s.length>2&&void 0!==s[2]?s[2]:function(){},i=Ho("audio_mixing_failure",n),o.stream.local){e.next=6;break}return i("Only work for local steam"),e.abrupt("return");case 6:if(t instanceof MediaStreamTrack){e.next=9;break}return i("Invalid track."),e.abrupt("return");case 9:if(m()){e.next=13;break}return i("peerconnection not prepared"),e.abrupt("return");case 13:if(e.prev=13,a=o.stream.senders[t.kind]){e.next=18;break}return i("peerconnection not prepared"),e.abrupt("return");case 18:if(a.track===t){e.next=22;break}return e.next=22,a.replaceTrack(t);case 22:r(),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(13),i("error happens in replacing track."),Ai(!1,"replaceTrack: ".concat(e.t0.message));case 29:case"end":return e.stop()}}),e,null,[[13,25]])})))).apply(this,arguments)}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;vi(e,Object.assign(wi(o.stream),t),r,n)}function _(e){var t=e&&Xi[e];return t?{sampleRate:t[0],stereo:t[1],bitrate:t[2]}:{}}return o.switchDevice=v,o};function Go(){return Object.keys($i)}function Ho(e,t){return function(r){r&&vi(e,{message:r}),t(r)}}var Wo=Ri,qo=Ti,Jo=xi,Zo=function(e){var t=Jo(e);return e.stream&&(t.stream=zo({stream:e.stream})),t},Ko=function(e){var t=qo(e);return Object.assign(t,e),t};function Qo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Yo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qo(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Xo=wo.constants,$o=Xo.STREAM_STATE,es=Xo.ROOM_STATE;function ts(e){return Object.prototype.toString.call(e).slice(8,-1)}var rs=function e(t){if(null!=t){var r=ts(t);if("Date"===r){var n=new Date;return n.setTime(t.getTime()),n}if("Object"===r){if(!0===function(e){var t=[];return function e(r){if(r&&"Object"===ts(r)){if(-1!==t.indexOf(r))return!0;for(var n in t.push(r),r)if(!0===r.hasOwnProperty(n)&&e(r[n]))return!0}return!1}(e)}(t))return t;var i={};for(var a in t)i[a]=e(t[a]);return i}if("Array"===r){for(var o=[],s=0;s<t.length;s++)o.push(e(t[s]));return o}return t}};function ns(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function is(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ns(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ns(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var as={get:function(e,t){var r=e[t];if("string"!=typeof t||"function"!=typeof r)return r;r=r.bind(e);var n=e.getId(),i=e.uid;switch(t){case"getId":case"getUserId":case"isPlaying":case"hasAudio":case"hasVideo":case"hasScreen":case"isAudioOn":case"isVideoOn":case"_isAudioMuted":case"_isVideoMuted":case"_hasVideoTracks":case"getAudioLevel":case"getStats":case"play":case"init":return r;case"on":return function(e,t){return r(e,(function(r){switch(e){case"accessAllowed":case"accessDenied":break;default:vi("rtc_sdk_callback",{sdk_callback_name:e,message:Ci(r)})}t(r)}))};default:return function(){var a=r.apply(e,arguments);return us(vi,"rtc_sdk_api_call","stream.".concat(t),arguments,n,i),a}}}},os=new Map,ss={get:function(e,t){var r=e[t],n=e.eventLog;if("string"!=typeof t||"function"!=typeof r)return r;switch(r=r.bind(e),t){case"getLocalAudioStats":return function(e){return r((function(t){var r=rs(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.RecordingLevel=i.RecordingLevel?parseInt(i.RecordingLevel):0,i.SendBitrate=i.SendBitrate?parseInt(i.SendBitrate):0,i.SendLevel=i.SendLevel?parseInt(i.SendLevel):void 0,i.SamplingRate=i.SamplingRate?parseInt(i.SamplingRate):void 0,i.audioSendPacketsLost&&(i.PacketLossRate=i.audioSendPacketsLost,delete i.audioSendPacketsLost),i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"getLocalVideoStats":return function(e){return r((function(t){var r=rs(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.CaptureFrameRate=i.CaptureFrameRate?parseInt(i.CaptureFrameRate):0,i.CaptureResolutionHeight=i.CaptureResolutionHeight?parseInt(i.CaptureResolutionHeight):0,i.CaptureResolutionWidth=i.CaptureResolutionWidth?parseInt(i.CaptureResolutionWidth):0,i.EncodeDelay=i.EncodeDelay?parseInt(i.EncodeDelay):0,i.SendFrameRate=i.SendFrameRate?parseInt(i.SendFrameRate):0,i.SendBitrate=i.SendBitrate?parseInt(i.SendBitrate):0,i.SendResolutionHeight=i.SendResolutionHeight?parseInt(i.SendResolutionHeight):0,i.SendResolutionWidth=i.SendResolutionWidth?parseInt(i.SendResolutionWidth):0,i.TargetSendBitrate=i.TargetSendBitrate?parseInt(i.TargetSendBitrate):0,i.TotalDuration=i.TotalDuration?parseInt(i.TotalDuration):0,i.TotalFreezeTime=i.TotalFreezeTime?parseInt(i.TotalFreezeTime):0,i.videoSendPacketsLost&&(i.PacketLossRate=i.videoSendPacketsLost,delete i.videoSendPacketsLost),i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"getRemoteAudioStats":return function(e){return r((function(t){var r=rs(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.TransportDelay=i.TransportDelay?parseInt(i.TransportDelay):0,i.End2EndDelay=i.End2EndDelay?parseInt(i.End2EndDelay):0,i.RecvLevel=i.RecvLevel?parseInt(i.RecvLevel):0,i.RecvBitrate=i.RecvBitrate?parseInt(i.RecvBitrate):0,i.TotalFreezeTime=i.TotalFreezeTime?parseInt(i.TotalFreezeTime):0,i.TotalPlayDuration=i.TotalPlayDuration?parseInt(i.TotalPlayDuration):0,i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"getRemoteVideoStats":return function(e){return r((function(t){var r=rs(t);for(var n in r){var i=r[n];"string"==typeof i.MuteState&&(i.MuteState=parseInt(i.MuteState)),i.MuteState=!!i.MuteState&&!!i.MuteState,i.End2EndDelay=i.End2EndDelay?parseInt(i.End2EndDelay):0,i.TransportDelay=i.TransportDelay?parseInt(i.TransportDelay):0,i.RecvBitrate=i.RecvBitrate?parseInt(i.RecvBitrate):0,i.RecvResolutionWidth=i.RecvResolutionWidth?parseInt(i.RecvResolutionWidth):0,i.RecvResolutionHeight=i.RecvResolutionHeight?parseInt(i.RecvResolutionHeight):0,i.RenderResolutionWidth=i.RenderResolutionWidth?parseInt(i.RenderResolutionWidth):0,i.RenderResolutionHeight=i.RenderResolutionHeight?parseInt(i.RenderResolutionHeight):0,i.RenderFrameRate=i.RenderFrameRate?parseInt(i.RenderFrameRate):0,i.TotalFreezeTime=i.TotalFreezeTime?parseInt(i.TotalFreezeTime):0,i.TotalPlayDuration=i.TotalPlayDuration?parseInt(i.TotalPlayDuration):0,i.PacketLossRate=i.PacketLossRate?parseInt(i.PacketLossRate):0}e(r)}))};case"join":return function(e,i,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},c={event_starttime:new Date};return us(n,"rtc_sdk_api_call",ds(t),[e,i,a]),r(e,i,a,(function(t){o(t),n("rtc_sdk_api_callback",is(is({sdk_callback_name:"onJoinChannelSuccess",message:{token:e,roomId:i,userId:a}},c),{},{error_code:0}))}),(function(e){s(e),n("rtc_error",e?{from:t,message:JSON.stringify(e)}:{from:t,message:"no error"})}))};case"subscribe":case"publish":return function(i,a){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},s=null;"function"==typeof a?(o=a,s=r(i,(function(e){o(e),e?n("rtc_error",{from:t,message:JSON.stringify(e)}):n("rtc_sdk_api_callback",{sdk_callback_name:t})}))):s=r(i,a,(function(e){o(e),e?n("rtc_error",{from:t,message:JSON.stringify(e)}):n("rtc_sdk_api_callback",{sdk_api_name:t,message:a})}));var c="publish"===t?e.id:i.uid,d=i.getId();return us(n,"rtc_sdk_api_call",ds(t),arguments,d,c),s};case"unpublish":case"unsubscribe":return function(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return"function"==typeof i&&(a=i,i={}),us(n,"rtc_sdk_api_call",ds(t),arguments),r(e,(function(e){a(e),e?n("rtc_error",{from:t,message:JSON.stringify(e)}):n("rtc_sdk_api_callback",{sdk_callback_name:t})}))};case"on":return function(e,t){var i=function(r){var i=r.stream&&(r.stream.uid||r.stream.getId());r.stream&&r.stream.getId();switch(r.uid=r.uid||i,r.stream&&(r.streamId=r.stream.getId()),e){case"network-quality":case"network-type-changed":case"peer-online":case"stream-added":case"stream-subscribed":case"stream-published":case"connection-state-change":break;default:n("rtc_sdk_callback",{sdk_callback_name:e,message:Ci(r)})}t(r)};try{os.set(t,i)}catch(e){console.error(e)}return r(e,i)};case"off":return function(e,t){var n=t;try{n=os.get(t)}catch(e){}return r(e,n)};default:return function(){var i=r.apply(e,arguments);return us(n,"rtc_sdk_api_call",ds(t),arguments),i}}}},cs={on:"client.on",init:"client.init",join:"joinRoom",leave:"leaveRoom"};function ds(e){return cs[e]||e}function us(e,t,r,n,i,a){e(t,{sdk_api_name:r,message:Ci(n=Array.prototype.slice.call(n)),stream_id:i,stream_user_id:a})}var ls=new function e(){r(this,e),n(this,"VERSION",Vi.version),n(this,"onMicrophoneChanged",void 0),n(this,"onCameraChanged",void 0),n(this,"checkSystemRequirements",(function(){return function(){if(window.navigator.userAgent.match(/ edge\//i))return!1;var e=Do(),t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,n=window.WebSocket,i=!!t&&!!r&&!!n,a=!1;return rt.warning(e.getBrowserInfo(),"isAPISupport:"+i),e.isChrome()&&e.getBrowserVersion()>=58&&"iOS"!==e.getBrowserOS()&&(a=!0),e.isFireFox()&&e.getBrowserVersion()>=56&&(a=!0),e.isOpera()&&e.getBrowserVersion()>=45&&(a=!0),e.isSafari()&&e.getBrowserVersion()>=11&&(a=!0),e.isSupportedPC()||e.isSupportedMobile()||(a=!1),i&&a}()})),n(this,"checkVideoPermission",(function(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(t){t&&t.getTracks().forEach((function(e){return e.stop()})),e()})).catch(t):t(new Error("getUserMedia not suppurted"))}(e,t)})),n(this,"checkAudioPermission",(function(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){t&&t.getTracks().forEach((function(e){return e.stop()})),e()})).catch(t):t(new Error("getUserMedia not suppurted"))}(e,t)})),n(this,"setAid",(function(e){Si(e)})),n(this,"setReportEntry",(function(e,t){return ki(e,t)})),n(this,"getDevices",(function(e,t){return Oo(e,t)})),n(this,"createClient",(function(e){return vi("rtc_sdk_api_call",{sdk_api_name:"createClient",message:JSON.stringify(e)}),new Proxy(function(e){var r=e||{},n=Wo();n.monitor=mi.create();var i=n.monitor.eventLog.bind(n.monitor);n.eventLog=i,n.class="VClient",rt.debug("[VRTC] engineId: ".concat(n.monitor.getEngineId())),r.configServerHost&&(Vi.configServerHost=r.configServerHost),r.configServer&&(Vi.configServerHost=r.configServer.split("/")[2]),n.appId="",n.businessId="",n.encodedInsertableStreams=e.encodedInsertableStreams;var a={},o=null,d=!1;void 0!==r.compressReport&&(Vi.global.compressReport=!!r.compressReport),r.logUrlHost&&n.monitor.setLogDomain(r.logUrlHost);var u=navigator.connection||navigator.mozConnection||navigator.webkitConnection;function l(){n.networkType=u.effectiveType,n.emit({type:"network-type-changed",networkType:n.networkType}),i("rtc_invoke_status",{message:"online: ".concat(navigator.onLine),sdk_api_name:"network change"})}u&&(n.networkType=u.effectiveType,u.addEventListener("change",l),setTimeout((function(){n.emit({type:"network-type-changed",networkType:n.networkType}),i("rtc_invoke_status",{message:"online: ".concat(navigator.onLine),sdk_api_name:"current network"})}),300));var p={controlMessage:T("started"),userAttributes:{enableaudio:!0,enablevideo:!0},params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:Vi.version,deviceId:n.monitor.getDeviceId()}};switch(r.mode){case Ki:rt.warning(""),p.userAttributes.role="silentUser";break;case Qi:rt.warning("");break;default:rt.warning("RTC")}var f=function(){var e=t(c.mark((function e(t,r,i){var a;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.appId=t,n.monitor.setAppId(t),(a=n._init(null,{})).then(r,i),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();function h(e){function r(e){i("rtc_sdk_callback",Object.assign({sdk_callback_name:e.type,message:Ci(e),error_code:e.code},wi(e.stream&&e.stream.stream)))}n.room=new wo.Room({monitor:n.monitor,client:n}),n.room.on("stream-added",(function(e){Ai(e.stream.uid,"stream-added: not found uid ".concat(e.stream));var t=e.stream.uid===n.id?"stream-published":e.type,i=Zo({type:t,stream:e.stream});e.stream.client=n,r(i),n.dispatchEvent(i)})),n.room.on("stream-subscribed",(function(e){Ai(e.stream.uid,"stream-subscribed: not found uid ".concat(e.stream));var t=Zo({type:e.type,stream:e.stream});r(t),n.dispatchEvent(t)})),n.room.on("stream-removed",(function(e){var t=Zo({type:e.type,stream:e.stream});if(e.stream.client=null,r(t),n.dispatchEvent(t),n.id===e.stream.uid){var i=Zo({type:"stream-unpublished",stream:e.stream});r(i),n.dispatchEvent(i)}})),n.room.on("custom-message",(function(e){var t=Ko({type:e.type,message:e.message});r(t),n.dispatchEvent(t)})),n.room.on("audio-enable",(function(e){var t=e.enable?"unmute-audio":"mute-audio",i=Zo({type:t,stream:e.stream});r(i),n.dispatchEvent(Ko({type:t,stream:i.stream,uid:e.stream.uid}))})),n.room.on("video-enable",(function(e){var t=e.enable?"unmute-video":"mute-video",i=Zo({type:t,stream:e.stream});r(i),n.dispatchEvent(Ko({type:t,stream:i.stream,uid:e.stream.uid}))})),n.room.on("client-banned",(function(e){var t=e.type,i=e.message,a=e.code,o=Ko({uid:n.id,type:t,message:i,code:a});r(o),n.dispatchEvent(o)})),n.room.on("userConnection",(function(e){var t,i={uid:e.message.clientId};r(t=Ko(Object.assign(i,{type:"peer-online"}))),n.dispatchEvent(t)})),n.room.on("room-disconnected",(function(){var e=Ko({type:"room-disconnected"});r(e),n.dispatchEvent(e)})),n.room.on("user-message-received",(function(e){var t;if("__web__rtc__rtt__"!==(null==e||null===(t=e.message)||void 0===t?void 0:t.msg)){var i=Ko(Yo({type:"user-message-received"},e));r(i),n.dispatchEvent(i)}})),n.room.on("userDisconnection",(function(e){var t,i={uid:e.message.clientId,reason:e.message.tag};"userDuplicateLogin"===e.message.tag?(e.message.clientId===n.id&&n.leave(),t=Ko(Object.assign(i,{type:"client-banned",code:qt.DUPLICATE_LOGIN}))):t=Ko(Object.assign(i,{type:"peer-leave"})),r(t),n.dispatchEvent(t)})),n.room.on("tokenFailed",(function(e){var t=Ko({type:"token-request",message:e.message,code:qt.INVALID_TOKEN});r(t),n.dispatchEvent(t)})),n.room.on("signalServerFailed",function(){var e=t(c.mark((function e(t){var r;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={event_starttime:new Date,reconnect_id:Yt(),reconnect_type:"signalServerFailed"},i("rtc_reconnect",r,{code:t.code||1004,message:t.message||"retry getroom"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.room.on("connection-state-change",(function(e){var t=e.type,i=e.prevState,a=e.curState,o=Ko({type:t,prevState:i,curState:a});r(o),n.dispatchEvent(o)})),n.room.on("first-local-audio-render",(function(e){i("first_local_audio_render",wi(e.stream.stream)),n.emit({type:"first-local-audio-render"})})),n.room.on("first-local-video-render",(function(e){i("first_local_video_render",wi(e.stream.stream)),n.emit({type:"first-local-video-render"})})),n.room.on("first-remote-audio-render",(function(e){i("first_remote_audio_render",wi(e.stream.stream)),n.emit({type:"first-remote-audio-render",uid:e.stream.stream.uid})})),n.room.on("first-remote-video-render",(function(e){i("first_remote_video_render",wi(e.stream.stream)),n.emit({type:"first-remote-video-render",uid:e.stream.stream.uid})})),n.room.on("login-completion",(function(e){i("login-completion",{message:{errorCode:0,listStreams:e.streams}}),n.emit({type:"login-completion",message:{errorCode:0,listStreams:e.streams}})})),n.room.on("republish-stream",(function(){d&&n.startLiveStreaming()})),n.room.on("error",(function(e){i("error",{message:e}),n.emit({type:"error",message:e.message,code:e.code})})),n.room.on("ice-state-change",(function(e){n.emit({type:"ice-state-change",state:e.state})})),n.room.on("volume-indicator",(function(e){n.emit({type:"volume-indicator",volumes:e.volumes})})),n.room.on("live-transcoding-result",(function(e){n.emit({type:"live-transcoding-result",code:e.code,message:e.message})}))}n.init=f,n._init=function(){var e=t(c.mark((function e(t,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(n.appId=t,n.monitor.setAppId(t)),E(),o=o||setInterval(E,5e3),n._serverConfig=r,h(n._serverConfig.domain);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();var m=function(){var e=t(c.mark((function e(t,a,o){var s,d,u,l,f,h,m,v,g,y=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=y.length>3&&void 0!==y[3]?y[3]:function(){},d=y.length>4&&void 0!==y[4]?y[4]:function(){},o=(o||"")+"",Ai(""!=(a=(a||"")+"")&&""!==o,"roomId: ".concat(a," or uid: ").concat(o," is none.")),u=(new Date).valueOf(),n.__logJoinRoom={channel_role:"",event_starttime:u,start:u},n.sessionId=n.monitor.getAndSetSessionId(),e.prev=8,n.roomId=a,n.monitor.setRoomId(a),o=o||Yt(),n.id=o,n.monitor.setUserId(o),pi(),a){e.next=19;break}throw(l=new Error("roomId can not empty")).code=1001,l;case 19:if(!n.monitor.getInRoom()){e.next=23;break}throw(f=new Error("already in room")).code=1003,f;case 23:return n.monitor.setInRoom(!0),Object.assign(p,{Authorization:Io(t,n.appId,a,o),sessionId:n.sessionId,role:r.role,timestamp:Date.now(),enableICEMux:r.enableICEMux,_userAgentIP:r._userAgentIP,_mediaServerAddr:r._mediaServerAddr,_idc:r._idc,params:Yo(Yo({},p.params),{},{appId:n.appId,businessId:n.businessId,roomId:a,userId:o,iceUrl:r.iceUrl})}),e.next=27,n.room.join(p);case 27:return h=e.sent,m=h.clientId,Ai(m===o,"uid and token not match. uid:".concat(o," uid(token):").concat(m)),n.id=m,n.monitor.setUserId(m),n.monitor.setCallId(h.callId),i("rtc_join_room",n.__logJoinRoom),s(m),e.abrupt("return",m);case 38:throw e.prev=38,e.t0=e.catch(8),lr(),rt.error("join room error",e.t0),v=e.t0?JSON.stringify(e.t0):"",i("rtc_join_room_fail",Object.assign(n.__logJoinRoom,{message:v})),g=new qt(e.t0.message?e.t0.message:"join room error",qt.JOIN_ROOM_ERROR,e.t0),n.monitor.setInRoom(!1),d(g),g;case 48:case"end":return e.stop()}}),e,null,[[8,38]])})));return function(t,r,n){return e.apply(this,arguments)}}();n.join=m;var v=function(){var e=t(c.mark((function e(){var t,r,a,o,s,f=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:function(){},r=f.length>1&&void 0!==f[1]?f[1]:function(){},u&&u.removeEventListener("change",l),d&&(a=p.controlMessage.transcodeMeta.transcode.url,n.stopLiveStreaming(a)),e.prev=4,e.next=7,n.room;case 7:if(e.t0=e.sent,!e.t0){e.next=10;break}e.t0=n.room.leaveRoom({sessionId:n.sessionId,Authorization:p.Authorization},"client leave room");case 10:o=e.t0,rt.debug("rtc_leave_room success",o),i("rtc_leave_room",n.__logJoinRoom),delete n.__logJoinRoom,n.monitor.setInRoom(!1),t(o),e.next=25;break;case 18:e.prev=18,e.t1=e.catch(4),rt.error("rtc_leave_room error",e.t1),s=e.t1?JSON.stringify(e.t1):"",i("rtc_leave_room",Object.assign(n.__logJoinRoom,{message:s})),n.monitor.setInRoom(!1),r(e.t1);case 25:return e.prev=25,n.monitor.setCallId(""),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[4,18,25,28]])})));return function(){return e.apply(this,arguments)}}();n.leave=v;var g=function(){var e=t(c.mark((function e(t){var a,o,s,d,u,l,p,f=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=f.length>1&&void 0!==f[1]?f[1]:{},o=f.length>2&&void 0!==f[2]?f[2]:function(){},rt.debug("[API] call publish",t,a),t.client=n,"function"==typeof a&&(o=a,a={}),n.room.state===es.CONNECTED){e.next=7;break}return e.abrupt("return",o(new qt("not in room",qt.NOT_IN_ROOM)));case 7:return r.mode===Qi&&(a.data=!0,t.stream.data=!0),a.encodedInsertableStreams=n.encodedInsertableStreams,e.prev=9,w("normalUser"),t.getVideoProfile()&&(s=t.getAttributes(),d=s.minVideoBW,u=s.maxVideoBW,Object.assign(a,{minVideoBW:d,maxVideoBW:u}),rt.debug("",a)),e.next=14,n.room.publish(t.stream,a);case 14:i("rtc_publish",wi(t&&t.stream)),e.next=36;break;case 17:if(e.prev=17,e.t0=e.catch(9),!t||!t.stream||t.stream.getState()!==$o.FAILED){e.next=23;break}rt.error("[publish error skip]",e.t0),e.next=36;break;case 23:e.t1=e.t0.code,e.next=403===e.t1?26:406===e.t1?28:30;break;case 26:return l=qt.NO_PUBLISH_PERMISSION,e.abrupt("break",32);case 28:return l=qt.NOT_ACCEPTABLE,e.abrupt("break",32);case 30:return l=e.t0.code,e.abrupt("break",32);case 32:throw p=new qt(e.t0.message,l,e.t0),i("rtc_publish_fail",Object.assign({message:JSON.stringify(e.t0)},wi(t&&t.stream))),o(p),p;case 36:case"end":return e.stop()}}),e,null,[[9,17]])})));return function(t){return e.apply(this,arguments)}}();n.publish=g;var y=function(){var e=t(c.mark((function e(t){var r,i=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:function(){},t.client=null,e.prev=3,n.room.state===es.CONNECTED){e.next=6;break}return e.abrupt("return",r(new qt("not in room",qt.NOT_IN_ROOM)));case 6:return e.next=8,n.room.unpublish(t.stream);case 8:n.room&&0!==n.room.localStreams.keys().length||w("silentUser"),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(3),r(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}();n.unpublish=y;var b=function(){var e=t(c.mark((function e(t){var a,o,s,d,u=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=function(e){return e&&e.stream&&e.stream.getState()===$o.SUCCESS},a=u.length>1&&void 0!==u[1]?u[1]:{},o=u.length>2&&void 0!==u[2]?u[2]:function(){},t.client=n,s=a.forceSubscribe,rt.debug("[API] call subscribe[update]",t,a),"function"==typeof a&&(o=a,a={video:!0,audio:!0}),void 0===a.video&&void 0===a.audio&&(a={video:!0,audio:!0}),void 0===a.video&&(a.video=!!a.video),void 0===a.audio&&(a.audio=!!a.audio),a.audio||a.video){e.next=13;break}return o(new qt("video and audio can not be both false",qt.INVALID_PARAMETERS)),e.abrupt("return");case 13:if(a.encodedInsertableStreams=n.encodedInsertableStreams,r.mode===Qi&&(a.data=!0,t.stream.data=!0),a.forceSubscribe=!!s,e.prev=16,a.forceSubscribe||!d(t)){e.next=22;break}return e.next=20,P(t,a,o);case 20:e.next=24;break;case 22:return e.next=24,x(t,a,o);case 24:i("rtc_subscribe",wi(t&&t.stream)),e.next=32;break;case 27:throw e.prev=27,e.t0=e.catch(16),i("rtc_subscribe_fail",Object.assign({message:JSON.stringify(e.t0)},wi(t&&t.stream))),o(e.t0),e.t0;case 32:case"end":return e.stop()}}),e,null,[[16,27]])})));return function(t){return e.apply(this,arguments)}}();n.subscribe=b;var _=function(){var e=t(c.mark((function e(t){var r,i,a=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:function(){},i="unsubscribe",t.client=null,e.prev=3,t._clear(),e.next=7,new Promise((function(e,r){return n.room.unsubscribe(t.stream,D(e,r,i,t))}));case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),r(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}();n.unsubscribe=_,n.getConnectionState=function(){return n.room?n.room.state:es.DISCONNECTED},n.getLocalVideoStats=function(e){n.room?e(n.room.getLocalVideoStats()):e({})},n.getLocalAudioStats=function(e){n.room?e(n.room.getLocalAudioStats()):e({})},n.getRemoteVideoStats=function(e){n.room?e(n.room.getRemoteVideoStats()):e({})},n.getRemoteAudioStats=function(e){n.room?e(n.room.getRemoteAudioStats()):e({})},n.enableAudioVolumeIndicator=function(){n.room&&n.room.enableAudioVolumeIndicator()};var S=function(){var e=t(c.mark((function e(t){var r,i,a,o,s,d=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:function(){},i=d.length>2&&void 0!==d[2]?d[2]:function(){},e.prev=2,n.room&&"open"===(null===(a=n.room)||void 0===a||null===(o=a.dataChannel)||void 0===o?void 0:o.readyState)){e.next=5;break}throw new Error("");case 5:return p.Authorization=Io(t,n.appId,n.roomId,n.id),e.next=8,new Promise((function(e,t){return n.room.renewToken(p,D(e,t))}));case 8:return s=e.sent,r(s),e.abrupt("return",s);case 13:throw e.prev=13,e.t0=e.catch(2),i(e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}();function k(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};return w("normalUser"),C(e,t,r,n,i)}function w(e){return p.userAttributes.role&&p.userAttributes.role!==e?new Promise((function(t,r){return C(!1,"updateUserAttributes",{sessionId:n.sessionId,attributes:{role:e}},(function(r){p.userAttributes.role=e,t(r)}),r)})):Promise.resolve()}function C(e,t,r){var i,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};if(n.room&&"open"===(null===(i=n.room)||void 0===i||null===(a=i.dataChannel)||void 0===a?void 0:a.readyState)){if(!r)return c({msg:"",code:-1200});try{var d=new TextEncoder,u=r;if("object"===s(u)&&(u=JSON.stringify(u)),d.encode(u).byteLength>64e3)return c({msg:"64k",code:-1200})}catch(e){}n.room.sendSignaling(t,r).then(o,c)}else c(new Error(""))}function A(){return p.controlMessage.transcodeMeta&&p.controlMessage.transcodeMeta.transcode&&p.controlMessage.transcodeMeta.transcode.url}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};n.room&&n.room.state!==es.DISCONNECTED?n._sendControlMessage(T(e),t,r):r(new qt("It seems you have not joined in a room.",qt.INVALID_INVOKE_SEQUENCE))}function T(e){return{type:"transcode",action:e,transcodeMeta:p&&p.controlMessage&&p.controlMessage.transcodeMeta}}function E(){var e=!E.notFirstCall;E.notFirstCall=!0;var t=Date.now();function r(e){switch(e.device.kind){case"audioinput":n.emit(Yo({type:"recording-device-changed"},e)),i("recording-device-changed",{state:e.state,message:Ci(e.device)});break;case"audiooutput":n.emit(Yo({type:"playout-device-changed"},e)),i("playout-device-changed",{state:e.state,message:Ci(e.device)});break;case"videoinput":n.emit(Yo({type:"camera-changed"},e)),i("camera-changed",{state:e.state,message:Ci(e.device)})}n.emit(Yo({type:"device-changed"},e))}Oo((function(n){n.forEach((function(n){a[n.deviceId]?("INACTIVE"===a[n.deviceId].state&&(a[n.deviceId].state="ACTIVE",r(a[n.deviceId])),a[n.deviceId].lastReloadAt=t):(a[n.deviceId]={device:n,initAt:t,lastReloadAt:t,state:"ACTIVE"},!e&&r(a[n.deviceId]))})),Object.entries(a).forEach((function(e){var n=e[1];"ACTIVE"===n.state&&n.lastReloadAt!==t&&(n.state="INACTIVE",r(n))}))}))}function x(e,t){return I.apply(this,arguments)}function I(){return(I=t(c.mark((function e(t,r){var i,a,o,s,d=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=d.length>2&&void 0!==d[2]?d[2]:function(){},e.prev=1,a=t.stream,r.qualityLayer=a.qualityLayer,e.next=6,n.room.subscribe(t.stream,r);case 6:e.next=26;break;case 8:if(e.prev=8,e.t0=e.catch(1),!t||!t.stream||t.stream.getState()!==$o.FAILED){e.next=14;break}rt.error("[subscribe error skip]",e.t0),e.next=26;break;case 14:e.t1=e.t0.code,e.next=403===e.t1?17:406===e.t1?19:21;break;case 17:return o=qt.NO_SUBSCRIBE_PERMISSION,e.abrupt("break",23);case 19:return o=qt.NOT_ACCEPTABLE,e.abrupt("break",23);case 21:return o=e.t0.code,e.abrupt("break",23);case 23:throw s=new qt(e.t0.message,o,e.t0),i(s),s;case 26:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function P(e){return O.apply(this,arguments)}function O(){return(O=t(c.mark((function e(t){var r,i,a=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},i=a.length>2&&void 0!==a[2]?a[2]:function(){},e.prev=3,e.next=6,n.room.updateSubscribe(t.stream,r);case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(3),i(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}return n.renewToken=S,n.setLiveTranscoding=function(e){var t=function(e){var t={video:{codec:"H264",fps:e.videoFramerate||15,gop:e.videoGop||30,lowLatency:!0,bitRate:1e3*e.videoBitrate||4e5,width:e.width||640,height:e.height||360},audio:{codec:"AAC",bitRate:1e3*e.audioBitrate||48e3,sampleRate:e.audioSampleRate||44100,channels:e.audioChannels||1,profile:"LC"},layout:{canvas:{bgnd:e.backgroundColor?"#"+function(e){var t="000000"+e;return t.substr(t.length-6)}(e.backgroundColor.toString(16)):"#000000"},regions:[],app_data:""}};return e.transcodingUsers&&e.transcodingUsers.forEach((function(e){t.layout.regions.push({uid:e.uid,zorder:e.zOrder,alpha:e.alpha,renderMode:e.renderMode||1,screen:e.screen||!1,x:e.x/t.video.width,y:e.y/t.video.height,w:e.width/t.video.width,h:e.height/t.video.height})})),t}(e);p.controlMessage.transcodeMeta?Object.assign(p.controlMessage.transcodeMeta,t):p.controlMessage.transcodeMeta=t,A()&&R("layoutChanged")},n.startLiveStreaming=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(p.controlMessage.transcodeMeta){if(!(p.controlMessage.transcodeMeta.transcode&&p.controlMessage.transcodeMeta.transcode.url||""!==e))return rt.error("no url"),void r(new Error("no url"));""!==e&&(p.controlMessage.transcodeMeta.transcode={url:e}),d=!0,R("started",t,r)}else r(new Error("please setLiveTranscoding first"))},n.stopLiveStreaming=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};A()?(p.controlMessage.transcodeMeta=void 0,d=!1,R("stopped",e,t)):(t(new Error("Please startLiveStreaming first.")),rt.error("Please startLiveStreaming first."))},n.sendCustomMessage=function(e,t,r){return k(!0,"customMessage",e,t,r)},n.sendMessageToUser=function(e,t){return new Promise((function(r,i){var a,o;if(!n.room||"open"!==(null===(a=n.room)||void 0===a||null===(o=a.dataChannel)||void 0===o?void 0:o.readyState))return i({msg:"",code:-1200});if(!e)return i({msg:"id",code:-1200});if(!t)return i({msg:"",code:-1200});try{if((new TextEncoder).encode(t).byteLength>64e3)return i({msg:"64k",code:-1200})}catch(e){}r(n.room.sendP2PMessage(e,t))}))},n.setBusinessId=function(e,t){if(!n.room)return _i(e),void(n.businessId=e);t(new qt("You should invoke setBusinessId before client.init().",qt.INVALID_INVOKE_SEQUENCE))},n.getBusinessId=function(){return bi()},n.feedback=function(e,t,r){var a,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};if(n.room&&"open"===(null===(a=n.room)||void 0===a||null===(o=a.dataChannel)||void 0===o?void 0:o.readyState))if(e<1||e>5)c(new qt("Invalid grade",qt.INVALID_PARAMETERS));else{var d={network_type:n.networkType,grade:e,type:t,problem_desc:r};i("rtc_rate",d),s()}else c(new qt("Please feedback after you have joined room.",qt.NOT_IN_ROOM))},n.renewChannelKey=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};rt.warning("renewChannelKey  renewToken "),n.renewToken(e,t,r)},n._sendControlMessage=function(e,t,r){return k(!1,"controlMessage",e,t,r)},n.enableLiveTranscoding=function(e,t,r){p.controlMessage.transcodeMeta=e,d=!0,R("started",t,r)},n.disableLiveTranscoding=function(e,t){p.controlMessage.transcodeMeta=void 0,d=!1,R("stopped",e,t)},n.setVideoCompositingLayout=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};p.controlMessage.transcodeMeta?(p.controlMessage.transcodeMeta.layout=e,R("layoutChanged",t,r)):r(new Error("not enableLiveTranscoding"))},n.setSEI=function(e,t,r){rt.debug("SEI",e),n._sendControlMessage({action:"setSEI",sei:e},t,r)},n;function D(e,t,r,n){var a=Object.assign({event_starttime:new Date},wi(n&&n.stream));return function(o,s){rt.debug(o,s),r&&i("rtc_"+r,Object.assign(a,wi(n&&n.stream)),o,s),o?t(o):e(s)}}}(e),ss)})),n(this,"createStream",(function(e){var t={audio:e.audio,video:e.screen?e.video||!0:e.video,data:e.data,screen:e.screen,extensionId:e.extensionId,desktopStreamId:e.desktopStreamId,screenAudio:e.screenAudio,audioTransform:e.audioTransform,videoTransform:e.videoTransform};e.mediaStream&&(t.audio=e.mediaStream.getAudioTracks().length>0,t.video=e.mediaStream.getVideoTracks().length>0,rt.warning("spec.mediaStream",t,e.mediaStream)),e.attributes&&e.attributes.hasOwnProperty("minFrameRate")&&e.attributes.hasOwnProperty("maxFrameRate")&&(t.videoFrameRate=[e.attributes.minFrameRate,e.attributes.maxFrameRate]),t.attributes=t.attributes||{},t.attributes.audiostream=!!t.audio,t.attributes.localaudio=!!t.audio,t.attributes.videostream=!!t.video,t.attributes.localvideo=!!t.video,e.microphoneId&&t.audio&&(t.audio=!0===t.audio?{}:Object.assign({},t.audio),Object.assign(t.audio,{deviceId:{exact:e.microphoneId}})),e.cameraId&&t.video&&(t.video=!0===t.video?{}:Object.assign({},t.video),Object.assign(t.video,{deviceId:{exact:e.cameraId}})),rt.debug("createStream options",t);var r=wo.Stream(t);return vi("rtc_sdk_api_call",{sdk_api_name:"createStream",message:[Ci(e,1)]}),new Proxy(zo(Object.assign({},e,{stream:r})),as)})),n(this,"Logger",wo.Logger),n(this,"FeedbackType",Zi),n(this,"VError",qt),n(this,"VideoPlayer",wo.Player),n(this,"_getAllSupportVideoProfiles",Go),n(this,"_userAgent",Do()),n(this,"serverConfig",Po)};function ps(e){ls.onMicrophoneChanged&&(vi("rtc_sdk_callback",{sdk_callback_name:"onMicrophoneChanged",message:Ci(e)}),ls.onMicrophoneChanged(e))}function fs(e){ls.onCameraChanged&&(vi("rtc_sdk_callback",{sdk_callback_name:"onCameraChanged",message:Ci(e)}),ls.onCameraChanged(e))}function hs(){return(hs=t(c.mark((function e(){var r,n,i,a,o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=2;break}return e.abrupt("return");case 2:return r=["videoinput","audioinput"],e.next=5,navigator.mediaDevices.enumerateDevices();case 5:n=e.sent,i=Date.now(),a={},n.forEach((function(e){r.includes(e.kind)&&(a[e.deviceId]={device:e,initAt:i,state:"ACTIVE"})})),o={},navigator.mediaDevices.addEventListener("devicechange",t(c.mark((function e(){var t,n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:t=e.sent,n=Date.now(),t.forEach((function(e){if(a[e.deviceId])"INACTIVE"===a[e.deviceId].state&&(a[e.deviceId].state="ACTIVE",a[e.deviceId].updateAt=n,"videoinput"===e.kind&&fs(a[e.deviceId]),"audioinput"===e.kind&&ps(a[e.deviceId]));else{var t={device:e,initAt:n,state:"ACTIVE"};"videoinput"===e.kind&&(fs(t),a[e.deviceId]=t),"audioinput"===e.kind&&(ps(t),a[e.deviceId]=t)}r.includes(e.kind)&&(o[e.deviceId]=1)})),Object.keys(a).forEach((function(e){o[e]||"ACTIVE"!==a[e].state||(a[e].state="INACTIVE",a[e].updateAt=n,"videoinput"===a[e].device.kind&&fs(a[e]),"audioinput"===a[e].device.kind&&ps(a[e]))})),o={};case 7:case"end":return e.stop()}}),e)}))));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){hs.apply(this,arguments)}(),window.addEventListener("error",(function(e){vi("rtc_global_exeception",{message:Xt(e.error)})}));export default ls;
